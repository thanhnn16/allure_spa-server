import{Z as ot,i as dt,F as W}from"./@inertiajs-D0DMCEQB.js";import{A as it,L as lt}from"./LayoutAuthenticated-CO06RO3a.js";import{_ as ct}from"./SectionMain-Vot1TOkK.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as P,aU as c,a2 as u,a3 as t,a9 as A,bf as s,F as E,b0 as X,a1 as y,a8 as ut,r as v,e as R,b2 as V,aa as U,bH as B,j as _,bM as mt,bJ as K,bA as J,bz as xt,a0 as gt,n as yt}from"./@vue-BRgAy5zV.js";import{a as Q}from"./axios-CCb-kr4I.js";import{u as ft}from"./vue-toastification-ejyjJRED.js";import{h as bt}from"./html2pdf.js-yYbeBQq1.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./@mdi-C-p5d_Pb.js";import"./app-Cwt2YZds.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./html2canvas-Dy2Co7Il.js";const kt={components:{AllureLogo:it},props:{invoice:{type:Object,required:!0}},setup(d){return{subtotalAmount:P(()=>{var a,r;return(r=(a=d.invoice)==null?void 0:a.order)!=null&&r.order_items?d.invoice.order.order_items.reduce((p,m)=>p+Number(m.price)*Number(m.quantity),0):0})}},methods:{formatCurrency(d){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(d)},formatDateTime(d){return new Date(d).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getItemName(d){var e,a;return d.item_type==="service"?((e=d.service)==null?void 0:e.service_name)||"Dịch vụ không xác định":d.item_type==="product"?((a=d.product)==null?void 0:a.name)||"Sản phẩm không xác định":"Không xác định"},getItemCode(d){var e,a;return d.item_type==="service"?((e=d.service)==null?void 0:e.code)||"-":d.item_type==="product"&&((a=d.product)==null?void 0:a.code)||"-"},formatServiceType(d){return{single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"}[d]||d}}},pt={class:"print-template w-[76mm] mx-auto bg-white p-4 font-sans"},ht={class:"text-center mb-8 border-y-2 border-gray-200 py-4"},vt={class:"text-sm space-y-1.5 text-gray-600"},_t={class:"font-medium"},wt={class:"mb-6 text-sm"},Ct={class:"grid grid-cols-1 gap-2"},Tt={class:"flex justify-between items-center"},Nt={class:"flex justify-between items-center"},St={class:"mb-6"},jt={class:"w-full text-[11px]"},Pt={class:"py-1.5"},At={class:"font-medium"},It={class:"text-[9px] text-gray-600"},Vt={key:0,class:"text-[9px] font-medium text-gray-600"},Dt={class:"py-1.5 text-right"},Lt={class:"py-1.5 text-right"},Mt={class:"py-1.5 text-right font-medium"},Ht={class:"text-sm space-y-2 mb-6"},Gt={class:"flex justify-between"},qt={key:0,class:"flex justify-between"},Ft={class:"flex justify-between font-bold border-t border-gray-200 pt-2"},Ut={class:"flex justify-between"},Ot={class:"flex justify-between font-medium"};function Rt(d,e,a,r,p,m){var x,w,C,k;return c(),u("div",pt,[e[9]||(e[9]=t("div",{class:"text-center mb-8"},[t("img",{src:"/images/icon-192x192.png",alt:"Allure Spa Logo",class:"w-16 h-16 mx-auto mb-4 object-contain"}),t("h1",{class:"text-2xl font-bold tracking-wider mb-2 text-gray-800"},"ALLURE SPA"),t("p",{class:"text-sm leading-relaxed text-gray-600"},[A(" 720A Điện Biên Phủ, P. 22, Bình Thạnh, HCM"),t("br"),A(" ĐT: (84) 986 910 920 ")])],-1)),t("div",ht,[e[0]||(e[0]=t("h2",{class:"text-xl font-bold mb-3 tracking-wide text-gray-800"},"HÓA ĐƠN THANH TOÁN",-1)),t("div",vt,[t("p",_t,"#"+s(a.invoice.id),1),t("p",null,s(m.formatDateTime(a.invoice.created_at)),1)])]),t("div",wt,[t("div",Ct,[t("div",Tt,[e[1]||(e[1]=t("span",{class:"font-medium"},"Khách hàng:",-1)),t("span",null,s((x=a.invoice.user)==null?void 0:x.full_name),1)]),t("div",Nt,[e[2]||(e[2]=t("span",{class:"font-medium"},"Số điện thoại:",-1)),t("span",null,s((w=a.invoice.user)==null?void 0:w.phone_number),1)])])]),t("div",St,[t("table",jt,[e[3]||(e[3]=t("thead",null,[t("tr",{class:"border-b border-gray-300"},[t("th",{class:"py-2 text-left font-bold"},"SP/DV"),t("th",{class:"py-2 text-right font-bold"},"SL"),t("th",{class:"py-2 text-right font-bold"},"Đơn giá"),t("th",{class:"py-2 text-right font-bold"},"T.Tiền")])],-1)),t("tbody",null,[(c(!0),u(E,null,X((C=a.invoice.order)==null?void 0:C.order_items,g=>(c(),u("tr",{key:g.id,class:"border-b border-gray-100"},[t("td",Pt,[t("div",At,s(m.getItemName(g)),1),t("div",It,s(m.getItemCode(g)),1),g.service_type?(c(),u("div",Vt,s(m.formatServiceType(g.service_type)),1)):y("",!0)]),t("td",Dt,s(g.quantity),1),t("td",Lt,s(m.formatCurrency(g.price)),1),t("td",Mt,s(m.formatCurrency(g.price*g.quantity)),1)]))),128))])])]),t("div",Ht,[t("div",Gt,[e[4]||(e[4]=t("span",null,"Tổng tiền hàng:",-1)),t("span",null,s(m.formatCurrency(r.subtotalAmount)),1)]),(k=a.invoice.order)!=null&&k.discount_amount?(c(),u("div",qt,[e[5]||(e[5]=t("span",null,"Giảm giá:",-1)),t("span",null,"-"+s(m.formatCurrency(a.invoice.order.discount_amount)),1)])):y("",!0),t("div",Ft,[e[6]||(e[6]=t("span",null,"Tổng thanh toán:",-1)),t("span",null,s(m.formatCurrency(a.invoice.total_amount)),1)]),t("div",Ut,[e[7]||(e[7]=t("span",null,"Đã thanh toán:",-1)),t("span",null,s(m.formatCurrency(a.invoice.paid_amount)),1)]),t("div",Ot,[e[8]||(e[8]=t("span",null,"Còn lại:",-1)),t("span",null,s(m.formatCurrency(a.invoice.remaining_amount)),1)])]),e[10]||(e[10]=ut('<div class="mt-10 text-center space-y-3 border-t-2 border-gray-200 pt-6" data-v-532301e1><p class="font-medium text-gray-800 text-base" data-v-532301e1>Cảm ơn quý khách đã sử dụng dịch vụ!</p><div class="text-sm text-gray-600 space-y-1.5" data-v-532301e1><p class="font-medium" data-v-532301e1>Hotline: (84) 986 910 920</p><p class="font-medium" data-v-532301e1>Website: www.allurespa.com.vn</p></div></div>',1))])}const Bt=Z(kt,[["render",Rt],["__scopeId","data-v-532301e1"]]),Kt={components:{Head:ot,Link:dt,LayoutAuthenticated:lt,SectionMain:ct,PrintInvoiceTemplate:Bt},props:{invoice:{type:Object,required:!0}},setup(d){const e=v(0),a=v("cash"),r=v(""),p=v(!1),m=v("partial"),x=ft();R(m,n=>{n==="full"?e.value=d.invoice.remaining_amount:e.value=0}),R(e,n=>{n>d.invoice.remaining_amount&&(e.value=d.invoice.remaining_amount)});const w=n=>{m.value=n,n==="full"?e.value=d.invoice.remaining_amount:e.value=0},C=n=>({cash:"Tiền mặt",bank_transfer:"Chuyển khoản",card:"Thẻ"})[n]||n,k=v(null),g=async()=>{try{if(await yt(),!k.value){x.error("Không tìm thấy template hóa đơn!");return}const n=k.value.$el,o=document.createElement("div");o.appendChild(n.cloneNode(!0)),document.body.appendChild(o);const l={margin:5,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,width:302},jsPDF:{unit:"mm",format:[80,297],orientation:"portrait"}};bt().set(l).from(o.firstChild).outputPdf("blob").then(b=>{const S=URL.createObjectURL(b),j=window.open(S,"_blank","width=800,height=600");j?(j.onload=()=>{j.print()},j.onbeforeunload=()=>{URL.revokeObjectURL(S),document.body.removeChild(o)}):(x.error("Vui lòng cho phép popup để in hóa đơn!"),URL.revokeObjectURL(S),document.body.removeChild(o))}).catch(b=>{console.error("PDF generation error:",b),x.error("Có lỗi khi tạo PDF. Vui lòng thử lại!"),document.body.removeChild(o)})}catch(n){console.error("Print process error:",n),x.error("Có lỗi xảy ra. Vui lòng thử lại!")}},h=async()=>{var n,o;p.value=!0;try{const l=await Q.post(`/invoices/${d.invoice.id}/process-payment`,{payment_amount:e.value,payment_method:a.value,note:r.value,payment_proof:null});x.success("Đã cập nhật thanh toán cho hóa đơn"),l.data.data.status==="paid"&&x.success("Hóa đơn đã được thanh toán đầy đủ"),W.reload({only:["invoice"]}),e.value=0,r.value=""}catch(l){console.error("Payment processing error:",l),x.error(((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"Có lỗi xảy ra khi xử lý thanh toán")}finally{p.value=!1}},D=()=>{var n,o,l;return(l=(o=(n=d.invoice)==null?void 0:n.order)==null?void 0:o.orderItems)!=null&&l.length?d.invoice.order.orderItems.reduce((b,S)=>{const j=Number(S.price)||0,st=Number(S.quantity)||0;return b+j*st},0):0},I=P(()=>{var n,o,l,b;return(o=(n=d.invoice)==null?void 0:n.order)!=null&&o.total_amount&&((b=(l=d.invoice)==null?void 0:l.order)!=null&&b.discount_amount)?Number(d.invoice.order.total_amount)+Number(d.invoice.order.discount_amount):D()}),f=n=>{const o=Number(n);return isNaN(o)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(o)},T=n=>new Date(n).toLocaleString("vi-VN"),L=n=>{switch(n){case"pending":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800";case"partial":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800";case"paid":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800";case"cancelled":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800";default:return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"}},M=n=>{switch(n){case"pending":return"Chờ thanh toán";case"partial":return"Thanh toán một phần";case"paid":return"Đã thanh toán";case"cancelled":return"Đã hủy";default:return"Không xác định"}},H=P(()=>d.invoice.status!=="paid"&&d.invoice.status!=="cancelled");R(e,n=>{n>d.invoice.remaining_amount&&(e.value=d.invoice.remaining_amount,x.warning("Số tiền không thể lớn hơn số tiền cần thanh toán"))});const G=n=>n.item_name??"Không xác định",i=n=>({single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"})[n]||n,N=n=>({single:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800",combo_5:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",combo_10:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800"})[n]||"",q=n=>n?n.discount_type==="percentage"?`Giảm ${n.discount_value}%`:n.discount_type==="fixed"?`Giảm ${f(n.discount_value)}`:n.description||"":"",F=n=>{if(!n)return"";let o="";return n.discount_type==="percentage"?o=`Giảm ${n.discount_value}% `:n.discount_type==="fixed"&&(o=`Giảm ${f(n.discount_value)} `),n.min_order_amount&&(o+=`cho đơn hàng từ ${f(n.min_order_amount)}`),n.start_date&&n.end_date&&(o+=` (Có hiệu lực: ${T(n.start_date)} - ${T(n.end_date)})`),o||n.description||""},Y=P(()=>{const n=d.invoice.order;if(!(n!=null&&n.voucher_id))return"";const o=Number(n.discount_amount),l=Number(I.value);return o&&l?`Giảm ${(o/l*100).toFixed(1)}% (${f(o)})`:`Giảm ${f(n.discount_amount)}`}),O=v(!1),$=P(()=>d.invoice.status==="pending"||d.invoice.status==="partial"),tt=()=>{O.value=!0},et=async()=>{var n,o;try{const l=await Q.post(`/invoices/${d.invoice.id}/cancel`);x.success("Hóa đơn đã được hủy thành công"),W.reload({only:["invoice"]}),O.value=!1}catch(l){console.error("Cancel invoice error:",l),x.error(((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"Có lỗi xảy ra khi hủy hóa đơn")}},nt=n=>{const o="px-2 py-1 rounded-full text-sm font-medium";return{pending:`${o} bg-yellow-100 text-yellow-800`,processing:`${o} bg-blue-100 text-blue-800`,completed:`${o} bg-green-100 text-green-800`,cancelled:`${o} bg-red-100 text-red-800`}[n]||`${o} bg-gray-100 text-gray-800`},rt=n=>({pending:"Chờ xử lý",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[n]||"Không xác định",at=n=>{var o,l;return n.item_type==="service"?((o=n.service)==null?void 0:o.code)||"-":n.item_type==="product"&&((l=n.product)==null?void 0:l.code)||"-"},z=P({get(){return f(e.value)},set(n){const o=Number(n.replace(/[^0-9.-]+/g,""));e.value=isNaN(o)?0:o}});return{paymentAmount:e,paymentMethod:a,paymentNote:r,processing:p,paymentType:m,selectPaymentType:w,getPaymentMethodText:C,toast:x,formatCurrency:f,formatDateTime:T,getStatusClass:L,getStatusText:M,processPayment:h,printInvoice:g,showPaymentForm:H,getItemName:G,formatServiceType:i,getServiceTypeClass:N,getVoucherDescription:q,subtotalAmount:I,getDetailedVoucherDescription:F,getVoucherInfo:Y,showCancelModal:O,canCancel:$,confirmCancelInvoice:tt,cancelInvoice:et,getOrderStatusClass:nt,getOrderStatusText:rt,getItemCode:at,printTemplateRef:k,formattedPaymentAmount:z,updatePaymentAmount:n=>{z.value=n.target.value}}}},Et={class:"container mx-auto px-4 py-8"},Xt={class:"flex justify-between items-center mb-6"},zt={class:"text-2xl font-semibold text-gray-900 dark:text-dark-text"},Wt={class:"flex space-x-4"},Jt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Qt={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow"},Zt={class:"flex items-center space-x-2"},Yt={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow"},$t={class:"space-y-2"},te={class:"flex justify-between"},ee={class:"font-medium text-gray-900 dark:text-dark-text"},ne={key:0,class:"flex flex-col space-y-1"},re={class:"flex justify-between text-green-600"},ae={class:"font-medium"},se={class:"flex justify-between text-green-600"},oe={class:"font-medium"},de={class:"flex justify-between font-bold border-t border-gray-200 dark:border-dark-border pt-2"},ie={class:"text-gray-900 dark:text-dark-text"},le={class:"flex justify-between"},ce={class:"text-green-600 font-medium"},ue={class:"flex justify-between"},me={class:"text-red-600 font-medium"},xe={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},ge={class:"grid grid-cols-2 gap-6"},ye={class:"space-y-3"},fe={class:"flex justify-between"},be={class:"font-medium text-gray-900 dark:text-dark-text"},ke={class:"flex justify-between"},pe={class:"font-medium text-gray-900 dark:text-dark-text"},he={class:"flex justify-between"},ve={class:"font-medium text-gray-900 dark:text-dark-text"},_e={class:"flex justify-between"},we={class:"font-medium text-gray-900 dark:text-dark-text"},Ce={class:"space-y-3"},Te={class:"flex justify-between"},Ne={class:"font-medium text-gray-900 dark:text-dark-text"},Se={class:"flex justify-between"},je={class:"font-medium text-gray-900 dark:text-dark-text"},Pe={class:"flex justify-between"},Ae={class:"font-medium text-gray-900 dark:text-dark-text"},Ie={class:"flex justify-between"},Ve={class:"font-medium text-gray-900 dark:text-dark-text"},De={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},Le={class:"overflow-x-auto"},Me={class:"min-w-full divide-y divide-gray-200 dark:divide-dark-border"},He={class:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},qe={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"text-sm font-medium text-gray-900 dark:text-dark-text"},Ue={class:"text-xs text-gray-500 dark:text-dark-text-muted"},Oe={key:0,class:"text-sm text-gray-500 dark:text-dark-text-muted"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-dark-text-muted"},Be={class:"px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-dark-text-muted"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900 dark:text-dark-text"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},Xe={class:"bg-gray-50 dark:bg-dark-surface"},ze={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"},We={key:0,class:"bg-gray-50 dark:bg-dark-surface text-green-600"},Je={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"},Qe={class:"bg-gray-100 dark:bg-dark-surface font-bold"},Ze={class:"px-6 py-4 text-right text-gray-900 dark:text-dark-text"},Ye={key:0,class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},$e={class:"mb-4"},tn={class:"flex space-x-4"},en={class:"mt-1 text-sm text-gray-500 dark:text-dark-text-muted"},nn=["disabled"],rn={key:1,class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},an={class:"overflow-x-auto"},sn={class:"min-w-full divide-y divide-gray-200 dark:divide-dark-border"},on={class:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border"},dn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},ln={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-dark-text"},cn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},un={class:"px-6 py-4 whitespace-nowrap"},mn={class:"px-6 py-4 whitespace-nowrap"},xn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},gn={class:"px-6 py-4 text-sm text-gray-500 dark:text-dark-text-muted"},yn={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},fn={class:"flex justify-between items-center mb-4"},bn={key:0,class:"grid grid-cols-2 gap-6"},kn={class:"space-y-3"},pn={class:"flex justify-between"},hn={class:"flex justify-between"},vn={class:"font-medium text-gray-900 dark:text-dark-text"},_n={class:"space-y-3"},wn={class:"flex justify-between"},Cn={class:"font-medium text-gray-900 dark:text-dark-text"},Tn={key:0,class:"flex justify-between text-green-600"},Nn={class:"font-medium"},Sn={key:1,class:"text-center py-4 text-gray-500 dark:text-dark-text-muted"},jn={class:"print-container",style:{display:"none"}},Pn={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},An={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow-lg max-w-md w-full"},In={class:"flex justify-end space-x-4"};function Vn(d,e,a,r,p,m){const x=V("Head"),w=V("Link"),C=V("PrintInvoiceTemplate"),k=V("SectionMain"),g=V("LayoutAuthenticated");return c(),u("div",null,[U(g,null,{default:B(()=>[U(x,{title:"Chi tiết hóa đơn"}),U(k,{breadcrumbs:[{label:"Quản lý hóa đơn",href:d.route("invoices.index")},{label:`Hóa đơn #${a.invoice.id}`}]},{default:B(()=>{var h,D,I,f,T,L,M,H,G;return[t("div",Et,[t("div",Xt,[t("h1",zt,"Chi tiết hóa đơn #"+s(a.invoice.id),1),t("div",Wt,[t("button",{onClick:e[0]||(e[0]=(...i)=>r.printInvoice&&r.printInvoice(...i)),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded flex items-center"},e[11]||(e[11]=[t("i",{class:"fas fa-print mr-2"},null,-1),A(" In hóa đơn ")])),r.canCancel?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...i)=>r.confirmCancelInvoice&&r.confirmCancelInvoice(...i)),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex items-center"},e[12]||(e[12]=[t("i",{class:"fas fa-times mr-2"},null,-1),A(" Hủy hóa đơn ")]))):y("",!0)])]),t("div",Jt,[t("div",Qt,[e[13]||(e[13]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Trạng thái hóa đơn",-1)),t("div",Zt,[t("span",{class:_([r.getStatusClass(a.invoice.status),"px-3 py-1 rounded-full text-sm"])},s(r.getStatusText(a.invoice.status)),3)])]),t("div",Yt,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thông tin thanh toán",-1)),t("div",$t,[t("div",te,[e[14]||(e[14]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền hàng:",-1)),t("span",ee,s(r.formatCurrency(r.subtotalAmount)),1)]),(h=a.invoice.order)!=null&&h.voucher_id?(c(),u("div",ne,[t("div",re,[e[15]||(e[15]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-ticket-alt mr-2"}),A(" Voucher áp dụng: ")],-1)),t("span",ae,s(r.getVoucherInfo),1)]),t("div",se,[e[16]||(e[16]=t("span",null,"Giảm giá:",-1)),t("span",oe,"-"+s(r.formatCurrency(a.invoice.order.discount_amount)),1)])])):y("",!0),t("div",de,[e[17]||(e[17]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền sau giảm giá:",-1)),t("span",ie,s(r.formatCurrency(a.invoice.total_amount)),1)]),t("div",le,[e[18]||(e[18]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Đã thanh toán:",-1)),t("span",ce,s(r.formatCurrency(a.invoice.paid_amount)),1)]),t("div",ue,[e[19]||(e[19]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Còn lại:",-1)),t("span",me,s(r.formatCurrency(a.invoice.remaining_amount)),1)])])])]),t("div",xe,[e[29]||(e[29]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thông tin chi tiết",-1)),t("div",ge,[t("div",ye,[t("div",fe,[e[21]||(e[21]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Mã hóa đơn:",-1)),t("span",be,"#"+s(a.invoice.id),1)]),t("div",ke,[e[22]||(e[22]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ngày tạo:",-1)),t("span",pe,s(r.formatDateTime(a.invoice.created_at)),1)]),t("div",he,[e[23]||(e[23]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Người tạo:",-1)),t("span",ve,s(((D=a.invoice.created_by)==null?void 0:D.full_name)||"N/A"),1)]),t("div",_e,[e[24]||(e[24]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ghi chú:",-1)),t("span",we,s(a.invoice.note||"-"),1)])]),t("div",Ce,[t("div",Te,[e[25]||(e[25]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Khách hàng:",-1)),t("span",Ne,s((I=a.invoice.user)==null?void 0:I.full_name),1)]),t("div",Se,[e[26]||(e[26]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Số điện thoại:",-1)),t("span",je,s((f=a.invoice.user)==null?void 0:f.phone_number),1)]),t("div",Pe,[e[27]||(e[27]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Email:",-1)),t("span",Ae,s(((T=a.invoice.user)==null?void 0:T.email)||"-"),1)]),t("div",Ie,[e[28]||(e[28]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Địa chỉ:",-1)),t("span",Ve,s(((L=a.invoice.user)==null?void 0:L.address)||"-"),1)])])])]),t("div",De,[e[37]||(e[37]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Chi tiết đơn hàng",-1)),t("div",Le,[t("table",Me,[e[36]||(e[36]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," STT "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Sản phẩm/Dịch vụ "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-right text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Đơn giá "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-center text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Số lượng "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-right text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Thành tiền "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",He,[(c(!0),u(E,null,X((M=a.invoice.order)==null?void 0:M.order_items,(i,N)=>{var q,F;return c(),u("tr",{key:i.id},[t("td",Ge,s(N+1),1),t("td",qe,[t("div",Fe,s(i.item_name),1),t("div",Ue," Mã sản phẩm/dịch vụ: "+s(((q=i.service)==null?void 0:q.id)||((F=i.product)==null?void 0:F.id)||"-"),1),i.description?(c(),u("div",Oe,s(i.description),1)):y("",!0)]),t("td",Re,s(r.formatCurrency(Number(i.price)||0)),1),t("td",Be,s(Number(i.quantity)||0),1),t("td",Ke,s(r.formatCurrency((Number(i.price)||0)*(Number(i.quantity)||0))),1),t("td",Ee,[i.service_type?(c(),u("span",{key:0,class:_(r.getServiceTypeClass(i.service_type))},s(r.formatServiceType(i.service_type)),3)):y("",!0)])])}),128)),t("tr",Xe,[e[30]||(e[30]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"}," Tổng tiền hàng: ",-1)),t("td",ze,s(r.formatCurrency(r.subtotalAmount)),1),e[31]||(e[31]=t("td",null,null,-1))]),(H=a.invoice.order)!=null&&H.discount_amount?(c(),u("tr",We,[e[32]||(e[32]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"}," Giảm giá: ",-1)),t("td",Je," -"+s(r.formatCurrency(a.invoice.order.discount_amount)),1),e[33]||(e[33]=t("td",null,null,-1))])):y("",!0),t("tr",Qe,[e[34]||(e[34]=t("td",{colspan:"4",class:"px-6 py-4 text-right text-gray-900 dark:text-dark-text"}," Tổng tiền thanh toán: ",-1)),t("td",Ze,s(r.formatCurrency(a.invoice.total_amount)),1),e[35]||(e[35]=t("td",null,null,-1))])])])])]),r.showPaymentForm?(c(),u("div",Ye,[e[43]||(e[43]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thanh toán",-1)),t("form",{onSubmit:e[8]||(e[8]=mt((...i)=>r.processPayment&&r.processPayment(...i),["prevent"])),class:"space-y-4"},[t("div",$e,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted mb-2"},"Hình thức thanh toán",-1)),t("div",tn,[t("button",{type:"button",onClick:e[2]||(e[2]=i=>r.selectPaymentType("full")),class:_(["px-4 py-2 rounded-md",r.paymentType==="full"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-dark-surface text-gray-700 dark:text-dark-text-muted hover:bg-gray-200 dark:hover:bg-dark-hover"])}," Thanh toán tất cả ("+s(r.formatCurrency(a.invoice.remaining_amount))+") ",3),t("button",{type:"button",onClick:e[3]||(e[3]=i=>r.selectPaymentType("partial")),class:_(["px-4 py-2 rounded-md",r.paymentType==="partial"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-dark-surface text-gray-700 dark:text-dark-text-muted hover:bg-gray-200 dark:hover:bg-dark-hover"])}," Thanh toán một phần ",2)])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"},"Số tiền thanh toán",-1)),K(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=i=>r.formattedPaymentAmount=i),onInput:e[5]||(e[5]=(...i)=>r.updatePaymentAmount&&r.updatePaymentAmount(...i)),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",required:""},null,544),[[J,r.formattedPaymentAmount]]),t("p",en," Số tiền còn lại cần thanh toán: "+s(r.formatCurrency(a.invoice.remaining_amount)),1)]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"},"Phương thức thanh toán",-1)),K(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.paymentMethod=i),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",required:""},e[40]||(e[40]=[t("option",{value:"cash"},"Tiền mặt",-1),t("option",{value:"bank_transfer"},"Chuyển khoản",-1),t("option",{value:"card"},"Thẻ",-1)]),512),[[xt,r.paymentMethod]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"},"Ghi chú",-1)),K(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.paymentNote=i),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",rows:"2"},null,512),[[J,r.paymentNote]])]),t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors dark:bg-green-600 dark:hover:bg-green-700",disabled:r.processing},s(r.processing?"Đang xử lý...":"Xác nhận thanh toán"),9,nn)],32)])):y("",!0),((G=a.invoice.payment_histories)==null?void 0:G.length)>0?(c(),u("div",rn,[e[45]||(e[45]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Lịch sử thanh toán",-1)),t("div",an,[t("table",sn,[e[44]||(e[44]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Thời gian "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Số tiền "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Phương thức "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Trạng thái cũ "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Trạng thái mới "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Người thực hiện "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",on,[(c(!0),u(E,null,X(a.invoice.payment_histories,i=>{var N;return c(),u("tr",{key:i.id},[t("td",dn,s(r.formatDateTime(i.created_at)),1),t("td",ln,s(r.formatCurrency(i.payment_amount)),1),t("td",cn,s(r.getPaymentMethodText(i.payment_method)),1),t("td",un,[t("span",{class:_(r.getStatusClass(i.old_payment_status))},s(r.getStatusText(i.old_payment_status)),3)]),t("td",mn,[t("span",{class:_(r.getStatusClass(i.new_payment_status))},s(r.getStatusText(i.new_payment_status)),3)]),t("td",xn,s(((N=i.created_by)==null?void 0:N.full_name)||"N/A"),1),t("td",gn,s(i.note||"-"),1)])}),128))])])])])):y("",!0),t("div",yn,[t("div",fn,[e[47]||(e[47]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-dark-text"},"Thông tin đơn hàng",-1)),a.invoice.order?(c(),gt(w,{key:0,href:d.route("orders.show",a.invoice.order.id),class:"bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg flex items-center transition-colors dark:bg-blue-900 dark:hover:bg-blue-800 dark:text-blue-100"},{default:B(()=>[e[46]||(e[46]=t("i",{class:"mdi mdi-shopping-outline mr-2"},null,-1)),A(" Xem đơn hàng #"+s(a.invoice.order.id),1)]),_:1},8,["href"])):y("",!0)]),a.invoice.order?(c(),u("div",bn,[t("div",kn,[t("div",pn,[e[48]||(e[48]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Trạng thái đơn hàng:",-1)),t("span",{class:_(r.getOrderStatusClass(a.invoice.order.status))},s(r.getOrderStatusText(a.invoice.order.status)),3)]),t("div",hn,[e[49]||(e[49]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ngày tạo đơn:",-1)),t("span",vn,s(r.formatDateTime(a.invoice.order.created_at)),1)])]),t("div",_n,[t("div",wn,[e[50]||(e[50]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền hàng:",-1)),t("span",Cn,s(r.formatCurrency(a.invoice.order.total_amount)),1)]),a.invoice.order.discount_amount>0?(c(),u("div",Tn,[e[51]||(e[51]=t("span",null,"Giảm giá:",-1)),t("span",Nn,"-"+s(r.formatCurrency(a.invoice.order.discount_amount)),1)])):y("",!0)])])):(c(),u("div",Sn," Hóa đơn này không liên kết với đơn hàng nào "))])]),t("div",jn,[U(C,{ref:"printTemplateRef",invoice:a.invoice,style:{visibility:"visible !important"}},null,8,["invoice"])])]}),_:1},8,["breadcrumbs"])]),_:1}),r.showCancelModal?(c(),u("div",Pn,[t("div",An,[e[52]||(e[52]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Xác nhận hủy hóa đơn",-1)),e[53]||(e[53]=t("p",{class:"mb-4 text-gray-600 dark:text-dark-text-muted"},"Bạn có chắc chắn muốn hủy hóa đơn này? Hành động này không thể hoàn tác.",-1)),t("div",In,[t("button",{onClick:e[9]||(e[9]=h=>r.showCancelModal=!1),class:"px-4 py-2 bg-gray-300 dark:bg-dark-surface hover:bg-gray-400 dark:hover:bg-dark-hover rounded"}," Đóng "),t("button",{onClick:e[10]||(e[10]=(...h)=>r.cancelInvoice&&r.cancelInvoice(...h)),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded"}," Xác nhận hủy ")])])])):y("",!0)])}const wr=Z(Kt,[["render",Vn]]);export{wr as default};
