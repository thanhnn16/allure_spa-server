import{Q as K,Z as w,F as B}from"./@inertiajs-D0DMCEQB.js";import{F as V,i as G,a as P,b as R,c as U}from"./@fullcalendar-DDjvMyrQ.js";import{L as W}from"./LayoutAuthenticated-CdnDO2EJ.js";import{_ as z}from"./SectionMain-BbIPmLtw.js";import A from"./AddAppointmentModal-CXEswjlU.js";import{a as O}from"./axios-CCb-kr4I.js";import{t as Z}from"./tippy.js-CTHk8NJp.js";import{u as j}from"./vue-toastification-ejyjJRED.js";import{r as d,e as Q,c as S,aU as b,a0 as X,bH as T,aa as f,bl as $,a3 as c,a2 as q,b0 as J,aI as Y,bf as tt,F as et}from"./@vue-BRgAy5zV.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./preact-CD9qK7CG.js";import"./@mdi-B8rJ_oIP.js";import"./app-CvvPeK5O.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./@popperjs-CvwSYPO-.js";const at={class:"mb-4 flex items-center gap-4 p-4 bg-white dark:bg-slate-800 rounded-lg shadow"},st={class:"flex gap-4"},rt={class:"calendar-container bg-white dark:bg-slate-800 rounded-lg shadow p-4"},qt={__name:"CalendarView",props:{appointments:{type:Array,default:()=>[]},timeSlots:{type:Array,default:()=>[]},slotDuration:{type:String,default:"01:00:00"},slotMinTime:{type:String,default:"08:00:00"},slotMaxTime:{type:String,default:"18:30:00"}},setup(k){const i=k;K();const h=d(!1),D=d(null);d(!1);const u=d(null),m=d(i.appointments);Q(()=>i.appointments,t=>{m.value=t},{deep:!0});const N=S(()=>m.value.map(t=>{var a,e,r,s,o;return{id:t.id,title:`${((a=t.user)==null?void 0:a.full_name)||"Không xác định"} - ${((e=t.service)==null?void 0:e.name)||"Không xác định"}`,start:t.start,end:t.end,className:`status-${t.status.toLowerCase()}`,extendedProps:{userId:t.user_id,serviceId:t.service_id,staffId:t.staff_user_id,appointmentType:t.appointment_type,status:t.status,timeSlotId:t.time_slot_id,userName:(r=t.user)==null?void 0:r.full_name,serviceName:(s=t.service)==null?void 0:s.name,staffName:(o=t.staff)==null?void 0:o.full_name,cancelledBy:t.cancelled_by,cancelledAt:t.cancelled_at,cancellationNote:t.cancellation_note,cancelledByUser:t.cancelled_by_user}}})),M=S(()=>({plugins:[G,P,R,U],initialView:"timeGridWeek",weekends:!0,events:N.value,locale:"vi",firstDay:1,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"Hôm nay",month:"Tháng",week:"Tuần",day:"Ngày",list:"Danh sách"},allDaySlot:!1,height:"auto",nowIndicator:!0,editable:!0,selectable:!0,eventResizableFromStart:!1,eventDurationEditable:!1,slotDuration:i.slotDuration,snapDuration:i.slotDuration,slotLabelInterval:i.slotDuration,slotMinTime:i.slotMinTime,slotMaxTime:i.slotMaxTime,slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"},moreLinkText:"Xem thêm",noEventsText:"Không có lịch hẹn nào",select:C,eventDidMount:t=>{var s;const e=t.event.extendedProps;let r=`
            <div class="p-2">
                <div class="font-bold">${e.userName||"Không xác định"}</div>
                <div>Dịch vụ: ${e.serviceName||"Không xác định"}</div>
                <div>Nhân viên: ${e.staffName||"Không xác định"}</div>
                <div>Trạng thái: ${e.status}</div>
        `;e.status==="cancelled"&&(r+=`
                <div class="mt-2 pt-2 border-t">
                    <div>Hủy bởi: ${((s=e.cancelledByUser)==null?void 0:s.full_name)||"Không xác định"}</div>
                    <div>Thời gian hủy: ${F(e.cancelledAt)}</div>
                    ${e.cancellationNote?`<div>Lý do: ${e.cancellationNote}</div>`:""}
                </div>
            `),r+="</div>",Z(t.el,{content:r,allowHTML:!0,placement:"top",theme:"light-border",delay:[200,0],interactive:!0})},eventClick:t=>{t.jsEvent.preventDefault(),B.visit(`/appointments/${t.event.id}`)},eventDrop:I,eventMaxStack:2,eventClassNames:t=>[`${t.event.extendedProps.status.toLowerCase()}-event`,"calendar-event"],themeSystem:"standard",views:{timeGrid:{dayMaxEvents:2,nowIndicator:!0,eventMinHeight:30}}})),g=d(null);function C(t){const a=new Date(t.start),e=a.getHours().toString().padStart(2,"0"),r=a.getMinutes().toString().padStart(2,"0"),s=i.timeSlots.find(o=>{const n=o.start_time.substring(0,5),p=`${e}:${r}`;return n===p});if(!s){v.error("Vui lòng chọn đúng khung giờ");return}if(s.current_bookings>=s.max_bookings){v.error("Khung giờ này đã đầy");return}g.value={date:t.startStr.split("T")[0],timeSlotId:s.id,startTime:s.start_time,endTime:s.end_time},h.value=!0}function I(t){const a=t.event,e=new Date(a.start),r=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),o=`${r}:${s}:00`,n=i.timeSlots.find(l=>l.start_time===o);if(!n){v.error("Vui lòng chọn khung giờ hợp lệ"),t.revert();return}const p={appointment_date:a.start.toISOString().split("T")[0],time_slot_id:n.id};O.put(`/api/appointments/${a.id}`,p).then(l=>{if(l.status===200)v.success(l.data.message);else throw new Error(l.data.message||"Có lỗi xảy ra")}).catch(l=>{var y,x;console.error("Error:",l),v.error(((x=(y=l.response)==null?void 0:y.data)==null?void 0:x.message)||"Có lỗi xảy ra khi cập nhật lịch hẹn!"),u.value&&u.value.getApi().refetchEvents(),t.revert()})}function _(){h.value=!1,D.value=null}const v=j();function L(t){var e,r,s,o,n;if(!t||!t.time_slot){console.error("Invalid appointment data:",t);return}const a={...t,id:t.id,title:`${((e=t.user)==null?void 0:e.full_name)||"N/A"} - ${((r=t.service)==null?void 0:r.name)||"N/A"}`,start:`${t.appointment_date} ${t.time_slot.start_time}`,end:`${t.appointment_date} ${t.time_slot.end_time}`,extendedProps:{userId:t.user_id,serviceId:t.service_id,staffId:t.staff_id,appointmentType:t.appointment_type,status:t.status,timeSlotId:t.time_slot_id,userName:(s=t.user)==null?void 0:s.full_name,serviceName:(o=t.service)==null?void 0:o.name,staffName:(n=t.staff)==null?void 0:n.full_name}};m.value=[...m.value,a],u.value&&u.value.getApi().refetchEvents()}const E=[{status:"Đang chờ",class:"status-pending",color:"#fbbf24"},{status:"Đã xác nhận",class:"status-confirmed",color:"#34d399"},{status:"Đã hủy",class:"status-cancelled",color:"#ef4444"},{status:"Hoàn thành",class:"status-completed",color:"#3b82f6"}],H=d(!0);function F(t){if(!t)return"N/A";const a=new Date(t);return new Intl.DateTimeFormat("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)}return(t,a)=>(b(),X(W,null,{default:T(()=>[f($(w),{title:"Lịch hẹn"}),f(z,{"is-aside-lg-active":H.value},{default:T(()=>[c("div",at,[a[0]||(a[0]=c("span",{class:"font-semibold dark:text-slate-200"},"Trạng thái:",-1)),c("div",st,[(b(),q(et,null,J(E,e=>c("div",{key:e.status,class:"flex items-center gap-2 dark:text-slate-300"},[c("div",{class:"w-4 h-4 rounded",style:Y({backgroundColor:e.color})},null,4),c("span",null,tt(e.status),1)])),64))])]),c("div",rt,[f($(V),{ref_key:"calendarRef",ref:u,options:M.value,class:"custom-calendar"},null,8,["options"])])]),_:1},8,["is-aside-lg-active"]),f(A,{show:h.value,appointments:m.value,selectedTimeSlot:g.value,onClose:_,onAppointmentAdded:L,closeModal:_},null,8,["show","appointments","selectedTimeSlot"])]),_:1}))}};export{qt as default};
