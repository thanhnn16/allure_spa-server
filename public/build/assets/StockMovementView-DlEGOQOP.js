import{r as h,c as P,aU as g,a0 as A,bH as r,aa as o,bl as n,a3 as l,bJ as C,bB as L,bM as E,bA as R,a2 as y,b0 as G,bf as f,j as W,F as U,a9 as q,a1 as Y}from"./@vue-BRgAy5zV.js";import{Z as ee,F as b}from"./@inertiajs-D0DMCEQB.js";import{L as te}from"./LayoutAuthenticated-BBAlSYbr.js";import{_ as le}from"./SectionMain-Vot1TOkK.js";import{_ as S}from"./CardBox-jfYP3QDG.js";import{_ as D}from"./BaseButtons-B17KSMwc.js";import{_ as c}from"./BaseButton-eMTGofBM.js";import{_ as u}from"./FormField-Da_P6kO8.js";import{_ as i}from"./FormControl-BSsARiYM.js";import{aN as oe,H as ae,aO as re,aP as se,ay as j,b as B}from"./@mdi-ArhfA4cU.js";import{u as ne}from"./vue-toastification-ejyjJRED.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./app-BdM1Db11.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./main-BNmBi4-k.js";const ie={class:"flex flex-col md:flex-row justify-between items-center gap-4"},de={class:"mt-6 p-4 bg-white rounded-lg border border-gray-100 shadow-sm"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ce={class:"mt-4 flex justify-end space-x-2"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ve={class:"flex justify-between items-center mb-4"},fe={class:"flex justify-between items-center mb-4"},he={class:"mb-4"},ge={class:"flex justify-between items-center"},be={class:"relative"},ye={class:"overflow-x-auto"},xe={class:"w-full"},ke={class:"text-right"},Ve={class:"text-right"},_e={class:"text-sm text-gray-600 max-w-md truncate"},we={key:1},Me={class:"mt-4 flex items-center justify-between"},Ce={class:"text-sm text-gray-600"},Se={class:"flex space-x-2"},$e={key:1,class:"px-2 py-1"},Ne={__name:"StockMovementView",props:{products:{type:Array,default:()=>[]},stockMovements:{type:Object,default:()=>({data:[],from:0,to:0,total:0,current_page:1,last_page:1,prev_page_url:null,next_page_url:null})}},setup(s){const $=s,k=a=>({product_id:"",quantity:"",type:{value:a,label:a==="in"?"Nhập kho":"Xuất kho"},reason:"",reference_number:"",note:""}),p=h({start_date:"",end_date:"",product_id:"",type:""}),V=h(!1),v=h({}),_=h(!1),N=h(""),w=h(!0),M=h(!0),d=h(k("in")),m=h(k("out")),F=ne(),T=P(()=>$.products.map(a=>({...a,label:`${a.name} (${I(a.price||0)} - Tồn: ${a.quantity})`,value:a.id}))),I=a=>!a||isNaN(a)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),Q=a=>{try{const e=JSON.parse(a);return[e.reason&&`Lý do: ${e.reason}`,e.reference&&`Tham chiếu: ${e.reference}`,e.comment&&`Ghi chú: ${e.comment}`,e.user&&`Người tạo: ${e.user}`].filter(Boolean).join(" | ")}catch{return a||""}},X=async a=>{_.value=!0;try{const e=a==="in"?d.value:m.value,t={product_id:e.product_id.value||e.product_id,quantity:e.quantity,type:e.type.value,reason:e.reason,reference_number:e.reference_number,note:e.note};b.post(route("stock-movements.store"),t,{onSuccess:()=>{F.success("Tạo phiếu kho thành công"),a==="in"?d.value=k("in"):m.value=k("out"),b.visit(route("stock-movements.index"),{preserveScroll:!0,preserveState:!1})},onError:x=>{F.error(x.message||"Có lỗi xảy ra")}})}catch(e){F.error(e.message||"Có lỗi xảy ra")}finally{_.value=!1}},H=()=>{b.get(route("stock-movements.index"),p.value,{preserveState:!0,preserveScroll:!0})},z=()=>{p.value={start_date:"",end_date:"",product_id:"",type:""},H()},J=()=>{window.open(route("stock-movements.export",p.value))},K=[{value:"in",label:"Nhập kho"},{value:"out",label:"Xuất kho"}],Z=a=>new Date(a).toLocaleString("vi-VN"),O=P(()=>$.stockMovements.data?$.stockMovements.data.filter(a=>{var t,x;const e=N.value.toLowerCase();return a.product.name.toLowerCase().includes(e)||((t=a.note)==null?void 0:t.toLowerCase().includes(e))||((x=a.reference_number)==null?void 0:x.toLowerCase().includes(e))}):[]);return(a,e)=>(g(),A(te,null,{default:r(()=>[o(n(ee),{title:"Quản lý kho"}),o(le,null,{default:r(()=>[o(S,{class:"mb-6"},{default:r(()=>[l("div",ie,[e[23]||(e[23]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-800"},"Quản lý nhập xuất kho"),l("p",{class:"text-gray-600 mt-1"},"Theo dõi và quản lý các hoạt động nhập xuất kho")],-1)),o(D,null,{default:r(()=>[o(c,{color:"info",icon:V.value?n(oe):n(ae),onClick:e[0]||(e[0]=t=>V.value=!V.value),class:"hover:shadow-lg transition-all",label:"Bộ lọc"},null,8,["icon"]),o(c,{color:"success",icon:n(re),onClick:J,class:"hover:shadow-lg transition-all",label:"Xuất Excel"},null,8,["icon"]),o(c,{color:"info",icon:n(se),onClick:e[1]||(e[1]=t=>n(b).get(a.route("reports.stock"))),class:"hover:shadow-lg transition-all",label:"Báo cáo"},null,8,["icon"])]),_:1})]),C(l("div",de,[l("div",me,[o(u,{label:"Từ ngày"},{default:r(()=>[o(i,{modelValue:p.value.start_date,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value.start_date=t),type:"date"},null,8,["modelValue"])]),_:1}),o(u,{label:"Đến ngày"},{default:r(()=>[o(i,{modelValue:p.value.end_date,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value.end_date=t),type:"date"},null,8,["modelValue"])]),_:1}),o(u,{label:"Sản phẩm"},{default:r(()=>[o(i,{modelValue:p.value.product_id,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value.product_id=t),type:"select",options:T.value,placeholder:"Tất cả sản phẩm"},null,8,["modelValue","options"])]),_:1}),o(u,{label:"Loại"},{default:r(()=>[o(i,{modelValue:p.value.type,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value.type=t),type:"select",options:K,placeholder:"Tất cả"},null,8,["modelValue"])]),_:1})]),l("div",ce,[o(c,{color:"danger",onClick:z,label:"Xóa lọc"}),o(c,{color:"info",onClick:H,label:"Áp dụng"})])],512),[[L,V.value]])]),_:1}),l("div",pe,[o(S,{class:"hover:shadow-lg transition-all"},{default:r(()=>[l("div",ve,[e[24]||(e[24]=l("div",null,[l("h2",{class:"text-lg font-semibold text-gray-800"},"Nhập kho"),l("p",{class:"text-gray-600 text-sm"},"Tạo phiếu nhập kho mới")],-1)),o(c,{onClick:e[6]||(e[6]=t=>w.value=!w.value),icon:w.value?n(j):n(B),color:"info",small:""},null,8,["icon"])]),C(l("form",{onSubmit:e[12]||(e[12]=E(t=>X("in"),["prevent"])),class:"space-y-4"},[o(u,{label:"Sản phẩm",error:v.value.product_id},{default:r(()=>[o(i,{modelValue:d.value.product_id,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value.product_id=t),type:"select",options:T.value,placeholder:"Chọn sản phẩm cần nhập kho"},null,8,["modelValue","options"])]),_:1},8,["error"]),o(u,{label:"Số lượng",error:v.value.quantity},{default:r(()=>[o(i,{modelValue:d.value.quantity,"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.quantity=t),type:"number",min:"1",placeholder:"Nhập số lượng sản phẩm"},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Lý do",error:v.value.reason},{default:r(()=>[o(i,{modelValue:d.value.reason,"onUpdate:modelValue":e[9]||(e[9]=t=>d.value.reason=t),placeholder:"VD: Nhập hàng từ nhà cung cấp, Điều chỉnh tồn kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Số tham chiếu",error:v.value.reference_number},{default:r(()=>[o(i,{modelValue:d.value.reference_number,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.reference_number=t),placeholder:"VD: Số hóa đơn, số PO, số phiếu nhập kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Ghi chú",error:v.value.note},{default:r(()=>[o(i,{modelValue:d.value.note,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value.note=t),type:"textarea",rows:"3",placeholder:"Thông tin bổ sung về đợt nhập kho này..."},null,8,["modelValue"])]),_:1},8,["error"]),o(D,null,{default:r(()=>[o(c,{type:"submit",color:"info",loading:_.value,icon:n(B),label:"Nhập kho"},null,8,["loading","icon"])]),_:1})],544),[[L,w.value]])]),_:1}),o(S,{class:"hover:shadow-lg transition-all"},{default:r(()=>[l("div",fe,[e[25]||(e[25]=l("div",null,[l("h2",{class:"text-lg font-semibold text-gray-800"},"Xuất kho"),l("p",{class:"text-gray-600 text-sm"},"Tạo phiếu xuất kho mới")],-1)),o(c,{onClick:e[13]||(e[13]=t=>M.value=!M.value),icon:M.value?n(j):n(B),color:"danger",small:""},null,8,["icon"])]),C(l("form",{onSubmit:e[19]||(e[19]=E(t=>X("out"),["prevent"])),class:"space-y-4"},[o(u,{label:"Sản phẩm",error:v.value.product_id},{default:r(()=>[o(i,{modelValue:m.value.product_id,"onUpdate:modelValue":e[14]||(e[14]=t=>m.value.product_id=t),type:"select",options:T.value,placeholder:"Chọn sản phẩm cần xuất kho"},null,8,["modelValue","options"])]),_:1},8,["error"]),o(u,{label:"Số lượng",error:v.value.quantity},{default:r(()=>[o(i,{modelValue:m.value.quantity,"onUpdate:modelValue":e[15]||(e[15]=t=>m.value.quantity=t),type:"number",min:"1",placeholder:"Nhập số lượng cần xuất"},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Lý do",error:v.value.reason},{default:r(()=>[o(i,{modelValue:m.value.reason,"onUpdate:modelValue":e[16]||(e[16]=t=>m.value.reason=t),placeholder:"VD: Xuất cho đơn hàng, Hàng hỏng, Điều chỉnh tồn..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Số tham chiếu",error:v.value.reference_number},{default:r(()=>[o(i,{modelValue:m.value.reference_number,"onUpdate:modelValue":e[17]||(e[17]=t=>m.value.reference_number=t),placeholder:"VD: Mã đơn hàng, số phiếu xuất kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Ghi chú",error:v.value.note},{default:r(()=>[o(i,{modelValue:m.value.note,"onUpdate:modelValue":e[18]||(e[18]=t=>m.value.note=t),type:"textarea",rows:"3",placeholder:"Thông tin bổ sung về đợt xuất kho này..."},null,8,["modelValue"])]),_:1},8,["error"]),o(D,null,{default:r(()=>[o(c,{type:"submit",color:"danger",loading:_.value,icon:n(j),label:"Xuất kho"},null,8,["loading","icon"])]),_:1})],544),[[L,M.value]])]),_:1})]),o(S,{class:"hover:shadow-lg transition-all"},{default:r(()=>[l("div",he,[l("div",ge,[e[27]||(e[27]=l("h2",{class:"text-lg font-semibold text-gray-800"},"Lịch sử giao dịch",-1)),l("div",be,[C(l("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>N.value=t),type:"text",placeholder:"Tìm kiếm...",class:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[R,N.value]]),e[26]||(e[26]=l("span",{class:"absolute left-3 top-2.5 text-gray-400"},[l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])])]),l("div",ye,[l("table",xe,[e[29]||(e[29]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"Thời gian"),l("th",{class:"text-left"},"Sản phẩm"),l("th",{class:"text-left"},"Loại"),l("th",{class:"text-right"},"Số lượng"),l("th",{class:"text-right"},"Tồn kho"),l("th",{class:"text-left"},"Chi tiết")])],-1)),l("tbody",null,[O.value.length?(g(!0),y(U,{key:0},G(O.value,t=>(g(),y("tr",{key:t.id,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors"},[l("td",null,f(Z(t.created_at)),1),l("td",null,f(t.product.name),1),l("td",null,[l("span",{class:W(["px-2 py-1 rounded-full text-sm",{"bg-green-100 text-green-800":t.type==="in","bg-red-100 text-red-800":t.type==="out"}])},f(t.type==="in"?"Nhập":"Xuất"),3)]),l("td",ke,f(t.quantity),1),l("td",Ve,f(t.stock_after_movement),1),l("td",_e,f(Q(t.note)),1)]))),128)):(g(),y("tr",we,e[28]||(e[28]=[l("td",{colspan:"6",class:"py-8 text-center text-gray-500"},[l("div",{class:"flex flex-col items-center"},[l("svg",{class:"w-12 h-12 mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),l("p",{class:"font-medium"},"Không có dữ liệu"),l("p",{class:"text-sm"},"Chưa có giao dịch nào được thực hiện")])],-1)])))])])]),l("div",Me,[l("div",Ce," Hiển thị "+f(s.stockMovements.from||0)+"-"+f(s.stockMovements.to||0)+" trên tổng số "+f(s.stockMovements.total||0)+" bản ghi ",1),l("nav",Se,[o(c,{disabled:!s.stockMovements.prev_page_url,onClick:e[21]||(e[21]=t=>n(b).get(s.stockMovements.prev_page_url)),color:"white",class:"hover:shadow-md transition-all"},{default:r(()=>e[30]||(e[30]=[q(" Trước ")])),_:1},8,["disabled"]),(g(!0),y(U,null,G(s.stockMovements.last_page,t=>(g(),y(U,{key:t},[t===1||t===s.stockMovements.last_page||t>=s.stockMovements.current_page-1&&t<=s.stockMovements.current_page+1?(g(),A(c,{key:0,color:t===s.stockMovements.current_page?"info":"white",onClick:x=>n(b).get(`${a.route("stock-movements.index")}?page=${t}`),class:"hover:shadow-md transition-all"},{default:r(()=>[q(f(t),1)]),_:2},1032,["color","onClick"])):t===s.stockMovements.current_page-2||t===s.stockMovements.current_page+2?(g(),y("span",$e,"...")):Y("",!0)],64))),128)),o(c,{disabled:!s.stockMovements.next_page_url,onClick:e[22]||(e[22]=t=>n(b).get(s.stockMovements.next_page_url)),color:"white",class:"hover:shadow-md transition-all"},{default:r(()=>e[31]||(e[31]=[q(" Sau ")])),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1}))}},_t=ue(Ne,[["__scopeId","data-v-25f9b25e"]]);export{_t as default};
