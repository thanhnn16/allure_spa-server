import{r as u,c as I,aU as i,a0 as S,bH as G,a3 as r,a2 as c,b0 as M,j as V,bM as _,aa as m,bl as h,a1 as P,F as j}from"./@vue-BRgAy5zV.js";import{C as T}from"./CardBoxModal-CC98zKJS.js";import"./@inertiajs-D0DMCEQB.js";import"./colors-S7_1wET5.js";import{_ as f}from"./BaseIcon-B4kwkOCn.js";import{af as q,e as L,j as R,b as W}from"./@mdi-ArhfA4cU.js";import{u as H}from"./vue-toastification-ejyjJRED.js";import{a as y}from"./axios-CCb-kr4I.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BaseButton-eMTGofBM.js";import"./BaseButtons-B17KSMwc.js";import"./CardBox-jfYP3QDG.js";import"./OverlayLayer-BSs7OF78.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";const O={class:"space-y-6"},Q={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},X=["src","alt"],Y={class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2"},Z=["onClick","disabled"],ee=["onClick"],te={key:0,class:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs"},oe={class:"flex flex-wrap gap-4"},re=["src"],se=["onClick"],ae={__name:"ManageImagesModal",props:{modelValue:Boolean,service:Object},emits:["update:modelValue","updated"],setup(B,{emit:F}){const g=B,d=F,s=H(),x=u(null),v=u(!1),l=u([]),p=u([]),b=I({get:()=>g.modelValue,set:e=>d("update:modelValue",e)}),C=I(()=>{var e;return[...((e=g.service)==null?void 0:e.media)||[]].sort((t,o)=>t.position-o.position)}),z=()=>{x.value.click()},E=e=>{const t=Array.from(e.target.files);if(l.value.length+t.length>10){s.error("Không được upload quá 10 ảnh");return}t.forEach(a=>{if(a.size>2*1024*1024){s.error(`File ${a.name} vượt quá 2MB`);return}const k=new FileReader;k.onload=K=>{p.value.push(K.target.result)},k.readAsDataURL(a),l.value.push(a)})},$=e=>{l.value.splice(e,1),p.value.splice(e,1)},N=async e=>{try{await y.delete(route("media.destroy",e)),s.success("Xóa ảnh thành công"),d("updated")}catch(t){s.error("Không thể xóa ảnh"),console.error("Error deleting image:",t)}},U=async()=>{if(!v.value){v.value=!0;try{const e=new FormData;l.value.forEach((t,o)=>{e.append(`images[${o}]`,t)}),await y.post(route("services.upload-images",g.service.id),e,{headers:{"Content-Type":"multipart/form-data"}}),s.success("Cập nhật ảnh thành công"),d("updated"),w()}catch(e){s.error("Không thể cập nhật ảnh"),console.error("Error uploading images:",e)}finally{v.value=!1}}},w=()=>{l.value=[],p.value=[],b.value=!1},A=e=>!e||!e.file_path?"/images/placeholder-service.jpg":e.file_path.startsWith("http")?e.file_path:e.file_path.startsWith("storage/")?"/"+e.file_path:"/storage/"+e.file_path,D=async e=>{try{await y.put(route("media.reorder"),{items:C.value.map(t=>({id:t.id,position:t.id===e?0:t.position===0?1:t.position}))}),s.success("Đã đặt làm ảnh chính"),d("updated")}catch(t){console.error("Error setting main image:",t),s.error("Không thể đặt làm ảnh chính")}};return(e,t)=>(i(),S(T,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o),title:"Quản lý hình ảnh dịch vụ",button:"info","has-cancel":"",onConfirm:U,onCancel:w},{default:G(()=>[r("div",O,[r("div",null,[t[1]||(t[1]=r("h3",{class:"text-lg font-medium mb-4"},"Ảnh hiện tại",-1)),r("div",Q,[(i(!0),c(j,null,M(C.value,(o,n)=>(i(),c("div",{key:n,class:V(["relative group border-2 rounded-lg overflow-hidden",{"border-green-500":o.position===0,"border-gray-200":o.position!==0}])},[r("img",{src:A(o),alt:"Service image "+n,class:"w-full h-32 object-cover"},null,8,X),r("div",Y,[r("button",{onClick:_(a=>D(o.id),["prevent"]),class:V(["text-white bg-green-600 p-2 rounded-full hover:bg-green-700",{"opacity-50 cursor-not-allowed":o.position===0}]),disabled:o.position===0},[m(f,{path:h(q),size:"20"},null,8,["path"])],10,Z),r("button",{onClick:_(a=>N(o.id),["prevent"]),class:"text-white bg-red-600 p-2 rounded-full hover:bg-red-700"},[m(f,{path:h(L),size:"20"},null,8,["path"])],8,ee)]),o.position===0?(i(),c("div",te," Ảnh chính ")):P("",!0)],2))),128))])]),r("div",null,[t[2]||(t[2]=r("h3",{class:"text-lg font-medium mb-4"},"Thêm ảnh mới",-1)),r("div",oe,[(i(!0),c(j,null,M(p.value,(o,n)=>(i(),c("div",{key:n,class:"relative w-32 h-32 border rounded-lg overflow-hidden"},[r("img",{src:o,class:"w-full h-full object-cover"},null,8,re),r("button",{onClick:_(a=>$(n),["prevent"]),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600"},[m(f,{path:h(R),size:"16"},null,8,["path"])],8,se)]))),128)),r("div",{class:"w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:border-indigo-500",onClick:z},[m(f,{path:h(W),size:"24",class:"text-gray-400"},null,8,["path"]),r("input",{type:"file",ref_key:"fileInput",ref:x,class:"hidden",multiple:"",onChange:E,accept:"image/*"},null,544)])]),t[3]||(t[3]=r("p",{class:"text-xs text-gray-500 mt-2"},"PNG, JPG, GIF tối đa 2MB",-1))])])]),_:1},8,["modelValue"]))}},Ke=J(ae,[["__scopeId","data-v-cd3cdf05"]]);export{Ke as default};
