import{r as f,c as O,aU as g,a0 as A,bH as a,aa as o,bl as s,a3 as l,bJ as M,bB as T,bM as E,bA as Z,a2 as y,b0 as P,bf as h,j as R,F as q,a9 as U,a1 as W}from"./@vue-BRgAy5zV.js";import{Z as Y,F as b}from"./@inertiajs-D0DMCEQB.js";import{L as ee}from"./LayoutAuthenticated-LEllyTKo.js";import{_ as te}from"./SectionMain-Vot1TOkK.js";import{_ as C}from"./CardBox-jfYP3QDG.js";import{_ as L}from"./BaseButtons-B17KSMwc.js";import{_ as p}from"./BaseButton-eMTGofBM.js";import{_ as u}from"./FormField-Da_P6kO8.js";import{_ as i}from"./FormControl-BSsARiYM.js";import{aM as le,H as oe,aN as ae,aO as re,ax as D,b as j}from"./@mdi-D7koDRFv.js";import{u as ne}from"./vue-toastification-ejyjJRED.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./app-DOZwKzFy.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./main-BNmBi4-k.js";const ue={class:"flex flex-col md:flex-row justify-between items-center gap-4"},ie={class:"mt-6 p-4 bg-white rounded-lg border border-gray-100 shadow-sm"},de={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},me={class:"mt-4 flex justify-end space-x-2"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ce={class:"flex justify-between items-center mb-4"},ve={class:"flex justify-between items-center mb-4"},fe={class:"mb-4"},he={class:"flex justify-between items-center"},ge={class:"relative"},be={class:"overflow-x-auto"},ye={class:"w-full"},ke={class:"text-right"},xe={class:"text-right"},_e={class:"text-sm text-gray-600"},Ve={key:1},we={class:"mt-4 flex items-center justify-between"},Me={class:"text-sm text-gray-600"},Ce={class:"flex space-x-2"},Se={key:1,class:"px-2 py-1"},Ne={__name:"StockMovementView",props:{products:{type:Array,default:()=>[]},stockMovements:{type:Object,default:()=>({data:[],from:0,to:0,total:0,current_page:1,last_page:1,prev_page_url:null,next_page_url:null})}},setup(n){const S=n;f({product_id:"",quantity:"",type:{value:"in",label:"Nhập kho"},reason:"",reference_number:"",note:""});const c=f({start_date:"",end_date:"",product_id:"",type:""}),x=f(!1),v=f({}),_=f(!1),N=ne(),$=O(()=>S.products.map(r=>({...r,label:`${r.name} (${G(r.price||0)} - Tồn: ${r.quantity})`,value:r.id}))),G=r=>!r||isNaN(r)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r),B=async r=>{_.value=!0;try{const e=r==="in"?d.value:m.value,t={product_id:e.product_id.value||e.product_id,quantity:e.quantity,type:e.type.value,reason:e.reason,reference_number:e.reference_number,note:e.note};b.post(route("stock-movements.store"),t,{onSuccess:()=>{N.success("Tạo phiếu kho thành công"),r==="in"?d.value={product_id:"",quantity:"",type:{value:"in",label:"Nhập kho"},reason:"",reference_number:"",note:""}:m.value={product_id:"",quantity:"",type:{value:"out",label:"Xuất kho"},reason:"",reference_number:"",note:""},b.visit(route("stock-movements.index"),{preserveScroll:!0,preserveState:!1})},onError:k=>{N.error(k.message||"Có lỗi xảy ra")}})}catch(e){N.error(e.message||"Có lỗi xảy ra")}finally{_.value=!1}},X=()=>{b.get(route("stock-movements.index"),c.value,{preserveState:!0,preserveScroll:!0})},I=()=>{c.value={start_date:"",end_date:"",product_id:"",type:""},X()},Q=()=>{window.open(route("stock-movements.export",c.value))},z=[{value:"in",label:"Nhập kho"},{value:"out",label:"Xuất kho"}],J=r=>new Date(r).toLocaleString("vi-VN"),K=r=>{try{const e=JSON.parse(r);return`${e.reason||""} ${e.comment||""}`}catch{return r}},F=f(""),H=O(()=>S.stockMovements.data?S.stockMovements.data.filter(r=>{var t,k;const e=F.value.toLowerCase();return r.product.name.toLowerCase().includes(e)||((t=r.note)==null?void 0:t.toLowerCase().includes(e))||((k=r.reference_number)==null?void 0:k.toLowerCase().includes(e))}):[]),V=f(!0),w=f(!0),d=f({product_id:"",quantity:"",type:{value:"in",label:"Nhập kho"},reason:"",reference_number:"",note:""}),m=f({product_id:"",quantity:"",type:{value:"out",label:"Xuất kho"},reason:"",reference_number:"",note:""});return(r,e)=>(g(),A(ee,null,{default:a(()=>[o(s(Y),{title:"Quản lý kho"}),o(te,null,{default:a(()=>[o(C,{class:"mb-6"},{default:a(()=>[l("div",ue,[e[23]||(e[23]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-800"},"Quản lý nhập xuất kho"),l("p",{class:"text-gray-600 mt-1"},"Theo dõi và quản lý các hoạt động nhập xuất kho")],-1)),o(L,null,{default:a(()=>[o(p,{color:"info",icon:x.value?s(le):s(oe),onClick:e[0]||(e[0]=t=>x.value=!x.value),class:"hover:shadow-lg transition-all",label:"Bộ lọc"},null,8,["icon"]),o(p,{color:"success",icon:s(ae),onClick:Q,class:"hover:shadow-lg transition-all",label:"Xuất Excel"},null,8,["icon"]),o(p,{color:"info",icon:s(re),onClick:e[1]||(e[1]=t=>s(b).get(r.route("reports.stock"))),class:"hover:shadow-lg transition-all",label:"Báo cáo"},null,8,["icon"])]),_:1})]),M(l("div",ie,[l("div",de,[o(u,{label:"Từ ngày"},{default:a(()=>[o(i,{modelValue:c.value.start_date,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.start_date=t),type:"date"},null,8,["modelValue"])]),_:1}),o(u,{label:"Đến ngày"},{default:a(()=>[o(i,{modelValue:c.value.end_date,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value.end_date=t),type:"date"},null,8,["modelValue"])]),_:1}),o(u,{label:"Sản phẩm"},{default:a(()=>[o(i,{modelValue:c.value.product_id,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.product_id=t),type:"select",options:$.value,placeholder:"Tất cả sản phẩm"},null,8,["modelValue","options"])]),_:1}),o(u,{label:"Loại"},{default:a(()=>[o(i,{modelValue:c.value.type,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value.type=t),type:"select",options:z,placeholder:"Tất cả"},null,8,["modelValue"])]),_:1})]),l("div",me,[o(p,{color:"danger",onClick:I,label:"Xóa lọc"}),o(p,{color:"info",onClick:X,label:"Áp dụng"})])],512),[[T,x.value]])]),_:1}),l("div",pe,[o(C,{class:"hover:shadow-lg transition-all"},{default:a(()=>[l("div",ce,[e[24]||(e[24]=l("div",null,[l("h2",{class:"text-lg font-semibold text-gray-800"},"Nhập kho"),l("p",{class:"text-gray-600 text-sm"},"Tạo phiếu nhập kho mới")],-1)),o(p,{onClick:e[6]||(e[6]=t=>V.value=!V.value),icon:V.value?s(D):s(j),color:"info",small:""},null,8,["icon"])]),M(l("form",{onSubmit:e[12]||(e[12]=E(t=>B("in"),["prevent"])),class:"space-y-4"},[o(u,{label:"Sản phẩm",error:v.value.product_id},{default:a(()=>[o(i,{modelValue:d.value.product_id,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value.product_id=t),type:"select",options:$.value,placeholder:"Chọn sản phẩm cần nhập kho"},null,8,["modelValue","options"])]),_:1},8,["error"]),o(u,{label:"Số lượng",error:v.value.quantity},{default:a(()=>[o(i,{modelValue:d.value.quantity,"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.quantity=t),type:"number",min:"1",placeholder:"Nhập số lượng sản phẩm"},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Lý do",error:v.value.reason},{default:a(()=>[o(i,{modelValue:d.value.reason,"onUpdate:modelValue":e[9]||(e[9]=t=>d.value.reason=t),placeholder:"VD: Nhập hàng từ nhà cung cấp, Điều chỉnh tồn kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Số tham chiếu",error:v.value.reference_number},{default:a(()=>[o(i,{modelValue:d.value.reference_number,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.reference_number=t),placeholder:"VD: Số hóa đơn, số PO, số phiếu nhập kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Ghi chú",error:v.value.note},{default:a(()=>[o(i,{modelValue:d.value.note,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value.note=t),type:"textarea",rows:"3",placeholder:"Thông tin bổ sung về đợt nhập kho này..."},null,8,["modelValue"])]),_:1},8,["error"]),o(L,null,{default:a(()=>[o(p,{type:"submit",color:"info",loading:_.value,icon:s(j),label:"Nhập kho"},null,8,["loading","icon"])]),_:1})],544),[[T,V.value]])]),_:1}),o(C,{class:"hover:shadow-lg transition-all"},{default:a(()=>[l("div",ve,[e[25]||(e[25]=l("div",null,[l("h2",{class:"text-lg font-semibold text-gray-800"},"Xuất kho"),l("p",{class:"text-gray-600 text-sm"},"Tạo phiếu xuất kho mới")],-1)),o(p,{onClick:e[13]||(e[13]=t=>w.value=!w.value),icon:w.value?s(D):s(j),color:"danger",small:""},null,8,["icon"])]),M(l("form",{onSubmit:e[19]||(e[19]=E(t=>B("out"),["prevent"])),class:"space-y-4"},[o(u,{label:"Sản phẩm",error:v.value.product_id},{default:a(()=>[o(i,{modelValue:m.value.product_id,"onUpdate:modelValue":e[14]||(e[14]=t=>m.value.product_id=t),type:"select",options:$.value,placeholder:"Chọn sản phẩm cần xuất kho"},null,8,["modelValue","options"])]),_:1},8,["error"]),o(u,{label:"Số lượng",error:v.value.quantity},{default:a(()=>[o(i,{modelValue:m.value.quantity,"onUpdate:modelValue":e[15]||(e[15]=t=>m.value.quantity=t),type:"number",min:"1",placeholder:"Nhập số lượng cần xuất"},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Lý do",error:v.value.reason},{default:a(()=>[o(i,{modelValue:m.value.reason,"onUpdate:modelValue":e[16]||(e[16]=t=>m.value.reason=t),placeholder:"VD: Xuất cho đơn hàng, Hàng hỏng, Điều chỉnh tồn..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Số tham chiếu",error:v.value.reference_number},{default:a(()=>[o(i,{modelValue:m.value.reference_number,"onUpdate:modelValue":e[17]||(e[17]=t=>m.value.reference_number=t),placeholder:"VD: Mã đơn hàng, số phiếu xuất kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(u,{label:"Ghi chú",error:v.value.note},{default:a(()=>[o(i,{modelValue:m.value.note,"onUpdate:modelValue":e[18]||(e[18]=t=>m.value.note=t),type:"textarea",rows:"3",placeholder:"Thông tin bổ sung về đợt xuất kho này..."},null,8,["modelValue"])]),_:1},8,["error"]),o(L,null,{default:a(()=>[o(p,{type:"submit",color:"danger",loading:_.value,icon:s(D),label:"Xuất kho"},null,8,["loading","icon"])]),_:1})],544),[[T,w.value]])]),_:1})]),o(C,{class:"hover:shadow-lg transition-all"},{default:a(()=>[l("div",fe,[l("div",he,[e[27]||(e[27]=l("h2",{class:"text-lg font-semibold text-gray-800"},"Lịch sử giao dịch",-1)),l("div",ge,[M(l("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>F.value=t),type:"text",placeholder:"Tìm kiếm...",class:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[Z,F.value]]),e[26]||(e[26]=l("span",{class:"absolute left-3 top-2.5 text-gray-400"},[l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])])]),l("div",be,[l("table",ye,[e[29]||(e[29]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"Thời gian"),l("th",{class:"text-left"},"Sản phẩm"),l("th",{class:"text-left"},"Loại"),l("th",{class:"text-right"},"Số lượng"),l("th",{class:"text-right"},"Tồn kho"),l("th",{class:"text-left"},"Ghi chú")])],-1)),l("tbody",null,[H.value.length?(g(!0),y(q,{key:0},P(H.value,t=>(g(),y("tr",{key:t.id,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors"},[l("td",null,h(J(t.created_at)),1),l("td",null,h(t.product.name),1),l("td",null,[l("span",{class:R(["px-2 py-1 rounded-full text-sm",{"bg-green-100 text-green-800":t.type==="in","bg-red-100 text-red-800":t.type==="out"}])},h(t.type==="in"?"Nhập":"Xuất"),3)]),l("td",ke,h(t.quantity),1),l("td",xe,h(t.stock_after_movement),1),l("td",_e,h(K(t.note)),1)]))),128)):(g(),y("tr",Ve,e[28]||(e[28]=[l("td",{colspan:"6",class:"py-8 text-center text-gray-500"},[l("div",{class:"flex flex-col items-center"},[l("svg",{class:"w-12 h-12 mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),l("p",{class:"font-medium"},"Không có dữ liệu"),l("p",{class:"text-sm"},"Chưa có giao dịch nào được thực hiện")])],-1)])))])])]),l("div",we,[l("div",Me," Hiển thị "+h(n.stockMovements.from||0)+"-"+h(n.stockMovements.to||0)+" trên tổng số "+h(n.stockMovements.total||0)+" bản ghi ",1),l("nav",Ce,[o(p,{disabled:!n.stockMovements.prev_page_url,onClick:e[21]||(e[21]=t=>s(b).get(n.stockMovements.prev_page_url)),color:"white",class:"hover:shadow-md transition-all"},{default:a(()=>e[30]||(e[30]=[U(" Trước ")])),_:1},8,["disabled"]),(g(!0),y(q,null,P(n.stockMovements.last_page,t=>(g(),y(q,{key:t},[t===1||t===n.stockMovements.last_page||t>=n.stockMovements.current_page-1&&t<=n.stockMovements.current_page+1?(g(),A(p,{key:0,color:t===n.stockMovements.current_page?"info":"white",onClick:k=>s(b).get(`${r.route("stock-movements.index")}?page=${t}`),class:"hover:shadow-md transition-all"},{default:a(()=>[U(h(t),1)]),_:2},1032,["color","onClick"])):t===n.stockMovements.current_page-2||t===n.stockMovements.current_page+2?(g(),y("span",Se,"...")):W("",!0)],64))),128)),o(p,{disabled:!n.stockMovements.next_page_url,onClick:e[22]||(e[22]=t=>s(b).get(n.stockMovements.next_page_url)),color:"white",class:"hover:shadow-md transition-all"},{default:a(()=>e[31]||(e[31]=[U(" Sau ")])),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1}))}},_t=se(Ne,[["__scopeId","data-v-5f086614"]]);export{_t as default};
