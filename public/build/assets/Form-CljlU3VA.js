import{c as h,e as b,r as E,aU as x,a0 as W,bH as k,aa as l,bl as s,a3 as t,a9 as c,bf as v,bJ as d,bA as u,j as L,a2 as _,a1 as w,bz as X,bw as Y,bM as tt}from"./@vue-BRgAy5zV.js";import{T as et,Z as rt}from"./@inertiajs-D0DMCEQB.js";import{L as st}from"./LayoutAuthenticated-3CoKbgIl.js";import{_ as ot}from"./SectionMain-Vot1TOkK.js";import{_ as at}from"./CardBox-jfYP3QDG.js";import{_ as y}from"./BaseIcon-B4kwkOCn.js";import{_ as Q}from"./BaseButton-eMTGofBM.js";import{aQ as R,aR as it,aS as dt,B as z}from"./@mdi-DPpcS9jm.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./app-Df9yumF6.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./vue-toastification-ejyjJRED.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";const ut={class:"mb-6"},nt={class:"text-xl font-semibold text-gray-800 dark:text-white flex items-center"},mt={class:"text-gray-600 dark:text-gray-400 mt-1"},ct={class:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-lg space-y-4"},gt={class:"mt-1 relative"},pt={key:0,class:"mt-1 text-sm text-red-500"},bt={class:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-lg space-y-4"},vt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yt={class:"mt-1 relative"},xt={class:"mt-1 relative"},ft=["max"],ht={class:"absolute right-3 top-2 text-gray-500 dark:text-gray-400"},kt={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},_t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wt={class:"mt-1 relative"},St={class:"mt-1 relative"},Vt={class:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-lg space-y-4"},Tt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ut={class:"mt-1 relative"},Ct={class:"mt-1 relative"},Nt={key:0,class:"mt-1 text-sm text-red-500"},Dt={class:"space-y-4"},Mt={class:"flex items-center"},jt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qt={key:0},$t={class:"flex justify-end space-x-3 pt-6"},Bt={__name:"Form",props:{voucher:{type:Object,default:()=>({})}},setup(p){var T,U,C,N,D,M,j,q,$,B,F,G,I,O;const o=p,r=et({code:((T=o.voucher)==null?void 0:T.code)||"",description:((U=o.voucher)==null?void 0:U.description)||"",discount_type:((C=o.voucher)==null?void 0:C.discount_type)||"percentage",discount_value:((N=o.voucher)==null?void 0:N.discount_value)||0,min_order_value:((D=o.voucher)==null?void 0:D.min_order_value)||0,max_discount_amount:((M=o.voucher)==null?void 0:M.max_discount_amount)||0,start_date:((j=o.voucher)==null?void 0:j.start_date)||new Date().toISOString().split("T")[0],end_date:((q=o.voucher)==null?void 0:q.end_date)||new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],is_unlimited:(($=o.voucher)==null?void 0:$.is_unlimited)||!1,usage_limit:((B=o.voucher)==null?void 0:B.usage_limit)||1,uses_per_user:((F=o.voucher)==null?void 0:F.uses_per_user)||1,status:((G=o.voucher)==null?void 0:G.status)||"active"}),S=h(()=>{var e,n,g,m;const a=typeof r.status=="object"?r.status.value:r.status;return console.log("canChangeStatus check:",{voucherId:(e=o.voucher)==null?void 0:e.id,currentStatus:(n=o.voucher)==null?void 0:n.status,formStatus:a,result:!((g=o.voucher)!=null&&g.id)||o.voucher.status==="active"}),(m=o.voucher)!=null&&m.id?!(o.voucher.status==="inactive"&&a==="active"):!0});b(()=>r.status,(a,e)=>{var m;const n=typeof a=="object"?a.value:a,g=typeof e=="object"?e.value:e;console.log("Status watch triggered:",{currentStatus:n,previousStatus:g,canChange:S.value,voucherStatus:(m=o.voucher)==null?void 0:m.status}),!S.value&&n==="active"&&(console.log("Preventing status change to active"),r.status="inactive")},{immediate:!0});const f=E(((I=o.voucher)==null?void 0:I.is_unlimited)||!1);b(()=>r.discount_type,a=>{r.discount_value=""}),b(f,a=>{r.is_unlimited=a,a?r.usage_limit=null:r.usage_limit=1});const A=()=>{r.discount_type==="percentage"&&r.discount_value>100&&(r.discount_value=100)},H=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),J=()=>{var a;A(),(a=o.voucher)!=null&&a.id?r.put(route("vouchers.update",o.voucher.id)):r.post(route("vouchers.store"))};b(()=>r.errors,a=>{Object.keys(a).length>0&&console.error("Form validation errors:",a)},{deep:!0}),b(()=>r.processing,a=>{console.log("Form processing state:",a)});const K=[{label:"Trang chủ",route:"dashboard",href:route("dashboard")},{label:"Quản lý Voucher",route:"vouchers.index",href:route("vouchers.index")},{label:(O=o.voucher)!=null&&O.id?"Sửa Voucher":"Thêm Voucher"}],Z=h(()=>r.discount_value?r.discount_type==="percentage"?`${r.discount_value}%`:H(r.discount_value):""),V=h(()=>!r.start_date||!r.end_date?!0:new Date(r.start_date)<=new Date(r.end_date));return(a,e)=>(x(),W(st,null,{default:k(()=>{var n;return[l(s(rt),{title:(n=p.voucher)!=null&&n.id?"Sửa Voucher":"Thêm Voucher"},null,8,["title"]),l(ot,{breadcrumbs:K},{default:k(()=>[l(at,{class:"max-w-4xl mx-auto"},{default:k(()=>{var g,m,P;return[t("div",ut,[t("h2",nt,[l(y,{path:s(R),class:"w-6 h-6 mr-2"},null,8,["path"]),c(" "+v((g=p.voucher)!=null&&g.id?"Sửa Voucher":"Thêm Voucher Mới"),1)]),t("p",mt," Điền thông tin chi tiết để "+v((m=p.voucher)!=null&&m.id?"cập nhật":"tạo")+" voucher ",1)]),t("form",{onSubmit:tt(J,["prevent"]),class:"space-y-6"},[t("div",ct,[e[14]||(e[14]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Thông tin cơ bản",-1)),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Mã voucher "),t("span",{class:"text-red-500"},"*")],-1)),t("div",gt,[d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>s(r).code=i),type:"text",required:"",class:L(["w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10",{"border-red-500":s(r).errors.code}])},null,2),[[u,s(r).code]]),l(y,{path:s(R),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])]),s(r).errors.code?(x(),_("p",pt,v(s(r).errors.code),1)):w("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Mô tả ",-1)),d(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=i=>s(r).description=i),rows:"2",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500",placeholder:"Nhập mô tả về voucher (không bắt buộc)"},"                            ",512),[[u,s(r).description]])])]),t("div",bt,[e[22]||(e[22]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Giá trị giảm giá",-1)),t("div",vt,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Loại giảm giá "),t("span",{class:"text-red-500"},"*")],-1)),t("div",yt,[d(t("select",{"onUpdate:modelValue":e[2]||(e[2]=i=>s(r).discount_type=i),required:"",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},e[15]||(e[15]=[t("option",{value:"percentage"},"Phần trăm",-1),t("option",{value:"fixed"},"Số tiền cố định",-1)]),512),[[X,s(r).discount_type]]),l(y,{path:s(r).discount_type==="percentage"?s(it):s(dt),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Giá trị giảm "),t("span",{class:"text-red-500"},"*")],-1)),t("div",xt,[d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>s(r).discount_value=i),type:"number",required:"",min:"0",max:s(r).discount_type==="percentage"?100:null,class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,8,ft),[[u,s(r).discount_value,void 0,{number:!0}]]),t("span",ht,v(s(r).discount_type==="percentage"?"%":"đ"),1)]),t("p",kt," Giảm: "+v(Z.value),1)])]),t("div",_t,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Giá trị đơn hàng tối thiểu ",-1)),t("div",wt,[d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>s(r).min_order_value=i),type:"number",min:"0",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,512),[[u,s(r).min_order_value,void 0,{number:!0}]]),e[18]||(e[18]=t("span",{class:"absolute right-3 top-2 text-gray-500 dark:text-gray-400"},"đ",-1))])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Giảm giá tối đa ",-1)),t("div",St,[d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>s(r).max_discount_amount=i),type:"number",min:"0",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,512),[[u,s(r).max_discount_amount,void 0,{number:!0}]]),e[20]||(e[20]=t("span",{class:"absolute right-3 top-2 text-gray-500 dark:text-gray-400"},"đ",-1))])])])]),t("div",Vt,[e[28]||(e[28]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Thời gian và giới hạn sử dụng",-1)),t("div",Tt,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Ngày bắt đầu "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ut,[d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>s(r).start_date=i),type:"date",required:"",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,512),[[u,s(r).start_date]]),l(y,{path:s(z),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Ngày kết thúc "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ct,[d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>s(r).end_date=i),type:"date",required:"",class:L(["w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10",{"border-red-500":!V.value}])},null,2),[[u,s(r).end_date]]),l(y,{path:s(z),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])]),V.value?w("",!0):(x(),_("p",Nt," Ngày kết thúc phải sau ngày bắt đầu "))])]),t("div",Dt,[t("div",Mt,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=i=>f.value=i),id:"is_unlimited",class:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"},null,512),[[Y,f.value]]),e[25]||(e[25]=t("label",{for:"is_unlimited",class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Không giới hạn số lần sử dụng ",-1))]),t("div",jt,[s(r).is_unlimited?w("",!0):(x(),_("div",qt,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Tổng số lần sử dụng "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>s(r).usage_limit=i),type:"number",required:"",min:"1",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500"},null,512),[[u,s(r).usage_limit,void 0,{number:!0}]])])),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Số lần sử dụng cho mỗi người dùng "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=i=>s(r).uses_per_user=i),type:"number",required:"",min:"1",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500"},null,512),[[u,s(r).uses_per_user,void 0,{number:!0}]])])])])]),t("div",$t,[l(Q,{type:"button",label:"Quay lại",color:"white",onClick:e[11]||(e[11]=i=>a.$inertia.visit(a.route("vouchers.index")))}),l(Q,{type:"submit",label:(P=p.voucher)!=null&&P.id?"Cập nhật":"Tạo mới",color:"info",loading:s(r).processing},null,8,["label","loading"])])],32)]}),_:1})]),_:1})]}),_:1}))}},Ve=lt(Bt,[["__scopeId","data-v-4ba6a44f"]]);export{Ve as default};
