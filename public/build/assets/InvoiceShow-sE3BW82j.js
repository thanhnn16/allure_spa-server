import{Z as tt,i as et,F as z}from"./@inertiajs-D0DMCEQB.js";import{A as nt,L as st}from"./LayoutAuthenticated-XZirOlYW.js";import{_ as ot}from"./SectionMain-BbIPmLtw.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as V,aU as c,a2 as m,a3 as t,a9 as I,bf as i,F as E,b0 as X,a1 as x,a8 as it,r as _,e as R,b2 as P,aa as F,bH as B,j as w,bM as rt,bJ as K,bA as W,bz as at,a0 as lt,n as dt}from"./@vue-BRgAy5zV.js";import{a as J}from"./axios-CCb-kr4I.js";import{u as ct}from"./vue-toastification-ejyjJRED.js";import{h as mt}from"./html2pdf.js-yYbeBQq1.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./@mdi-CTfBXXzV.js";import"./app-sTdmxqRJ.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./html2canvas-Dy2Co7Il.js";const ut={components:{AllureLogo:nt},props:{invoice:{type:Object,required:!0}},setup(a){return{subtotalAmount:V(()=>{var o,s;return(s=(o=a.invoice)==null?void 0:o.order)!=null&&s.order_items?a.invoice.order.order_items.reduce((b,u)=>b+Number(u.price)*Number(u.quantity),0):0})}},methods:{formatCurrency(a){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a)},formatDateTime(a){return new Date(a).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getItemName(a){var e,o;return a.item_type==="service"?((e=a.service)==null?void 0:e.service_name)||"Dịch vụ không xác định":a.item_type==="product"?((o=a.product)==null?void 0:o.name)||"Sản phẩm không xác định":"Không xác định"},getItemCode(a){var e,o;return a.item_type==="service"?((e=a.service)==null?void 0:e.code)||"-":a.item_type==="product"&&((o=a.product)==null?void 0:o.code)||"-"},formatServiceType(a){return{single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"}[a]||a}}},gt={class:"print-template w-[76mm] mx-auto bg-white p-4 font-sans"},yt={class:"text-center mb-8 border-y-2 border-gray-200 py-4"},xt={class:"text-sm space-y-1.5 text-gray-600"},ft={class:"font-medium"},pt={class:"mb-6 text-sm"},ht={class:"grid grid-cols-1 gap-2"},bt={class:"flex justify-between items-center"},vt={class:"flex justify-between items-center"},_t={class:"mb-6"},wt={class:"w-full text-[11px]"},Ct={class:"py-1.5"},kt={class:"font-medium"},Tt={class:"text-[9px] text-gray-600"},St={key:0,class:"text-[9px] font-medium text-gray-600"},Nt={class:"py-1.5 text-right"},jt={class:"py-1.5 text-right"},It={class:"py-1.5 text-right font-medium"},At={class:"text-sm space-y-2 mb-6"},Pt={class:"flex justify-between"},Vt={key:0,class:"flex justify-between"},Dt={class:"flex justify-between font-bold border-t border-gray-200 pt-2"},Lt={class:"flex justify-between"},Mt={class:"flex justify-between font-medium"};function Ht(a,e,o,s,b,u){var g,C,k,h;return c(),m("div",gt,[e[9]||(e[9]=t("div",{class:"text-center mb-8"},[t("img",{src:"/images/icon-192x192.png",alt:"Allure Spa Logo",class:"w-16 h-16 mx-auto mb-4 object-contain"}),t("h1",{class:"text-2xl font-bold tracking-wider mb-2 text-gray-800"},"ALLURE SPA"),t("p",{class:"text-sm leading-relaxed text-gray-600"},[I(" 720A Điện Biên Phủ, P. 22, Bình Thạnh, HCM"),t("br"),I(" ĐT: (84) 986 910 920 ")])],-1)),t("div",yt,[e[0]||(e[0]=t("h2",{class:"text-xl font-bold mb-3 tracking-wide text-gray-800"},"HÓA ĐƠN THANH TOÁN",-1)),t("div",xt,[t("p",ft,"#"+i(o.invoice.id),1),t("p",null,i(u.formatDateTime(o.invoice.created_at)),1)])]),t("div",pt,[t("div",ht,[t("div",bt,[e[1]||(e[1]=t("span",{class:"font-medium"},"Khách hàng:",-1)),t("span",null,i((g=o.invoice.user)==null?void 0:g.full_name),1)]),t("div",vt,[e[2]||(e[2]=t("span",{class:"font-medium"},"Số điện thoại:",-1)),t("span",null,i((C=o.invoice.user)==null?void 0:C.phone_number),1)])])]),t("div",_t,[t("table",wt,[e[3]||(e[3]=t("thead",null,[t("tr",{class:"border-b border-gray-300"},[t("th",{class:"py-2 text-left font-bold"},"SP/DV"),t("th",{class:"py-2 text-right font-bold"},"SL"),t("th",{class:"py-2 text-right font-bold"},"Đơn giá"),t("th",{class:"py-2 text-right font-bold"},"T.Tiền")])],-1)),t("tbody",null,[(c(!0),m(E,null,X((k=o.invoice.order)==null?void 0:k.order_items,y=>(c(),m("tr",{key:y.id,class:"border-b border-gray-100"},[t("td",Ct,[t("div",kt,i(u.getItemName(y)),1),t("div",Tt,i(u.getItemCode(y)),1),y.service_type?(c(),m("div",St,i(u.formatServiceType(y.service_type)),1)):x("",!0)]),t("td",Nt,i(y.quantity),1),t("td",jt,i(u.formatCurrency(y.price)),1),t("td",It,i(u.formatCurrency(y.price*y.quantity)),1)]))),128))])])]),t("div",At,[t("div",Pt,[e[4]||(e[4]=t("span",null,"Tổng tiền hàng:",-1)),t("span",null,i(u.formatCurrency(s.subtotalAmount)),1)]),(h=o.invoice.order)!=null&&h.discount_amount?(c(),m("div",Vt,[e[5]||(e[5]=t("span",null,"Giảm giá:",-1)),t("span",null,"-"+i(u.formatCurrency(o.invoice.order.discount_amount)),1)])):x("",!0),t("div",Dt,[e[6]||(e[6]=t("span",null,"Tổng thanh toán:",-1)),t("span",null,i(u.formatCurrency(o.invoice.total_amount)),1)]),t("div",Lt,[e[7]||(e[7]=t("span",null,"Đã thanh toán:",-1)),t("span",null,i(u.formatCurrency(o.invoice.paid_amount)),1)]),t("div",Mt,[e[8]||(e[8]=t("span",null,"Còn lại:",-1)),t("span",null,i(u.formatCurrency(o.invoice.remaining_amount)),1)])]),e[10]||(e[10]=it('<div class="mt-10 text-center space-y-3 border-t-2 border-gray-200 pt-6" data-v-532301e1><p class="font-medium text-gray-800 text-base" data-v-532301e1>Cảm ơn quý khách đã sử dụng dịch vụ!</p><div class="text-sm text-gray-600 space-y-1.5" data-v-532301e1><p class="font-medium" data-v-532301e1>Hotline: (84) 986 910 920</p><p class="font-medium" data-v-532301e1>Website: www.allurespa.com.vn</p></div></div>',1))])}const Gt=Q(ut,[["render",Ht],["__scopeId","data-v-532301e1"]]),qt={components:{Head:tt,Link:et,LayoutAuthenticated:st,SectionMain:ot,PrintInvoiceTemplate:Gt},props:{invoice:{type:Object,required:!0}},setup(a){const e=_(0),o=_("cash"),s=_(""),b=_(!1),u=_("partial"),g=ct();R(u,n=>{n==="full"?e.value=a.invoice.remaining_amount:e.value=0}),R(e,n=>{n>a.invoice.remaining_amount&&(e.value=a.invoice.remaining_amount)});const C=n=>{u.value=n,n==="full"?e.value=a.invoice.remaining_amount:e.value=0},k=n=>({cash:"Tiền mặt",bank_transfer:"Chuyển khoản",card:"Thẻ"})[n]||n,h=_(null),y=async()=>{try{if(await dt(),!h.value){g.error("Không tìm thấy template hóa đơn!");return}const n=h.value.$el,r=document.createElement("div");r.appendChild(n.cloneNode(!0)),document.body.appendChild(r);const d={margin:5,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,width:302},jsPDF:{unit:"mm",format:[80,297],orientation:"portrait"}};mt().set(d).from(r.firstChild).outputPdf("blob").then(p=>{const N=URL.createObjectURL(p),j=window.open(N,"_blank","width=800,height=600");j?(j.onload=()=>{j.print()},j.onbeforeunload=()=>{URL.revokeObjectURL(N),document.body.removeChild(r)}):(g.error("Vui lòng cho phép popup để in hóa đơn!"),URL.revokeObjectURL(N),document.body.removeChild(r))}).catch(p=>{console.error("PDF generation error:",p),g.error("Có lỗi khi tạo PDF. Vui lòng thử lại!"),document.body.removeChild(r)})}catch(n){console.error("Print process error:",n),g.error("Có lỗi xảy ra. Vui lòng thử lại!")}},v=async()=>{var n,r;b.value=!0;try{const d=await J.post(`/invoices/${a.invoice.id}/process-payment`,{payment_amount:e.value,payment_method:o.value,note:s.value,payment_proof:null});g.success("Đã cập nhật thanh toán cho hóa đơn"),d.data.data.status==="paid"&&g.success("Hóa đơn đã được thanh toán đầy đủ"),z.reload({only:["invoice"]}),e.value=0,s.value=""}catch(d){console.error("Payment processing error:",d),g.error(((r=(n=d.response)==null?void 0:n.data)==null?void 0:r.message)||"Có lỗi xảy ra khi xử lý thanh toán")}finally{b.value=!1}},D=()=>{var n,r,d;return(d=(r=(n=a.invoice)==null?void 0:n.order)==null?void 0:r.orderItems)!=null&&d.length?a.invoice.order.orderItems.reduce((p,N)=>{const j=Number(N.price)||0,$=Number(N.quantity)||0;return p+j*$},0):0},A=V(()=>{var n,r,d,p;return(r=(n=a.invoice)==null?void 0:n.order)!=null&&r.total_amount&&((p=(d=a.invoice)==null?void 0:d.order)!=null&&p.discount_amount)?Number(a.invoice.order.total_amount)+Number(a.invoice.order.discount_amount):D()}),f=n=>{const r=Number(n);return isNaN(r)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r)},T=n=>new Date(n).toLocaleString("vi-VN"),L=n=>{switch(n){case"pending":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800";case"partial":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800";case"paid":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800";case"cancelled":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800";default:return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"}},M=n=>{switch(n){case"pending":return"Chờ thanh toán";case"partial":return"Thanh toán một phần";case"paid":return"Đã thanh toán";case"cancelled":return"Đã hủy";default:return"Không xác định"}},H=V(()=>a.invoice.status!=="paid"&&a.invoice.status!=="cancelled");R(e,n=>{n>a.invoice.remaining_amount&&(e.value=a.invoice.remaining_amount,g.warning("Số tiền không thể lớn hơn số tiền cần thanh toán"))});const G=n=>{var r,d;return n.item_type==="service"?((r=n.service)==null?void 0:r.service_name)||"Dịch vụ không xác định":n.item_type==="product"?((d=n.product)==null?void 0:d.name)||"Sản phẩm không xác định":"Không xác định"},l=n=>({single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"})[n]||n,S=n=>({single:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800",combo_5:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",combo_10:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800"})[n]||"",q=n=>n?n.discount_type==="percentage"?`Giảm ${n.discount_value}%`:n.discount_type==="fixed"?`Giảm ${f(n.discount_value)}`:n.description||"":"",O=n=>{if(!n)return"";let r="";return n.discount_type==="percentage"?r=`Giảm ${n.discount_value}% `:n.discount_type==="fixed"&&(r=`Giảm ${f(n.discount_value)} `),n.min_order_amount&&(r+=`cho đơn hàng từ ${f(n.min_order_amount)}`),n.start_date&&n.end_date&&(r+=` (Có hiệu lực: ${T(n.start_date)} - ${T(n.end_date)})`),r||n.description||""},Z=V(()=>{const n=a.invoice.order;if(!(n!=null&&n.voucher_id))return"";const r=Number(n.discount_amount),d=Number(A.value);return r&&d?`Giảm ${(r/d*100).toFixed(1)}% (${f(r)})`:`Giảm ${f(n.discount_amount)}`}),U=_(!1),Y=V(()=>a.invoice.status==="pending"||a.invoice.status==="partial");return{paymentAmount:e,paymentMethod:o,paymentNote:s,processing:b,paymentType:u,selectPaymentType:C,getPaymentMethodText:k,toast:g,formatCurrency:f,formatDateTime:T,getStatusClass:L,getStatusText:M,processPayment:v,printInvoice:y,showPaymentForm:H,getItemName:G,formatServiceType:l,getServiceTypeClass:S,getVoucherDescription:q,subtotalAmount:A,getDetailedVoucherDescription:O,getVoucherInfo:Z,showCancelModal:U,canCancel:Y,confirmCancelInvoice:()=>{U.value=!0},cancelInvoice:async()=>{var n,r;try{const d=await J.post(`/invoices/${a.invoice.id}/cancel`);g.success("Hóa đơn đã được hủy thành công"),z.reload({only:["invoice"]}),U.value=!1}catch(d){console.error("Cancel invoice error:",d),g.error(((r=(n=d.response)==null?void 0:n.data)==null?void 0:r.message)||"Có lỗi xảy ra khi hủy hóa đơn")}},getOrderStatusClass:n=>{const r="px-2 py-1 rounded-full text-sm font-medium";return{pending:`${r} bg-yellow-100 text-yellow-800`,processing:`${r} bg-blue-100 text-blue-800`,completed:`${r} bg-green-100 text-green-800`,cancelled:`${r} bg-red-100 text-red-800`}[n]||`${r} bg-gray-100 text-gray-800`},getOrderStatusText:n=>({pending:"Chờ xử l",processing:"Đang xử lý",completed:"Hoàn thành",cancelled:"Đã hủy"})[n]||"Không xác định",getItemCode:n=>{var r,d;return n.item_type==="service"?((r=n.service)==null?void 0:r.code)||"-":n.item_type==="product"&&((d=n.product)==null?void 0:d.code)||"-"},printTemplateRef:h}}},Ot={class:"container mx-auto px-4 py-8"},Ft={class:"flex justify-between items-center mb-6"},Ut={class:"text-2xl font-semibold"},Rt={class:"flex space-x-4"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Kt={class:"bg-white p-6 rounded-lg shadow"},Et={class:"flex items-center space-x-2"},Xt={class:"bg-white p-6 rounded-lg shadow"},zt={class:"space-y-2"},Wt={class:"flex justify-between"},Jt={class:"font-medium"},Qt={key:0,class:"flex flex-col space-y-1"},Zt={class:"flex justify-between text-green-600"},Yt={class:"font-medium"},$t={class:"flex justify-between text-green-600"},te={class:"font-medium"},ee={class:"flex justify-between font-bold border-t border-gray-200 pt-2"},ne={class:"flex justify-between"},se={class:"text-green-600 font-medium"},oe={class:"flex justify-between"},ie={class:"text-red-600 font-medium"},re={class:"bg-white p-6 rounded-lg shadow mb-8"},ae={class:"grid grid-cols-2 gap-6"},le={class:"space-y-3"},de={class:"flex justify-between"},ce={class:"font-medium"},me={class:"flex justify-between"},ue={class:"font-medium"},ge={class:"flex justify-between"},ye={class:"font-medium"},xe={class:"flex justify-between"},fe={class:"font-medium"},pe={class:"space-y-3"},he={class:"flex justify-between"},be={class:"font-medium"},ve={class:"flex justify-between"},_e={class:"font-medium"},we={class:"flex justify-between"},Ce={class:"font-medium"},ke={class:"flex justify-between"},Te={class:"font-medium"},Se={class:"bg-white p-6 rounded-lg shadow mb-8"},Ne={class:"overflow-x-auto"},je={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"text-sm font-medium text-gray-900"},De={class:"text-xs text-gray-500"},Le={key:0,class:"text-sm text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900"},qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Oe={class:"bg-gray-50"},Fe={class:"px-6 py-4 text-right font-medium"},Ue={key:0,class:"bg-gray-50 text-green-600"},Re={class:"px-6 py-4 text-right font-medium"},Be={class:"bg-gray-100 font-bold"},Ke={class:"px-6 py-4 text-right"},Ee={key:0,class:"bg-white p-6 rounded-lg shadow mb-8"},Xe={class:"mb-4"},ze={class:"flex space-x-4"},We=["max","readonly"],Je={class:"mt-1 text-sm text-gray-500"},Qe=["disabled"],Ze={key:1,class:"bg-white p-6 rounded-lg shadow mb-8"},Ye={class:"overflow-x-auto"},$e={class:"min-w-full divide-y divide-gray-200"},tn={class:"bg-white divide-y divide-gray-200"},en={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},nn={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},sn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},on={class:"px-6 py-4 whitespace-nowrap"},rn={class:"px-6 py-4 whitespace-nowrap"},an={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ln={class:"px-6 py-4 text-sm text-gray-500"},dn={class:"bg-white p-6 rounded-lg shadow mb-8"},cn={class:"flex justify-between items-center mb-4"},mn={key:0,class:"grid grid-cols-2 gap-6"},un={class:"space-y-3"},gn={class:"flex justify-between"},yn={class:"flex justify-between"},xn={class:"font-medium"},fn={class:"space-y-3"},pn={class:"flex justify-between"},hn={class:"font-medium"},bn={key:0,class:"flex justify-between text-green-600"},vn={class:"font-medium"},_n={key:1,class:"text-center py-4 text-gray-500"},wn={class:"print-container",style:{display:"none"}},Cn={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},kn={class:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full"},Tn={class:"flex justify-end space-x-4"};function Sn(a,e,o,s,b,u){const g=P("Head"),C=P("Link"),k=P("SectionMain"),h=P("LayoutAuthenticated"),y=P("PrintInvoiceTemplate");return c(),m("div",null,[F(h,null,{default:B(()=>[F(g,{title:"Chi tiết hóa đơn"}),F(k,{breadcrumbs:[{label:"Quản lý hóa đơn",href:a.route("invoices.index")},{label:`Hóa đơn #${o.invoice.id}`}]},{default:B(()=>{var v,D,A,f,T,L,M,H,G;return[t("div",Ot,[t("div",Ft,[t("h1",Ut,"Chi tiết hóa đơn #"+i(o.invoice.id),1),t("div",Rt,[t("button",{onClick:e[0]||(e[0]=(...l)=>s.printInvoice&&s.printInvoice(...l)),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded flex items-center"},e[10]||(e[10]=[t("i",{class:"fas fa-print mr-2"},null,-1),I(" In hóa đơn ")])),s.canCancel?(c(),m("button",{key:0,onClick:e[1]||(e[1]=(...l)=>s.confirmCancelInvoice&&s.confirmCancelInvoice(...l)),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex items-center"},e[11]||(e[11]=[t("i",{class:"fas fa-times mr-2"},null,-1),I(" Hủy hóa đơn ")]))):x("",!0)])]),t("div",Bt,[t("div",Kt,[e[12]||(e[12]=t("h2",{class:"text-lg font-semibold mb-4"},"Trạng thái hóa đơn",-1)),t("div",Et,[t("span",{class:w([s.getStatusClass(o.invoice.status),"px-3 py-1 rounded-full text-sm"])},i(s.getStatusText(o.invoice.status)),3)])]),t("div",Xt,[e[19]||(e[19]=t("h2",{class:"text-lg font-semibold mb-4"},"Thông tin thanh toán",-1)),t("div",zt,[t("div",Wt,[e[13]||(e[13]=t("span",null,"Tổng tiền hàng:",-1)),t("span",Jt,i(s.formatCurrency(s.subtotalAmount)),1)]),(v=o.invoice.order)!=null&&v.voucher_id?(c(),m("div",Qt,[t("div",Zt,[e[14]||(e[14]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-ticket-alt mr-2"}),I(" Voucher áp dụng: ")],-1)),t("span",Yt,i(s.getVoucherInfo),1)]),t("div",$t,[e[15]||(e[15]=t("span",null,"Giảm giá:",-1)),t("span",te,"-"+i(s.formatCurrency(o.invoice.order.discount_amount)),1)])])):x("",!0),t("div",ee,[e[16]||(e[16]=t("span",null,"Tổng tiền sau giảm giá:",-1)),t("span",null,i(s.formatCurrency(o.invoice.total_amount)),1)]),t("div",ne,[e[17]||(e[17]=t("span",null,"Đã thanh toán:",-1)),t("span",se,i(s.formatCurrency(o.invoice.paid_amount)),1)]),t("div",oe,[e[18]||(e[18]=t("span",null,"Còn lại:",-1)),t("span",ie,i(s.formatCurrency(o.invoice.remaining_amount)),1)])])])]),t("div",re,[e[28]||(e[28]=t("h2",{class:"text-lg font-semibold mb-4"},"Thông tin chi tiết",-1)),t("div",ae,[t("div",le,[t("div",de,[e[20]||(e[20]=t("span",{class:"text-gray-600"},"Mã hóa đơn:",-1)),t("span",ce,"#"+i(o.invoice.id),1)]),t("div",me,[e[21]||(e[21]=t("span",{class:"text-gray-600"},"Ngày tạo:",-1)),t("span",ue,i(s.formatDateTime(o.invoice.created_at)),1)]),t("div",ge,[e[22]||(e[22]=t("span",{class:"text-gray-600"},"Người tạo:",-1)),t("span",ye,i(((D=o.invoice.created_by)==null?void 0:D.full_name)||"N/A"),1)]),t("div",xe,[e[23]||(e[23]=t("span",{class:"text-gray-600"},"Ghi chú:",-1)),t("span",fe,i(o.invoice.note||"-"),1)])]),t("div",pe,[t("div",he,[e[24]||(e[24]=t("span",{class:"text-gray-600"},"Khách hàng:",-1)),t("span",be,i((A=o.invoice.user)==null?void 0:A.full_name),1)]),t("div",ve,[e[25]||(e[25]=t("span",{class:"text-gray-600"},"Số điện thoại:",-1)),t("span",_e,i((f=o.invoice.user)==null?void 0:f.phone_number),1)]),t("div",we,[e[26]||(e[26]=t("span",{class:"text-gray-600"},"Email:",-1)),t("span",Ce,i(((T=o.invoice.user)==null?void 0:T.email)||"-"),1)]),t("div",ke,[e[27]||(e[27]=t("span",{class:"text-gray-600"},"Địa chỉ:",-1)),t("span",Te,i(((L=o.invoice.user)==null?void 0:L.address)||"-"),1)])])])]),t("div",Se,[e[36]||(e[36]=t("h2",{class:"text-lg font-semibold mb-4"},"Chi tiết đơn hàng",-1)),t("div",Ne,[t("table",je,[e[35]||(e[35]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," STT "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Sản phẩm/Dịch vụ "),t("th",{class:"px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Đơn giá "),t("th",{class:"px-6 py-3 bg-gray-50 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số lượng "),t("th",{class:"px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thành tiền "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",Ie,[(c(!0),m(E,null,X((M=o.invoice.order)==null?void 0:M.order_items,(l,S)=>{var q,O;return c(),m("tr",{key:l.id},[t("td",Ae,i(S+1),1),t("td",Pe,[t("div",Ve,i(l.item_name),1),t("div",De," Mã: "+i(((q=l.service)==null?void 0:q.code)||((O=l.product)==null?void 0:O.code)||"-"),1),l.description?(c(),m("div",Le,i(l.description),1)):x("",!0)]),t("td",Me,i(s.formatCurrency(Number(l.price)||0)),1),t("td",He,i(Number(l.quantity)||0),1),t("td",Ge,i(s.formatCurrency((Number(l.price)||0)*(Number(l.quantity)||0))),1),t("td",qe,[l.service_type?(c(),m("span",{key:0,class:w(s.getServiceTypeClass(l.service_type))},i(s.formatServiceType(l.service_type)),3)):x("",!0)])])}),128)),t("tr",Oe,[e[29]||(e[29]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium"}," Tổng tiền hàng: ",-1)),t("td",Fe,i(s.formatCurrency(s.subtotalAmount)),1),e[30]||(e[30]=t("td",null,null,-1))]),(H=o.invoice.order)!=null&&H.discount_amount?(c(),m("tr",Ue,[e[31]||(e[31]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium"}," Giảm giá: ",-1)),t("td",Re," -"+i(s.formatCurrency(o.invoice.order.discount_amount)),1),e[32]||(e[32]=t("td",null,null,-1))])):x("",!0),t("tr",Be,[e[33]||(e[33]=t("td",{colspan:"4",class:"px-6 py-4 text-right"}," Tổng tiền thanh toán: ",-1)),t("td",Ke,i(s.formatCurrency(o.invoice.total_amount)),1),e[34]||(e[34]=t("td",null,null,-1))])])])])]),s.showPaymentForm?(c(),m("div",Ee,[e[42]||(e[42]=t("h2",{class:"text-lg font-semibold mb-4"},"Thanh toán",-1)),t("form",{onSubmit:e[7]||(e[7]=rt((...l)=>s.processPayment&&s.processPayment(...l),["prevent"])),class:"space-y-4"},[t("div",Xe,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hình thức thanh toán",-1)),t("div",ze,[t("button",{type:"button",onClick:e[2]||(e[2]=l=>s.selectPaymentType("full")),class:w(["px-4 py-2 rounded-md",s.paymentType==="full"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Thanh toán tất cả ("+i(s.formatCurrency(o.invoice.remaining_amount))+") ",3),t("button",{type:"button",onClick:e[3]||(e[3]=l=>s.selectPaymentType("partial")),class:w(["px-4 py-2 rounded-md",s.paymentType==="partial"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Thanh toán một phần ",2)])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700"},"Số tiền thanh toán",-1)),K(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=l=>s.paymentAmount=l),max:o.invoice.remaining_amount,readonly:s.paymentType==="full",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:""},null,8,We),[[W,s.paymentAmount]]),t("p",Je," Số tiền cn lại cần thanh toán: "+i(s.formatCurrency(o.invoice.remaining_amount)),1)]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700"},"Phương thức thanh toán",-1)),K(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.paymentMethod=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:""},e[39]||(e[39]=[t("option",{value:"cash"},"Tiền mặt",-1),t("option",{value:"bank_transfer"},"Chuyển khoản",-1),t("option",{value:"card"},"Thẻ",-1)]),512),[[at,s.paymentMethod]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700"},"Ghi chú",-1)),K(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.paymentNote=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:"2"},null,512),[[W,s.paymentNote]])]),t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded",disabled:s.processing},i(s.processing?"Đang xử lý...":"Xác nhận thanh toán"),9,Qe)],32)])):x("",!0),((G=o.invoice.payment_histories)==null?void 0:G.length)>0?(c(),m("div",Ze,[e[44]||(e[44]=t("h2",{class:"text-lg font-semibold mb-4"},"Lịch sử thanh toán",-1)),t("div",Ye,[t("table",$e,[e[43]||(e[43]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thời gian "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số tiền "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Phương thức "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Trạng thái cũ "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Trạng thái mới "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Người thực hiện "),t("th",{class:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",tn,[(c(!0),m(E,null,X(o.invoice.payment_histories,l=>{var S;return c(),m("tr",{key:l.id},[t("td",en,i(s.formatDateTime(l.created_at)),1),t("td",nn,i(s.formatCurrency(l.payment_amount)),1),t("td",sn,i(s.getPaymentMethodText(l.payment_method)),1),t("td",on,[t("span",{class:w(s.getStatusClass(l.old_payment_status))},i(s.getStatusText(l.old_payment_status)),3)]),t("td",rn,[t("span",{class:w(s.getStatusClass(l.new_payment_status))},i(s.getStatusText(l.new_payment_status)),3)]),t("td",an,i(((S=l.created_by)==null?void 0:S.full_name)||"N/A"),1),t("td",ln,i(l.note||"-"),1)])}),128))])])])])):x("",!0),t("div",dn,[t("div",cn,[e[46]||(e[46]=t("h2",{class:"text-lg font-semibold"},"Thông tin đơn hàng",-1)),o.invoice.order?(c(),lt(C,{key:0,href:a.route("orders.show",o.invoice.order.id),class:"bg-blue-100 text-blue-700 hover:bg-blue-200 px-4 py-2 rounded-lg flex items-center transition-colors"},{default:B(()=>[e[45]||(e[45]=t("i",{class:"mdi mdi-shopping-outline mr-2"},null,-1)),I(" Xem đơn hàng #"+i(o.invoice.order.id),1)]),_:1},8,["href"])):x("",!0)]),o.invoice.order?(c(),m("div",mn,[t("div",un,[t("div",gn,[e[47]||(e[47]=t("span",{class:"text-gray-600"},"Trạng thái đơn hàng:",-1)),t("span",{class:w(s.getOrderStatusClass(o.invoice.order.status))},i(s.getOrderStatusText(o.invoice.order.status)),3)]),t("div",yn,[e[48]||(e[48]=t("span",{class:"text-gray-600"},"Ngày tạo đơn:",-1)),t("span",xn,i(s.formatDateTime(o.invoice.order.created_at)),1)])]),t("div",fn,[t("div",pn,[e[49]||(e[49]=t("span",{class:"text-gray-600"},"Tổng tiền hàng:",-1)),t("span",hn,i(s.formatCurrency(o.invoice.order.total_amount)),1)]),o.invoice.order.discount_amount>0?(c(),m("div",bn,[e[50]||(e[50]=t("span",null,"Giảm giá:",-1)),t("span",vn,"-"+i(s.formatCurrency(o.invoice.order.discount_amount)),1)])):x("",!0)])])):(c(),m("div",_n," Hóa đơn này không liên kết với đơn hàng nào "))])])]}),_:1},8,["breadcrumbs"])]),_:1}),t("div",wn,[F(y,{ref:"printTemplateRef",invoice:o.invoice,style:{visibility:"visible !important"}},null,8,["invoice"])]),s.showCancelModal?(c(),m("div",Cn,[t("div",kn,[e[51]||(e[51]=t("h3",{class:"text-lg font-semibold mb-4"},"Xác nhận hủy hóa đơn",-1)),e[52]||(e[52]=t("p",{class:"mb-4"},"Bạn có chắc chắn muốn hủy hóa đơn này? Hành động này không thể hoàn tác.",-1)),t("div",Tn,[t("button",{onClick:e[8]||(e[8]=v=>s.showCancelModal=!1),class:"px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded"}," Đóng "),t("button",{onClick:e[9]||(e[9]=(...v)=>s.cancelInvoice&&s.cancelInvoice(...v)),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded"}," Xác nhận hủy ")])])])):x("",!0)])}const _s=Q(qt,[["render",Sn]]);export{_s as default};
