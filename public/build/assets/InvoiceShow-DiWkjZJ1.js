import{Z as ut,i as mt,F as Q}from"./@inertiajs-D0DMCEQB.js";import{A as xt,L as gt}from"./LayoutAuthenticated-BBAlSYbr.js";import{_ as yt}from"./SectionMain-Vot1TOkK.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as P,aU as c,a2 as u,a3 as t,a9 as A,bf as s,F as z,b0 as W,a1 as y,a8 as ft,r as p,e as E,o as bt,b as kt,b2 as L,aa as U,bH as K,j as w,bM as pt,bJ as X,bA as Z,bz as ht,a0 as Y,T as vt}from"./@vue-BRgAy5zV.js";import{a as $}from"./axios-CCb-kr4I.js";import{u as _t}from"./vue-toastification-ejyjJRED.js";import{h as wt}from"./html2pdf.js-yYbeBQq1.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./@mdi-ArhfA4cU.js";import"./app-BdM1Db11.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./html2canvas-Dy2Co7Il.js";const Ct={components:{AllureLogo:xt},props:{invoice:{type:Object,required:!0}},setup(d){return{subtotalAmount:P(()=>{var a,r;return(r=(a=d.invoice)==null?void 0:a.order)!=null&&r.order_items?d.invoice.order.order_items.reduce((h,m)=>h+Number(m.price)*Number(m.quantity),0):0})}},methods:{formatCurrency(d){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(d)},formatDateTime(d){return new Date(d).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getItemName(d){var e,a;return d.item_type==="service"?((e=d.service)==null?void 0:e.service_name)||"Dịch vụ không xác định":d.item_type==="product"?((a=d.product)==null?void 0:a.name)||"Sản phẩm không xác định":"Không xác định"},getItemCode(d){var e,a;return d.item_type==="service"?((e=d.service)==null?void 0:e.code)||"-":d.item_type==="product"&&((a=d.product)==null?void 0:a.code)||"-"},formatServiceType(d){return{single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"}[d]||d}},mounted(){this.$emit("rendered")}},Tt={class:"print-template w-[76mm] mx-auto bg-white p-4 font-sans"},Nt={class:"text-center mb-8 border-y-2 border-gray-200 py-4"},St={class:"text-sm space-y-1.5 text-gray-600"},jt={class:"font-medium"},Pt={class:"mb-6 text-sm"},At={class:"grid grid-cols-1 gap-2"},It={class:"flex justify-between items-center"},Vt={class:"flex justify-between items-center"},Lt={class:"mb-6"},Dt={class:"w-full text-[11px]"},Mt={class:"py-1.5"},Ht={class:"font-medium"},Gt={class:"text-[9px] text-gray-600"},qt={key:0,class:"text-[9px] font-medium text-gray-600"},Rt={class:"py-1.5 text-right"},Ft={class:"py-1.5 text-right"},Ut={class:"py-1.5 text-right font-medium"},Ot={class:"text-sm space-y-2 mb-6"},Bt={class:"flex justify-between"},Et={key:0,class:"flex justify-between"},Kt={class:"flex justify-between font-bold border-t border-gray-200 pt-2"},Xt={class:"flex justify-between"},zt={class:"flex justify-between font-medium"};function Wt(d,e,a,r,h,m){var x,C,T,f;return c(),u("div",Tt,[e[9]||(e[9]=t("div",{class:"text-center mb-8"},[t("img",{src:"/images/icon-192x192.png",alt:"Allure Spa Logo",class:"w-16 h-16 mx-auto mb-4 object-contain"}),t("h1",{class:"text-2xl font-bold tracking-wider mb-2 text-gray-800"},"ALLURE SPA"),t("p",{class:"text-sm leading-relaxed text-gray-600"},[A(" 720A Điện Biên Phủ, P. 22, Bình Thạnh, HCM"),t("br"),A(" ĐT: (84) 986 910 920 ")])],-1)),t("div",Nt,[e[0]||(e[0]=t("h2",{class:"text-xl font-bold mb-3 tracking-wide text-gray-800"},"HÓA ĐƠN THANH TOÁN",-1)),t("div",St,[t("p",jt,"#"+s(a.invoice.id),1),t("p",null,s(m.formatDateTime(a.invoice.created_at)),1)])]),t("div",Pt,[t("div",At,[t("div",It,[e[1]||(e[1]=t("span",{class:"font-medium"},"Khách hàng:",-1)),t("span",null,s((x=a.invoice.user)==null?void 0:x.full_name),1)]),t("div",Vt,[e[2]||(e[2]=t("span",{class:"font-medium"},"Số điện thoại:",-1)),t("span",null,s((C=a.invoice.user)==null?void 0:C.phone_number),1)])])]),t("div",Lt,[t("table",Dt,[e[3]||(e[3]=t("thead",null,[t("tr",{class:"border-b border-gray-300"},[t("th",{class:"py-2 text-left font-bold"},"SP/DV"),t("th",{class:"py-2 text-right font-bold"},"SL"),t("th",{class:"py-2 text-right font-bold"},"Đơn giá"),t("th",{class:"py-2 text-right font-bold"},"T.Tiền")])],-1)),t("tbody",null,[(c(!0),u(z,null,W((T=a.invoice.order)==null?void 0:T.order_items,g=>(c(),u("tr",{key:g.id,class:"border-b border-gray-100"},[t("td",Mt,[t("div",Ht,s(m.getItemName(g)),1),t("div",Gt,s(m.getItemCode(g)),1),g.service_type?(c(),u("div",qt,s(m.formatServiceType(g.service_type)),1)):y("",!0)]),t("td",Rt,s(g.quantity),1),t("td",Ft,s(m.formatCurrency(g.price)),1),t("td",Ut,s(m.formatCurrency(g.price*g.quantity)),1)]))),128))])])]),t("div",Ot,[t("div",Bt,[e[4]||(e[4]=t("span",null,"Tổng tiền hàng:",-1)),t("span",null,s(m.formatCurrency(r.subtotalAmount)),1)]),(f=a.invoice.order)!=null&&f.discount_amount?(c(),u("div",Et,[e[5]||(e[5]=t("span",null,"Giảm giá:",-1)),t("span",null,"-"+s(m.formatCurrency(a.invoice.order.discount_amount)),1)])):y("",!0),t("div",Kt,[e[6]||(e[6]=t("span",null,"Tổng thanh toán:",-1)),t("span",null,s(m.formatCurrency(a.invoice.total_amount)),1)]),t("div",Xt,[e[7]||(e[7]=t("span",null,"Đã thanh toán:",-1)),t("span",null,s(m.formatCurrency(a.invoice.paid_amount)),1)]),t("div",zt,[e[8]||(e[8]=t("span",null,"Còn lại:",-1)),t("span",null,s(m.formatCurrency(a.invoice.remaining_amount)),1)])]),e[10]||(e[10]=ft('<div class="mt-10 text-center space-y-3 border-t-2 border-gray-200 pt-6" data-v-4d642cf5><p class="font-medium text-gray-800 text-base" data-v-4d642cf5>Cảm ơn quý khách đã sử dụng dịch vụ!</p><div class="text-sm text-gray-600 space-y-1.5" data-v-4d642cf5><p class="font-medium" data-v-4d642cf5>Hotline: (84) 986 910 920</p><p class="font-medium" data-v-4d642cf5>Website: www.allurespa.com.vn</p></div></div>',1))])}const Jt=tt(Ct,[["render",Wt],["__scopeId","data-v-4d642cf5"]]),Qt={components:{Head:ut,Link:mt,LayoutAuthenticated:gt,SectionMain:yt,PrintInvoiceTemplate:Jt},props:{invoice:{type:Object,required:!0}},setup(d){const e=p(0),a=p("cash"),r=p(""),h=p(!1),m=p("partial"),x=_t();E(m,n=>{n==="full"?e.value=d.invoice.remaining_amount:e.value=0}),E(e,n=>{n>d.invoice.remaining_amount&&(e.value=d.invoice.remaining_amount)});const C=n=>{m.value=n,n==="full"?e.value=d.invoice.remaining_amount:e.value=0},T=n=>({cash:"Tiền mặt",bank_transfer:"Chuyển khoản",card:"Thẻ"})[n]||n,f=p(!1),g=p(null),v=async()=>{try{let j=function(){URL.revokeObjectURL(V),document.body.contains(o)&&document.body.removeChild(o),f.value=!1};const n=g.value.$el,o=document.createElement("div");o.appendChild(n.cloneNode(!0)),document.body.appendChild(o);const l={margin:5,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,width:302},jsPDF:{unit:"mm",format:[80,297],orientation:"portrait"}},_=await wt().set(l).from(o.firstChild).outputPdf("blob"),V=URL.createObjectURL(_),k=window.open(V,"_blank","width=800,height=600");if(k){k.onload=()=>{k.print()};const B=setInterval(()=>{k.closed&&(clearInterval(B),j())},1e3);k.onafterprint=()=>{clearInterval(B),j()},k.onbeforeunload=()=>{clearInterval(B),j()}}else x.error("Vui lòng cho phép popup để in hóa đơn!"),j()}catch(n){console.error("Print error:",n),x.error("Có lỗi xảy ra khi in. Vui lòng thử lại!"),f.value=!1}},D=async()=>{f.value=!0},M=async()=>{var n,o;h.value=!0;try{const l=await $.post(`/invoices/${d.invoice.id}/process-payment`,{payment_amount:e.value,payment_method:a.value,note:r.value,payment_proof:null});x.success("Đã cập nhật thanh toán cho hóa đơn"),l.data.data.status==="paid"&&x.success("Hóa đơn đã được thanh toán đầy đủ"),Q.reload({only:["invoice"]}),e.value=0,r.value=""}catch(l){console.error("Payment processing error:",l),x.error(((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"Có lỗi xảy ra khi xử lý thanh toán")}finally{h.value=!1}},H=()=>{var n,o,l;return(l=(o=(n=d.invoice)==null?void 0:n.order)==null?void 0:o.orderItems)!=null&&l.length?d.invoice.order.orderItems.reduce((_,V)=>{const k=Number(V.price)||0,j=Number(V.quantity)||0;return _+k*j},0):0},I=P(()=>{var n,o,l,_;return(o=(n=d.invoice)==null?void 0:n.order)!=null&&o.total_amount&&((_=(l=d.invoice)==null?void 0:l.order)!=null&&_.discount_amount)?Number(d.invoice.order.total_amount)+Number(d.invoice.order.discount_amount):H()}),b=n=>{const o=Number(n);return isNaN(o)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(o)},N=n=>new Date(n).toLocaleString("vi-VN"),G=n=>{switch(n){case"pending":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800";case"partial":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800";case"paid":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800";case"cancelled":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800";default:return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"}},q=n=>{switch(n){case"pending":return"Chờ thanh toán";case"partial":return"Thanh toán một phần";case"paid":return"Đã thanh toán";case"cancelled":return"Đã hủy";default:return"Không xác định"}},i=P(()=>d.invoice.status!=="paid"&&d.invoice.status!=="cancelled");E(e,n=>{n>d.invoice.remaining_amount&&(e.value=d.invoice.remaining_amount,x.warning("Số tiền không thể lớn hơn số tiền cần thanh toán"))});const S=n=>n.item_name??"Không xác định",R=n=>({single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"})[n]||n,F=n=>({single:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800",combo_5:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",combo_10:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800"})[n]||"",et=n=>n?n.discount_type==="percentage"?`Giảm ${n.discount_value}%`:n.discount_type==="fixed"?`Giảm ${b(n.discount_value)}`:n.description||"":"",nt=n=>{if(!n)return"";let o="";return n.discount_type==="percentage"?o=`Giảm ${n.discount_value}% `:n.discount_type==="fixed"&&(o=`Giảm ${b(n.discount_value)} `),n.min_order_amount&&(o+=`cho đơn hàng từ ${b(n.min_order_amount)}`),n.start_date&&n.end_date&&(o+=` (Có hiệu lực: ${N(n.start_date)} - ${N(n.end_date)})`),o||n.description||""},rt=P(()=>{const n=d.invoice.order;if(!(n!=null&&n.voucher_id))return"";const o=Number(n.discount_amount),l=Number(I.value);return o&&l?`Giảm ${(o/l*100).toFixed(1)}% (${b(o)})`:`Giảm ${b(n.discount_amount)}`}),O=p(!1),at=P(()=>d.invoice.status==="pending"||d.invoice.status==="partial"),st=()=>{O.value=!0},ot=async()=>{var n,o;try{const l=await $.post(`/invoices/${d.invoice.id}/cancel`);x.success("Hóa đơn đã được hủy thành công"),Q.reload({only:["invoice"]}),O.value=!1}catch(l){console.error("Cancel invoice error:",l),x.error(((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"Có lỗi xảy ra khi hủy hóa đơn")}},dt=n=>{const o="px-2 py-1 rounded-full text-sm font-medium";return{pending:`${o} bg-yellow-100 text-yellow-800`,processing:`${o} bg-blue-100 text-blue-800`,completed:`${o} bg-green-100 text-green-800`,cancelled:`${o} bg-red-100 text-red-800`}[n]||`${o} bg-gray-100 text-gray-800`},it=n=>({pending:"Chờ xử lý",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[n]||"Không xác định",lt=n=>{var o,l;return n.item_type==="service"?((o=n.service)==null?void 0:o.code)||"-":n.item_type==="product"&&((l=n.product)==null?void 0:l.code)||"-"},J=P({get(){return b(e.value)},set(n){const o=Number(n.replace(/[^0-9.-]+/g,""));e.value=isNaN(o)?0:o}}),ct=n=>{J.value=n.target.value};return bt(()=>{const n=o=>{o.key==="Escape"&&f.value&&(f.value=!1)};window.addEventListener("keydown",n),kt(()=>{window.removeEventListener("keydown",n)})}),{paymentAmount:e,paymentMethod:a,paymentNote:r,processing:h,paymentType:m,selectPaymentType:C,getPaymentMethodText:T,toast:x,formatCurrency:b,formatDateTime:N,getStatusClass:G,getStatusText:q,processPayment:M,printInvoice:D,showPaymentForm:i,getItemName:S,formatServiceType:R,getServiceTypeClass:F,getVoucherDescription:et,subtotalAmount:I,getDetailedVoucherDescription:nt,getVoucherInfo:rt,showCancelModal:O,canCancel:at,confirmCancelInvoice:st,cancelInvoice:ot,getOrderStatusClass:dt,getOrderStatusText:it,getItemCode:lt,printTemplateRef:g,formattedPaymentAmount:J,updatePaymentAmount:ct,isPrinting:f,handlePrintAfterRender:v}}},Zt={class:"container mx-auto px-4 py-8"},Yt={class:"flex justify-between items-center mb-6"},$t={class:"text-2xl font-semibold text-gray-900 dark:text-dark-text"},te={class:"flex space-x-4"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},ne={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow"},re={class:"flex items-center space-x-2"},ae={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow"},se={class:"space-y-2"},oe={class:"flex justify-between"},de={class:"font-medium text-gray-900 dark:text-dark-text"},ie={key:0,class:"flex flex-col space-y-1"},le={class:"flex justify-between text-green-600"},ce={class:"font-medium"},ue={class:"flex justify-between text-green-600"},me={class:"font-medium"},xe={class:"flex justify-between font-bold border-t border-gray-200 dark:border-dark-border pt-2"},ge={class:"text-gray-900 dark:text-dark-text"},ye={class:"flex justify-between"},fe={class:"text-green-600 font-medium"},be={class:"flex justify-between"},ke={class:"text-red-600 font-medium"},pe={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},he={class:"grid grid-cols-2 gap-6"},ve={class:"space-y-3"},_e={class:"flex justify-between"},we={class:"font-medium text-gray-900 dark:text-dark-text"},Ce={class:"flex justify-between"},Te={class:"font-medium text-gray-900 dark:text-dark-text"},Ne={class:"flex justify-between"},Se={class:"font-medium text-gray-900 dark:text-dark-text"},je={class:"flex justify-between"},Pe={class:"font-medium text-gray-900 dark:text-dark-text"},Ae={class:"space-y-3"},Ie={class:"flex justify-between"},Ve={class:"font-medium text-gray-900 dark:text-dark-text"},Le={class:"flex justify-between"},De={class:"font-medium text-gray-900 dark:text-dark-text"},Me={class:"flex justify-between"},He={class:"font-medium text-gray-900 dark:text-dark-text"},Ge={class:"flex justify-between"},qe={class:"font-medium text-gray-900 dark:text-dark-text"},Re={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},Fe={class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200 dark:divide-dark-border"},Oe={class:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border"},Be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},Ee={class:"px-6 py-4 whitespace-nowrap"},Ke={class:"text-sm font-medium text-gray-900 dark:text-dark-text"},Xe={class:"text-xs text-gray-500 dark:text-dark-text-muted"},ze={key:0,class:"text-sm text-gray-500 dark:text-dark-text-muted"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-dark-text-muted"},Je={class:"px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-dark-text-muted"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900 dark:text-dark-text"},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},Ye={class:"bg-gray-50 dark:bg-dark-surface"},$e={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"},tn={key:0,class:"bg-gray-50 dark:bg-dark-surface text-green-600"},en={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"},nn={class:"bg-gray-100 dark:bg-dark-surface font-bold"},rn={class:"px-6 py-4 text-right text-gray-900 dark:text-dark-text"},an={key:0,class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},sn={class:"mb-4"},on={class:"flex space-x-4"},dn={class:"mt-1 text-sm text-gray-500 dark:text-dark-text-muted"},ln=["disabled"],cn={key:1,class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},un={class:"overflow-x-auto"},mn={class:"min-w-full divide-y divide-gray-200 dark:divide-dark-border"},xn={class:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border"},gn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},yn={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-dark-text"},fn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},bn={class:"px-6 py-4 whitespace-nowrap"},kn={class:"px-6 py-4 whitespace-nowrap"},pn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},hn={class:"px-6 py-4 text-sm text-gray-500 dark:text-dark-text-muted"},vn={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},_n={class:"flex justify-between items-center mb-4"},wn={key:0,class:"grid grid-cols-2 gap-6"},Cn={class:"space-y-3"},Tn={class:"flex justify-between"},Nn={class:"flex justify-between"},Sn={class:"font-medium text-gray-900 dark:text-dark-text"},jn={class:"space-y-3"},Pn={class:"flex justify-between"},An={class:"font-medium text-gray-900 dark:text-dark-text"},In={key:0,class:"flex justify-between text-green-600"},Vn={class:"font-medium"},Ln={key:1,class:"text-center py-4 text-gray-500 dark:text-dark-text-muted"},Dn={class:"print-container",style:{display:"none"}},Mn={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Hn={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow-lg max-w-md w-full"},Gn={class:"flex justify-end space-x-4"};function qn(d,e,a,r,h,m){const x=L("Head"),C=L("Link"),T=L("PrintInvoiceTemplate"),f=L("SectionMain"),g=L("LayoutAuthenticated");return c(),u("div",null,[U(g,null,{default:K(()=>[U(x,{title:"Chi tiết hóa đơn"}),U(f,{breadcrumbs:[{label:"Quản lý hóa đơn",href:d.route("invoices.index")},{label:`Hóa đơn #${a.invoice.id}`}]},{default:K(()=>{var v,D,M,H,I,b,N,G,q;return[t("div",Zt,[t("div",Yt,[t("h1",$t,"Chi tiết hóa đơn #"+s(a.invoice.id),1),t("div",te,[t("button",{onClick:e[0]||(e[0]=(...i)=>r.printInvoice&&r.printInvoice(...i)),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded flex items-center"},e[11]||(e[11]=[t("i",{class:"fas fa-print mr-2"},null,-1),A(" In hóa đơn ")])),r.canCancel?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...i)=>r.confirmCancelInvoice&&r.confirmCancelInvoice(...i)),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex items-center"},e[12]||(e[12]=[t("i",{class:"fas fa-times mr-2"},null,-1),A(" Hủy hóa đơn ")]))):y("",!0)])]),t("div",ee,[t("div",ne,[e[13]||(e[13]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Trạng thái hóa đơn",-1)),t("div",re,[t("span",{class:w([r.getStatusClass(a.invoice.status),"px-3 py-1 rounded-full text-sm"])},s(r.getStatusText(a.invoice.status)),3)])]),t("div",ae,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thông tin thanh toán",-1)),t("div",se,[t("div",oe,[e[14]||(e[14]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền hàng:",-1)),t("span",de,s(r.formatCurrency(r.subtotalAmount)),1)]),(v=a.invoice.order)!=null&&v.voucher_id?(c(),u("div",ie,[t("div",le,[e[15]||(e[15]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-ticket-alt mr-2"}),A(" Voucher áp dụng: ")],-1)),t("span",ce,s(r.getVoucherInfo),1)]),t("div",ue,[e[16]||(e[16]=t("span",null,"Giảm giá:",-1)),t("span",me,"-"+s(r.formatCurrency(a.invoice.order.discount_amount)),1)])])):y("",!0),t("div",xe,[e[17]||(e[17]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền sau giảm giá:",-1)),t("span",ge,s(r.formatCurrency(a.invoice.total_amount)),1)]),t("div",ye,[e[18]||(e[18]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Đã thanh toán:",-1)),t("span",fe,s(r.formatCurrency(a.invoice.paid_amount)),1)]),t("div",be,[e[19]||(e[19]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Còn lại:",-1)),t("span",ke,s(r.formatCurrency(a.invoice.remaining_amount)),1)])])])]),t("div",pe,[e[29]||(e[29]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thông tin chi tiết",-1)),t("div",he,[t("div",ve,[t("div",_e,[e[21]||(e[21]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Mã hóa đơn:",-1)),t("span",we,"#"+s(a.invoice.id),1)]),t("div",Ce,[e[22]||(e[22]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ngày tạo:",-1)),t("span",Te,s(r.formatDateTime(a.invoice.created_at)),1)]),t("div",Ne,[e[23]||(e[23]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Người tạo:",-1)),t("span",Se,s(((D=a.invoice.created_by)==null?void 0:D.full_name)||"N/A"),1)]),t("div",je,[e[24]||(e[24]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ghi chú:",-1)),t("span",Pe,s(a.invoice.note||"-"),1)])]),t("div",Ae,[t("div",Ie,[e[25]||(e[25]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Khách hàng:",-1)),t("span",Ve,s((M=a.invoice.user)==null?void 0:M.full_name),1)]),t("div",Le,[e[26]||(e[26]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Số điện thoại:",-1)),t("span",De,s((H=a.invoice.user)==null?void 0:H.phone_number),1)]),t("div",Me,[e[27]||(e[27]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Email:",-1)),t("span",He,s(((I=a.invoice.user)==null?void 0:I.email)||"-"),1)]),t("div",Ge,[e[28]||(e[28]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Địa chỉ:",-1)),t("span",qe,s(((b=a.invoice.user)==null?void 0:b.address)||"-"),1)])])])]),t("div",Re,[e[37]||(e[37]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Chi tiết đơn hàng",-1)),t("div",Fe,[t("table",Ue,[e[36]||(e[36]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," STT "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Sản phẩm/Dịch vụ "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-right text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Đơn giá "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-center text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Số lượng "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-right text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Thành tiền "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",Oe,[(c(!0),u(z,null,W((N=a.invoice.order)==null?void 0:N.order_items,(i,S)=>{var R,F;return c(),u("tr",{key:i.id},[t("td",Be,s(S+1),1),t("td",Ee,[t("div",Ke,s(i.item_name),1),t("div",Xe," Mã sản phẩm/dịch vụ: "+s(((R=i.service)==null?void 0:R.id)||((F=i.product)==null?void 0:F.id)||"-"),1),i.description?(c(),u("div",ze,s(i.description),1)):y("",!0)]),t("td",We,s(r.formatCurrency(Number(i.price)||0)),1),t("td",Je,s(Number(i.quantity)||0),1),t("td",Qe,s(r.formatCurrency((Number(i.price)||0)*(Number(i.quantity)||0))),1),t("td",Ze,[i.service_type?(c(),u("span",{key:0,class:w(r.getServiceTypeClass(i.service_type))},s(r.formatServiceType(i.service_type)),3)):y("",!0)])])}),128)),t("tr",Ye,[e[30]||(e[30]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"}," Tổng tiền hàng: ",-1)),t("td",$e,s(r.formatCurrency(r.subtotalAmount)),1),e[31]||(e[31]=t("td",null,null,-1))]),(G=a.invoice.order)!=null&&G.discount_amount?(c(),u("tr",tn,[e[32]||(e[32]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"}," Giảm giá: ",-1)),t("td",en," -"+s(r.formatCurrency(a.invoice.order.discount_amount)),1),e[33]||(e[33]=t("td",null,null,-1))])):y("",!0),t("tr",nn,[e[34]||(e[34]=t("td",{colspan:"4",class:"px-6 py-4 text-right text-gray-900 dark:text-dark-text"}," Tổng tiền thanh toán: ",-1)),t("td",rn,s(r.formatCurrency(a.invoice.total_amount)),1),e[35]||(e[35]=t("td",null,null,-1))])])])])]),r.showPaymentForm?(c(),u("div",an,[e[43]||(e[43]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thanh toán",-1)),t("form",{onSubmit:e[8]||(e[8]=pt((...i)=>r.processPayment&&r.processPayment(...i),["prevent"])),class:"space-y-4"},[t("div",sn,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted mb-2"},"Hình thức thanh toán",-1)),t("div",on,[t("button",{type:"button",onClick:e[2]||(e[2]=i=>r.selectPaymentType("full")),class:w(["px-4 py-2 rounded-md",r.paymentType==="full"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-dark-surface text-gray-700 dark:text-dark-text-muted hover:bg-gray-200 dark:hover:bg-dark-hover"])}," Thanh toán tất cả ("+s(r.formatCurrency(a.invoice.remaining_amount))+") ",3),t("button",{type:"button",onClick:e[3]||(e[3]=i=>r.selectPaymentType("partial")),class:w(["px-4 py-2 rounded-md",r.paymentType==="partial"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-dark-surface text-gray-700 dark:text-dark-text-muted hover:bg-gray-200 dark:hover:bg-dark-hover"])}," Thanh toán một phần ",2)])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"},"Số tiền thanh toán",-1)),X(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=i=>r.formattedPaymentAmount=i),onInput:e[5]||(e[5]=(...i)=>r.updatePaymentAmount&&r.updatePaymentAmount(...i)),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",required:""},null,544),[[Z,r.formattedPaymentAmount]]),t("p",dn," Số tiền còn lại cần thanh toán: "+s(r.formatCurrency(a.invoice.remaining_amount)),1)]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"},"Phương thức thanh toán",-1)),X(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.paymentMethod=i),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",required:""},e[40]||(e[40]=[t("option",{value:"cash"},"Tiền mặt",-1),t("option",{value:"bank_transfer"},"Chuyển khoản",-1),t("option",{value:"card"},"Thẻ",-1)]),512),[[ht,r.paymentMethod]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"},"Ghi chú",-1)),X(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.paymentNote=i),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",rows:"2"},null,512),[[Z,r.paymentNote]])]),t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors dark:bg-green-600 dark:hover:bg-green-700",disabled:r.processing},s(r.processing?"Đang xử lý...":"Xác nhận thanh toán"),9,ln)],32)])):y("",!0),((q=a.invoice.payment_histories)==null?void 0:q.length)>0?(c(),u("div",cn,[e[45]||(e[45]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Lịch sử thanh toán",-1)),t("div",un,[t("table",mn,[e[44]||(e[44]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Thời gian "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Số tiền "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Phương thức "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Trạng thái cũ "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Trạng thái mới "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Người thực hiện "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",xn,[(c(!0),u(z,null,W(a.invoice.payment_histories,i=>{var S;return c(),u("tr",{key:i.id},[t("td",gn,s(r.formatDateTime(i.created_at)),1),t("td",yn,s(r.formatCurrency(i.payment_amount)),1),t("td",fn,s(r.getPaymentMethodText(i.payment_method)),1),t("td",bn,[t("span",{class:w(r.getStatusClass(i.old_payment_status))},s(r.getStatusText(i.old_payment_status)),3)]),t("td",kn,[t("span",{class:w(r.getStatusClass(i.new_payment_status))},s(r.getStatusText(i.new_payment_status)),3)]),t("td",pn,s(((S=i.created_by)==null?void 0:S.full_name)||"N/A"),1),t("td",hn,s(i.note||"-"),1)])}),128))])])])])):y("",!0),t("div",vn,[t("div",_n,[e[47]||(e[47]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-dark-text"},"Thông tin đơn hàng",-1)),a.invoice.order?(c(),Y(C,{key:0,href:d.route("orders.show",a.invoice.order.id),class:"bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg flex items-center transition-colors dark:bg-blue-900 dark:hover:bg-blue-800 dark:text-blue-100"},{default:K(()=>[e[46]||(e[46]=t("i",{class:"mdi mdi-shopping-outline mr-2"},null,-1)),A(" Xem đơn hàng #"+s(a.invoice.order.id),1)]),_:1},8,["href"])):y("",!0)]),a.invoice.order?(c(),u("div",wn,[t("div",Cn,[t("div",Tn,[e[48]||(e[48]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Trạng thái đơn hàng:",-1)),t("span",{class:w(r.getOrderStatusClass(a.invoice.order.status))},s(r.getOrderStatusText(a.invoice.order.status)),3)]),t("div",Nn,[e[49]||(e[49]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ngày tạo đơn:",-1)),t("span",Sn,s(r.formatDateTime(a.invoice.order.created_at)),1)])]),t("div",jn,[t("div",Pn,[e[50]||(e[50]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền hàng:",-1)),t("span",An,s(r.formatCurrency(a.invoice.order.total_amount)),1)]),a.invoice.order.discount_amount>0?(c(),u("div",In,[e[51]||(e[51]=t("span",null,"Giảm giá:",-1)),t("span",Vn,"-"+s(r.formatCurrency(a.invoice.order.discount_amount)),1)])):y("",!0)])])):(c(),u("div",Ln," Hóa đơn này không liên kết với đơn hàng nào "))])]),r.isPrinting?(c(),Y(vt,{key:0,to:"body"},[t("div",Dn,[U(T,{ref:"printTemplateRef",invoice:a.invoice,onRendered:r.handlePrintAfterRender},null,8,["invoice","onRendered"])])])):y("",!0)]}),_:1},8,["breadcrumbs"])]),_:1}),r.showCancelModal?(c(),u("div",Mn,[t("div",Hn,[e[52]||(e[52]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Xác nhận hủy hóa đơn",-1)),e[53]||(e[53]=t("p",{class:"mb-4 text-gray-600 dark:text-dark-text-muted"},"Bạn có chắc chắn muốn hủy hóa đơn này? Hành động này không thể hoàn tác.",-1)),t("div",Gn,[t("button",{onClick:e[9]||(e[9]=v=>r.showCancelModal=!1),class:"px-4 py-2 bg-gray-300 dark:bg-dark-surface hover:bg-gray-400 dark:hover:bg-dark-hover rounded"}," Đóng "),t("button",{onClick:e[10]||(e[10]=(...v)=>r.cancelInvoice&&r.cancelInvoice(...v)),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded"}," Xác nhận hủy ")])])])):y("",!0)])}const jr=tt(Qt,[["render",qn]]);export{jr as default};
