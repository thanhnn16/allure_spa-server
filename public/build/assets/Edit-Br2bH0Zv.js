import{r as p,c as g,e as T,o as q,aU as s,a0 as J,bH as x,aa as h,bl as B,a3 as a,bf as n,a9 as V,j as P,bJ as d,bz as c,a2 as l,b0 as v,F as b,bA as $,a1 as M,bM as Z}from"./@vue-BRgAy5zV.js";import{L as I}from"./LayoutAuthenticated-WadtD5fF.js";import{_ as Q}from"./SectionMain-BbIPmLtw.js";import{_ as j}from"./CardBox-jfYP3QDG.js";import{Z as R,F}from"./@inertiajs-D0DMCEQB.js";import{a as y}from"./axios-CCb-kr4I.js";import{u as W}from"./vue-toastification-ejyjJRED.js";import"./@mdi-Dzgtc9aE.js";import"./app-qysCtdHT.js";import"./jspdf-Ciebq7We.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./deepmerge-CtOfIP5S.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./BaseIcon-B4kwkOCn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";const X={class:"flex justify-between items-center"},Y={class:"text-2xl font-bold text-gray-900 dark:text-white"},ee={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},te={class:"font-medium text-gray-900 dark:text-white"},ae={class:"flex items-center space-x-2"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={class:"px-4 py-2.5 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},oe=["value"],se=["value"],ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le=["min"],de=["value","disabled"],ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},me={key:0,class:"text-sm text-gray-500"},ge=["disabled"],ce=["value"],ve={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},be={key:0,class:"text-sm text-gray-500"},ye=["disabled"],fe=["value","disabled"],xe={class:"flex justify-end space-x-4"},he=["disabled"],dt={__name:"Edit",props:{appointment:{type:Object,required:!0},timeSlots:{type:Array,default:()=>[]}},setup(u){const k=W(),o=u;p(null);const f=p(!1),U=p([]),D=p([]),_=p([]),i=p({appointment_date:o.appointment.appointment_date,time_slot_id:o.appointment.time_slot_id,note:o.appointment.note,slots:o.appointment.slots,staff_id:o.appointment.staff_user_id,service_id:o.appointment.service_id,user_service_package_id:o.appointment.user_service_package_id,appointment_type:o.appointment.appointment_type,status:o.appointment.status}),L=g(()=>i.value.appointment_type==="service_package"),E=g(()=>i.value.appointment_type==="service"),K=g(()=>(i.value.appointment_date,o.appointment.id,o.timeSlots.map(r=>{const e=r.current_bookings-(r.id===o.appointment.time_slot_id?i.value.slots:0);return{...r,current_bookings:e,available:e<r.max_bookings,displayText:`${r.start_time.substring(0,5)} - ${r.end_time.substring(0,5)} (${e}/${r.max_bookings})`}}))),w=g(()=>[{value:"pending",label:"Chờ xác nhận",color:"bg-yellow-100 text-yellow-800"},{value:"confirmed",label:"Đã xác nhận",color:"bg-blue-100 text-blue-800"},{value:"completed",label:"Hoàn thành",color:"bg-green-100 text-green-800"},{value:"cancelled",label:"Đã hủy",color:"bg-red-100 text-red-800"}]),O=g(()=>({service:"Dịch vụ đơn lẻ",service_package:"Gói điều trị",consultation:"Tư vấn",others:"Khác"})[i.value.appointment_type]||"Không xác định"),A=async()=>{var r,e;try{f.value=!0,(await y.put(`/api/appointments/${o.appointment.id}`,i.value)).data.success&&(k.success("Cập nhật lịch hẹn thành công"),setTimeout(()=>{F.visit(`/appointments/${o.appointment.id}`)},1e3))}catch(t){k.error(((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||"Có lỗi xảy ra khi cập nhật lịch hẹn")}finally{f.value=!1}},G=async()=>{try{const r=await y.get("/api/users/get-staff-list");U.value=r.data.data||[]}catch(r){console.error("Error fetching staff list:",r)}},H=async()=>{try{const r=await y.get("/api/services/appointment");D.value=r.data.data||[]}catch(r){console.error("Error fetching services:",r)}},z=async()=>{try{const r=await y.get(`/api/user-treatment-packages/${o.appointment.user_id}`);_.value=r.data.data||[]}catch(r){console.error("Error fetching user treatment packages:",r)}},S=async()=>{try{const r=await y.get("/api/appointments/available-time-slots",{params:{date:i.value.appointment_date,service_id:i.value.service_id}});r.data.success&&(o.timeSlots=r.data.data)}catch(r){console.error("Error fetching time slots:",r),k.error("Không thể tải danh sách khung giờ")}};return T(()=>i.value.appointment_date,r=>{r&&S()}),T(()=>i.value.service_id,r=>{r&&(i.value.user_service_package_id=null,i.value.appointment_type="service",S())}),T(()=>i.value.user_service_package_id,r=>{if(r){i.value.service_id=null,i.value.appointment_type="service_package";const e=_.value.find(t=>t.id===r);e!=null&&e.service_id&&S()}}),q(()=>{G(),H(),z()}),(r,e)=>(s(),J(I,null,{default:x(()=>[h(B(R),{title:"Chỉnh sửa lịch hẹn"}),h(Q,{breadcrumbs:[{label:"Lịch hẹn",href:r.route("appointments.index")},{label:"Chi tiết",href:`/appointments/${u.appointment.id}`},{label:"Chỉnh sửa"}]},{default:x(()=>[h(j,{class:"mb-6"},{default:x(()=>{var t,m,N;return[a("div",X,[a("div",null,[a("h1",Y," Chỉnh sửa lịch hẹn #"+n(u.appointment.id),1),a("p",ee,[e[9]||(e[9]=V(" Cập nhật thông tin lịch hẹn của khách hàng ")),a("span",te,n((t=u.appointment.user)==null?void 0:t.full_name),1)])]),a("div",ae,[a("span",{class:P(["px-3 py-1 rounded-full text-sm font-medium",(m=w.value.find(C=>C.value===u.appointment.status))==null?void 0:m.color])},n((N=w.value.find(C=>C.value===u.appointment.status))==null?void 0:N.label),3)])])]}),_:1}),h(j,null,{default:x(()=>[a("form",{onSubmit:Z(A,["prevent"]),class:"space-y-8"},[a("div",re,[a("div",null,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Loại lịch hẹn ",-1)),a("div",ie,n(O.value),1)]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Trạng thái ",-1)),d(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.status=t),class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},[(s(!0),l(b,null,v(w.value,t=>(s(),l("option",{key:t.value,value:t.value},n(t.label),9,oe))),128))],512),[[c,i.value.status]])]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Nhân viên phụ trách ",-1)),d(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.staff_id=t),class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},[(s(!0),l(b,null,v(U.value,t=>(s(),l("option",{key:t.id,value:t.id},n(t.full_name),9,se))),128))],512),[[c,i.value.staff_id]])]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Số lượng slot ",-1)),d(a("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=t=>i.value.slots=t),min:"1",max:"2",class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},null,512),[[$,i.value.slots]])])]),a("div",ne,[a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Ngày hẹn ",-1)),d(a("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>i.value.appointment_date=t),min:new Date().toISOString().split("T")[0],class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},null,8,le),[[$,i.value.appointment_date]])]),a("div",null,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Khung giờ ",-1)),d(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.time_slot_id=t),class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},[e[15]||(e[15]=a("option",{value:""},"Chọn khung giờ",-1)),(s(!0),l(b,null,v(K.value,t=>(s(),l("option",{key:t.id,value:t.id,disabled:!t.available||t.current_bookings+i.value.slots>t.max_bookings},n(t.displayText)+" "+n(t.available?"":"(Đã đầy)"),9,de))),128))],512),[[c,i.value.time_slot_id]])])]),a("div",ue,[a("div",null,[a("label",pe,[e[17]||(e[17]=V(" Dịch vụ ")),L.value?(s(),l("span",me," (Đã chọn gói điều trị) ")):M("",!0)]),d(a("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.service_id=t),disabled:L.value,class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},[e[18]||(e[18]=a("option",{value:""},"Chọn dịch vụ",-1)),(s(!0),l(b,null,v(D.value,t=>(s(),l("option",{key:t.id,value:t.id},n(t.name),9,ce))),128))],8,ge),[[c,i.value.service_id]])]),a("div",null,[a("label",ve,[e[19]||(e[19]=V(" Gói điều trị ")),E.value?(s(),l("span",be," (Đã chọn dịch vụ đơn lẻ) ")):M("",!0)]),d(a("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.user_service_package_id=t),disabled:E.value,class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"},[e[20]||(e[20]=a("option",{value:""},"Chọn gói điều trị",-1)),(s(!0),l(b,null,v(_.value,t=>{var m;return s(),l("option",{key:t.id,value:t.id,disabled:t.remaining_sessions<i.value.slots},n((m=t.service)==null?void 0:m.name)+" ("+n(t.remaining_sessions)+" buổi) ",9,fe)}),128))],8,ye),[[c,i.value.user_service_package_id]])])]),a("div",null,[e[21]||(e[21]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Ghi chú ",-1)),d(a("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.note=t),rows:"4",class:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400",placeholder:"Thêm ghi chú cho lịch hẹn..."},null,512),[[$,i.value.note]])]),a("div",xe,[a("button",{type:"button",class:"px-6 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200",onClick:e[8]||(e[8]=t=>B(F).visit(`/appointments/${u.appointment.id}`))}," Hủy "),a("button",{type:"submit",class:"px-6 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",disabled:f.value},n(f.value?"Đang cập nhật...":"Cập nhật"),9,he)])],32)]),_:1})]),_:1},8,["breadcrumbs"])]),_:1}))}};export{dt as default};
