import{F as y,Z as x}from"./@inertiajs-D0DMCEQB.js";import{a as _}from"./axios-CCb-kr4I.js";import{_ as f}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,o as k,aU as i,a2 as n,a3 as r,bf as b,b2 as C,aa as w}from"./@vue-BRgAy5zV.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";const P={props:{orderCode:{type:String,required:!0},invoice_id:{type:String,required:!0},status:{type:String,default:""}},setup(t){const e=d(!0),a=d(!1),o=d(null),p=d(null),l=d(null),s=async()=>{try{if(console.log("Props received:",t),!t.orderCode)throw new Error("Không tìm thấy mã đơn hàng");const g=t.invoice_id;if(t.status==="CANCELLED")throw new Error("Giao dịch đã bị hủy");let u=3;for(;u>0;)try{if((await _.post("/api/payos/verify",{orderCode:t.orderCode,invoice_id:g})).data.success){a.value=!0;break}u--}catch(h){if(u===0)throw h;await new Promise(v=>setTimeout(v,2e3))}}catch(g){o.value=g.message||"Có lỗi xảy ra khi xác thực thanh toán",a.value=!1}finally{e.value=!1}},c=()=>{l.value?y.visit(`/orders/${l.value}`):y.visit("/orders")},m=()=>{y.visit("/orders")};return k(()=>{s()}),{loading:e,success:a,error:o,transactionId:p,goToOrder:c,retryPayment:m}}},$={class:"payment-callback"},T={key:0,class:"loading"},E={key:1,class:"max-w-lg mx-auto p-6"},S={key:0,class:"success bg-green-50 dark:bg-green-900/20 p-6 rounded-lg"},I={class:"text-center"},B={class:"text-gray-600 dark:text-gray-400 mb-4"},L={key:1,class:"failed bg-red-50 dark:bg-red-900/20 p-6 rounded-lg"},N={class:"text-center"},O={class:"text-gray-600 dark:text-gray-400 mb-4"};function j(t,e,a,o,p,l){return i(),n("div",$,[o.loading?(i(),n("div",T,e[2]||(e[2]=[r("div",{class:"flex items-center justify-center"},[r("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),r("span",{class:"ml-3"},"Đang xác thực thanh toán...")],-1)]))):(i(),n("div",E,[o.success?(i(),n("div",S,[r("div",I,[e[3]||(e[3]=r("i",{class:"mdi mdi-check-circle text-5xl text-green-500 mb-4"},null,-1)),e[4]||(e[4]=r("h3",{class:"text-xl font-semibold text-green-700 dark:text-green-400 mb-2"}," Thanh toán thành công! ",-1)),r("p",B," Mã giao dịch: "+b(o.transactionId),1),r("button",{onClick:e[0]||(e[0]=(...s)=>o.goToOrder&&o.goToOrder(...s)),class:"btn bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg"}," Xem chi tiết đơn hàng ")])])):(i(),n("div",L,[r("div",N,[e[5]||(e[5]=r("i",{class:"mdi mdi-close-circle text-5xl text-red-500 mb-4"},null,-1)),e[6]||(e[6]=r("h3",{class:"text-xl font-semibold text-red-700 dark:text-red-400 mb-2"}," Thanh toán thất bại ",-1)),r("p",O,b(o.error),1),r("button",{onClick:e[1]||(e[1]=(...s)=>o.retryPayment&&o.retryPayment(...s)),class:"btn bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg"}," Thử lại ")])]))]))])}const q=f(P,[["render",j]]),D={components:{Head:x,PaymentCallback:q},setup(){const t=new URLSearchParams(window.location.search);return{orderCode:t.get("orderCode"),invoice_id:t.get("invoice_id"),status:t.get("status")}}},F={class:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-dark-bg"},M={class:"max-w-md w-full"};function U(t,e,a,o,p,l){var c,m;const s=C("PaymentCallback",!0);return i(),n("div",F,[r("div",M,[w(s,{orderCode:t.$page.props.orderCode||((c=t.$page.url.split("orderCode=")[1])==null?void 0:c.split("&")[0]),invoice_id:t.$page.props.invoice_id,status:(m=t.$page.url.split("status=")[1])==null?void 0:m.split("&")[0]},null,8,["orderCode","invoice_id","status"])])])}const ce=f(D,[["render",U]]);export{ce as default};
