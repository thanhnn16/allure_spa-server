import{r as O,o as z,e as F,aU as c,a2 as m,a3 as n,bf as f,a1 as S,aI as D,c as b,f as G,a0 as Y,bH as C,aa as v,bl as N,a9 as K,bM as P,b0 as V,bJ as T,bA as I,bz as R,F as J}from"./@vue-BRgAy5zV.js";import{_ as H}from"./BaseButton-eMTGofBM.js";import{_ as Q}from"./BaseIcon-B4kwkOCn.js";import{m as W}from"./codemirror-CVTlwwoA.js";import{E as U,j as X,o as Z}from"./@codemirror-CGiQA2_Y.js";import{j as tt}from"./@mdi-DWfqH7fj.js";import{u as et}from"./vue-toastification-ejyjJRED.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as st,G as nt,Y as at}from"./@headlessui-BdO8fvzs.js";import"./@inertiajs-D0DMCEQB.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./colors-S7_1wET5.js";import"./@lezer-Cz8LLRrF.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";const rt={key:0,class:"text-red-500 text-sm mt-2"},it={__name:"JsonEditor",props:{modelValue:{type:[String,Object],required:!0},schema:{type:Object,default:null},height:{type:String,default:"300px"}},emits:["update:modelValue","error"],setup(x,{emit:h}){const d=x,r=h,g=O(""),k=O(null);let s=null;z(()=>{const a=typeof d.modelValue=="string"?d.modelValue:JSON.stringify(d.modelValue,null,2);s=new U({doc:a,extensions:[W,X(),Z,U.updateListener.of(i=>{if(i.docChanged){const _=i.state.doc.toString();E(_)}})],parent:k.value})}),F(()=>d.modelValue,a=>{if(!s)return;const i=typeof a=="string"?a:JSON.stringify(a,null,2);i!==s.state.doc.toString()&&s.dispatch({changes:{from:0,to:s.state.doc.length,insert:i}})});const p=()=>{try{const a=s.state.doc.toString(),i=JSON.parse(a),_=JSON.stringify(i,null,2);s.dispatch({changes:{from:0,to:s.state.doc.length,insert:_}}),g.value=""}catch{g.value="Invalid JSON format"}},y=()=>{try{const a=s.state.doc.toString(),i=JSON.parse(a);return g.value="",r("update:modelValue",i),!0}catch(a){return g.value=a.message,r("error",a.message),!1}},E=a=>{try{const i=typeof a=="object"?JSON.stringify(a,null,2):a;r("update:modelValue",i),r("error",null)}catch(i){r("error",i.message)}};return(a,i)=>(c(),m("div",{class:"json-editor-container",style:D({height:x.height||"300px"})},[n("div",{ref_key:"editorElement",ref:k,class:"h-full"},null,512),g.value?(c(),m("div",rt,f(g.value),1)):S("",!0),n("div",{class:"flex justify-end mt-2 space-x-2"},[n("button",{onClick:p,class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"}," Format "),n("button",{onClick:y,class:"px-3 py-1 text-sm bg-blue-100 hover:bg-blue-200 rounded"}," Validate ")])],4))}};function lt(){return{validateConfig:h=>{const d={};return Object.entries({ai_name:"Tên cấu hình",type:"Loại cấu hình",context:"Nội dung cấu hình",language:"Ngôn ngữ",model_type:"Model AI"}).forEach(([s,p])=>{var y;(y=h[s])!=null&&y.toString().trim()||(d[s]=`${p} là bắt buộc`)}),Object.entries({temperature:{min:0,max:1},top_p:{min:0,max:1},top_k:{min:1,max:100},max_tokens:{min:1,max:8192}}).forEach(([s,p])=>{const y=parseFloat(h[s]);(isNaN(y)||y<p.min||y>p.max)&&(d[s]=`${s} phải từ ${p.min} đến ${p.max}`)}),["function_declarations","safety_settings","tool_config"].forEach(s=>{if(h[s])try{typeof h[s]=="string"&&JSON.parse(h[s])}catch{d[s]=`${s} không đúng định dạng JSON`}}),{isValid:Object.keys(d).length===0,errors:d}}}}const ct={class:"fixed inset-0 flex items-center justify-center p-4"},ut={class:"p-6 border-b border-gray-200 dark:border-gray-700"},mt={class:"flex justify-between items-center"},pt={class:"max-h-[calc(100vh-16rem)] overflow-y-auto p-6"},dt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},yt={class:"space-y-6"},gt=["for"],ht=["id","onUpdate:modelValue"],ft=["id","onUpdate:modelValue"],_t=["value"],bt={key:2,class:"mt-1 text-sm text-gray-500"},vt={class:"space-y-6"},xt=["for"],kt=["id","onUpdate:modelValue","min","max","step"],St={key:1,class:"mt-1 text-sm text-gray-500"},Ot={class:"space-y-6 mt-8"},jt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Nt={class:"p-6 border-t border-gray-200 dark:border-gray-700"},Vt={class:"flex justify-end space-x-3"},Jt={__name:"EditModal",props:{config:{type:Object,default:()=>null},configTypes:{type:Object,required:!0},modelTypes:{type:Object,required:!0},languages:{type:Object,required:!0}},emits:["close","submit"],setup(x,{emit:h}){const d=et(),r=x,g=h,{validateConfig:k}=lt(),s=O(!1),p=O({});JSON.stringify({role:"assistant",description:"Mô tả về vai trò của AI",instructions:"Hãy trả lời một cách chuyên nghiệp và thân thiện",custom_instructions:{system_instructions:"Bạn là một trợ lý AI thông minh...",user_instructions:"Hãy trả lời một cách chuyên nghiệp và thân thiện"}},null,2);const y=b(()=>[{key:"ai_name",label:"Tên Trợ Lý",type:"text",column:"left",required:!0},{key:"type",label:"Loại Cấu Hình",type:"select",column:"left",options:Object.entries(r.configTypes).map(([e,o])=>({value:e,label:o.name}))},{key:"language",label:"Ngôn Ngữ",type:"select",column:"left",options:Object.entries(r.languages).map(([e,o])=>({value:e,label:o}))},{key:"model_type",label:"Model AI",type:"select",column:"left",options:Object.entries(r.modelTypes).map(([e,o])=>({value:e,label:o}))},{key:"temperature",label:"Temperature",type:"number",column:"right",min:0,max:1,step:.1},{key:"max_tokens",label:"Max Tokens",type:"number",column:"right",min:1,max:8192},{key:"top_p",label:"Top P",type:"number",column:"right",min:0,max:1,step:.1},{key:"top_k",label:"Top K",type:"number",column:"right",min:1,max:100},{key:"context",label:"Context",type:"json-editor",height:"200px"},{key:"safety_settings",label:"Safety Settings",type:"json-editor",height:"300px"},{key:"function_declarations",label:"Function Declarations",type:"json-editor",height:"400px"},{key:"tool_config",label:"Tool Configuration",type:"json-editor",height:"300px"}]),E=b(()=>y.value.filter(e=>e.column==="left")),a=b(()=>y.value.filter(e=>e.column==="right")),i=b(()=>y.value.filter(e=>e.type==="json-editor")),_=b(()=>{var e;return!!((e=r.config)!=null&&e.id)}),q=b(()=>_.value?"Chỉnh Sửa Cấu Hình":"Thêm Cấu Hình Mới"),$=()=>({ai_name:"",type:"system_prompt",context:JSON.stringify({role:"assistant",description:"Mô tả về vai trò của AI",instructions:"Hãy trả lời một cách chuyên nghiệp và thân thiện",custom_instructions:{system_instructions:"Bạn là một trợ lý AI thông minh...",user_instructions:"Hãy trả lời một cách chuyên nghiệp và thân thiện"}},null,2),language:"vi",model_type:"gemini-1.5-pro",temperature:.7,max_tokens:2048,top_p:.9,top_k:40,safety_settings:JSON.stringify(r.defaultSafetySettings,null,2),function_declarations:JSON.stringify(r.defaultFunctionDeclarations,null,2),tool_config:JSON.stringify(r.defaultToolConfig,null,2)}),u=G(_.value?M(r.config):$());function M(e){const o={...e};return typeof o.context=="object"&&(o.context=JSON.stringify(o.context,null,2)),["safety_settings","function_declarations","tool_config"].forEach(t=>{o[t]&&(o[t]=typeof o[t]=="string"?o[t]:JSON.stringify(o[t],null,2))}),o}F(()=>r.config,e=>{e!=null&&e.id?Object.assign(u,M(e)):Object.assign(u,$())},{immediate:!0});const A=b(()=>_.value?"Cập Nhật":"Tạo Mới"),j=O({}),B=()=>{const e=["safety_settings","function_declarations","tool_config"];let o=!0;return e.forEach(t=>{try{if(u[t]){let l=u[t];typeof l=="string"&&JSON.parse(l),delete j.value[t]}}catch(l){console.error(`Error validating ${t}:`,l),j.value[t]=`Invalid JSON format in ${t}`,o=!1}}),o},L=()=>{const{isValid:e,errors:o}=k(u),t=B();return!e||!t?(p.value=o,!1):(p.value={},!0)},w=async()=>{try{if(!L())return;const e={...u};typeof e.context=="object"&&(e.context=JSON.stringify(e.context)),["safety_settings","function_declarations","tool_config"].forEach(o=>{if(e[o])try{e[o]=JSON.parse(e[o])}catch{throw new Error(`Invalid JSON in ${o}`)}}),s.value=!0,await g("submit",e),g("close")}catch(e){d.error(e.message||"Có lỗi xảy ra")}finally{s.value=!1}};return F(u,e=>{["safety_settings","function_declarations","tool_config"].forEach(o=>{if(e[o])try{typeof e[o]=="string"&&(JSON.parse(e[o]),delete j.value[o])}catch{j.value[o]=`Invalid JSON format in ${o}`}})},{deep:!0}),(e,o)=>(c(),Y(N(at),{open:!0,onClose:o[2]||(o[2]=t=>e.$emit("close")),class:"relative z-50"},{default:C(()=>[o[3]||(o[3]=n("div",{class:"fixed inset-0 bg-black/30","aria-hidden":"true"},null,-1)),n("div",ct,[v(N(nt),{class:"w-full max-w-3xl rounded bg-white dark:bg-slate-800"},{default:C(()=>[n("div",ut,[n("div",mt,[v(N(st),{class:"text-lg font-medium text-gray-900 dark:text-white"},{default:C(()=>[K(f(q.value),1)]),_:1}),n("button",{onClick:o[0]||(o[0]=t=>e.$emit("close")),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"},[v(Q,{path:N(tt),size:"24"},null,8,["path"])])])]),n("div",pt,[n("form",{onSubmit:P(w,["prevent"]),class:"space-y-6"},[n("div",dt,[n("div",yt,[(c(!0),m(J,null,V(E.value,t=>(c(),m("div",{key:t.key,class:"space-y-2"},[n("label",{for:t.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},f(t.label),9,gt),t.type==="text"?T((c(),m("input",{key:0,id:t.key,"onUpdate:modelValue":l=>u[t.key]=l,type:"text",class:"form-input w-full rounded-md"},null,8,ht)),[[I,u[t.key]]]):t.type==="select"?T((c(),m("select",{key:1,id:t.key,"onUpdate:modelValue":l=>u[t.key]=l,class:"form-select w-full rounded-md"},[(c(!0),m(J,null,V(t.options,l=>(c(),m("option",{key:l.value,value:l.value},f(l.label),9,_t))),128))],8,ft)),[[R,u[t.key]]]):S("",!0),t.description?(c(),m("p",bt,f(t.description),1)):S("",!0)]))),128))]),n("div",vt,[(c(!0),m(J,null,V(a.value,t=>(c(),m("div",{key:t.key,class:"space-y-2"},[n("label",{for:t.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},f(t.label),9,xt),t.type==="number"?T((c(),m("input",{key:0,id:t.key,"onUpdate:modelValue":l=>u[t.key]=l,type:"number",min:t.min,max:t.max,step:t.step,class:"form-input w-full rounded-md"},null,8,kt)),[[I,u[t.key],void 0,{number:!0}]]):S("",!0),t.description?(c(),m("p",St,f(t.description),1)):S("",!0)]))),128))])]),n("div",Ot,[(c(!0),m(J,null,V(i.value,t=>(c(),m("div",{key:t.key,class:"space-y-2"},[n("label",jt,f(t.label),1),n("div",{style:D({"--editor-height":t.height})},[v(it,{modelValue:u[t.key],"onUpdate:modelValue":l=>u[t.key]=l,schema:t.schema||{},error:p.value[t.key],height:t.height||"300px"},null,8,["modelValue","onUpdate:modelValue","schema","error","height"])],4)]))),128))])],32)]),n("div",Nt,[n("div",Vt,[v(H,{type:"button",label:"Hủy",color:"white",onClick:o[1]||(o[1]=t=>e.$emit("close"))}),v(H,{type:"submit",label:A.value,color:"info",loading:s.value,onClick:w},null,8,["label","loading"])])])]),_:1})])]),_:1}))}},ce=ot(Jt,[["__scopeId","data-v-e49e8a77"]]);export{ce as default};
