import{c as h,e as b,r as E,aU as _,a0 as W,bH as f,aa as d,bl as s,a3 as e,a9 as c,bf as v,bJ as u,bA as l,j as O,a2 as k,a1 as w,bz as X,bw as Y,bM as tt}from"./@vue-BRgAy5zV.js";import{T as et,Z as rt}from"./@inertiajs-D0DMCEQB.js";import{L as st}from"./LayoutAuthenticated-DVDdZ8ze.js";import{_ as ot}from"./SectionMain-BbIPmLtw.js";import{_ as at}from"./CardBox-jfYP3QDG.js";import{_ as y}from"./BaseIcon-B4kwkOCn.js";import{_ as Q}from"./BaseButton-eMTGofBM.js";import{aQ as R,aR as it,aS as ut,B as z}from"./@mdi-ybpv6R7X.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./app-B369SSU-.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./vue-toastification-ejyjJRED.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";const lt={class:"mb-6"},nt={class:"text-xl font-semibold text-gray-800 dark:text-white flex items-center"},mt={class:"text-gray-600 dark:text-gray-400 mt-1"},ct={class:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-lg space-y-4"},gt={class:"mt-1 relative"},pt={key:0,class:"mt-1 text-sm text-red-500"},bt={class:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-lg space-y-4"},vt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yt={class:"mt-1 relative"},_t={class:"mt-1 relative"},xt=["max"],ht={class:"absolute right-3 top-2 text-gray-500 dark:text-gray-400"},ft={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},kt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wt={class:"mt-1 relative"},Nt={class:"mt-1 relative"},Vt={class:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-lg space-y-4"},St={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ut={class:"mt-1 relative"},Tt={class:"mt-1 relative"},Ct={key:0,class:"mt-1 text-sm text-red-500"},Dt={class:"space-y-4"},Mt={class:"flex items-center"},jt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qt={key:0},$t={class:"flex justify-end space-x-3 pt-6"},Pt={__name:"Form",props:{voucher:{type:Object,default:()=>({})}},setup(p){var S,U,T,C,D,M,j,q,$,P,B,F,G,I;const o=p,r=et({code:((S=o.voucher)==null?void 0:S.code)||"",description:((U=o.voucher)==null?void 0:U.description)||"",discount_type:((T=o.voucher)==null?void 0:T.discount_type)||"percentage",discount_value:((C=o.voucher)==null?void 0:C.discount_value)||"",min_order_value:((D=o.voucher)==null?void 0:D.min_order_value)||"",max_discount_amount:((M=o.voucher)==null?void 0:M.max_discount_amount)||"",start_date:((j=o.voucher)==null?void 0:j.start_date)||"",end_date:((q=o.voucher)==null?void 0:q.end_date)||"",is_unlimited:(($=o.voucher)==null?void 0:$.is_unlimited)||!1,usage_limit:((P=o.voucher)==null?void 0:P.usage_limit)||1,uses_per_user:((B=o.voucher)==null?void 0:B.uses_per_user)||1,status:((F=o.voucher)==null?void 0:F.status)||"active"}),N=h(()=>{var t,n,g,m;const a=typeof r.status=="object"?r.status.value:r.status;return console.log("canChangeStatus check:",{voucherId:(t=o.voucher)==null?void 0:t.id,currentStatus:(n=o.voucher)==null?void 0:n.status,formStatus:a,result:!((g=o.voucher)!=null&&g.id)||o.voucher.status==="active"}),(m=o.voucher)!=null&&m.id?!(o.voucher.status==="inactive"&&a==="active"):!0});b(()=>r.status,(a,t)=>{var m;const n=typeof a=="object"?a.value:a,g=typeof t=="object"?t.value:t;console.log("Status watch triggered:",{currentStatus:n,previousStatus:g,canChange:N.value,voucherStatus:(m=o.voucher)==null?void 0:m.status}),!N.value&&n==="active"&&(console.log("Preventing status change to active"),r.status="inactive")},{immediate:!0});const x=E(((G=o.voucher)==null?void 0:G.is_unlimited)||!1);b(()=>r.discount_type,a=>{r.discount_value=""}),b(x,a=>{r.is_unlimited=a,a?r.usage_limit=null:r.usage_limit=1});const A=()=>{r.discount_type==="percentage"&&r.discount_value>100&&(r.discount_value=100)},H=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),J=()=>{var t;A(),console.log("Submitting form with data:",{...r,discount_value:Number(r.discount_value),min_order_value:Number(r.min_order_value||0),max_discount_amount:Number(r.max_discount_amount||0),usage_limit:r.is_unlimited?null:Number(r.usage_limit),uses_per_user:Number(r.uses_per_user)});const a={...r,discount_value:Number(r.discount_value),min_order_value:Number(r.min_order_value||0),max_discount_amount:Number(r.max_discount_amount||0),usage_limit:r.is_unlimited?null:Number(r.usage_limit),uses_per_user:Number(r.uses_per_user)};(t=o.voucher)!=null&&t.id?(console.log("Updating voucher:",{id:o.voucher.id,route:route("vouchers.update",o.voucher.id),method:"PUT"}),r.put(route("vouchers.update",o.voucher.id),a)):(console.log("Creating new voucher:",{route:route("vouchers.store"),method:"POST"}),r.post(route("vouchers.store"),a))};b(()=>r.errors,a=>{Object.keys(a).length>0&&console.error("Form validation errors:",a)},{deep:!0}),b(()=>r.processing,a=>{console.log("Form processing state:",a)});const K=[{label:"Trang chủ",route:"dashboard",href:route("dashboard")},{label:"Quản lý Voucher",route:"vouchers.index",href:route("vouchers.index")},{label:(I=o.voucher)!=null&&I.id?"Sửa Voucher":"Thêm Voucher"}],Z=h(()=>r.discount_value?r.discount_type==="percentage"?`${r.discount_value}%`:H(r.discount_value):""),V=h(()=>!r.start_date||!r.end_date?!0:new Date(r.start_date)<=new Date(r.end_date));return(a,t)=>(_(),W(st,null,{default:f(()=>{var n;return[d(s(rt),{title:(n=p.voucher)!=null&&n.id?"Sửa Voucher":"Thêm Voucher"},null,8,["title"]),d(ot,{breadcrumbs:K},{default:f(()=>[d(at,{class:"max-w-4xl mx-auto"},{default:f(()=>{var g,m,L;return[e("div",lt,[e("h2",nt,[d(y,{path:s(R),class:"w-6 h-6 mr-2"},null,8,["path"]),c(" "+v((g=p.voucher)!=null&&g.id?"Sửa Voucher":"Thêm Voucher Mới"),1)]),e("p",mt," Điền thông tin chi tiết để "+v((m=p.voucher)!=null&&m.id?"cập nhật":"tạo")+" voucher ",1)]),e("form",{onSubmit:tt(J,["prevent"]),class:"space-y-6"},[e("div",ct,[t[14]||(t[14]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Thông tin cơ bản",-1)),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Mã voucher "),e("span",{class:"text-red-500"},"*")],-1)),e("div",gt,[u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>s(r).code=i),type:"text",required:"",class:O(["w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10",{"border-red-500":s(r).errors.code}])},null,2),[[l,s(r).code]]),d(y,{path:s(R),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])]),s(r).errors.code?(_(),k("p",pt,v(s(r).errors.code),1)):w("",!0)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Mô tả ",-1)),u(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=i=>s(r).description=i),rows:"2",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500",placeholder:"Nhập mô tả về voucher (không bắt buộc)"},"                            ",512),[[l,s(r).description]])])]),e("div",bt,[t[22]||(t[22]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Giá trị giảm giá",-1)),e("div",vt,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Loại giảm giá "),e("span",{class:"text-red-500"},"*")],-1)),e("div",yt,[u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=i=>s(r).discount_type=i),required:"",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},t[15]||(t[15]=[e("option",{value:"percentage"},"Phần trăm",-1),e("option",{value:"fixed"},"Số tiền cố định",-1)]),512),[[X,s(r).discount_type]]),d(y,{path:s(r).discount_type==="percentage"?s(it):s(ut),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Giá trị giảm "),e("span",{class:"text-red-500"},"*")],-1)),e("div",_t,[u(e("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>s(r).discount_value=i),type:"number",required:"",min:"0",max:s(r).discount_type==="percentage"?100:null,class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,8,xt),[[l,s(r).discount_value,void 0,{number:!0}]]),e("span",ht,v(s(r).discount_type==="percentage"?"%":"đ"),1)]),e("p",ft," Giảm: "+v(Z.value),1)])]),e("div",kt,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Giá trị đơn hàng tối thiểu ",-1)),e("div",wt,[u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>s(r).min_order_value=i),type:"number",min:"0",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,512),[[l,s(r).min_order_value,void 0,{number:!0}]]),t[18]||(t[18]=e("span",{class:"absolute right-3 top-2 text-gray-500 dark:text-gray-400"},"đ",-1))])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Giảm giá tối đa ",-1)),e("div",Nt,[u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>s(r).max_discount_amount=i),type:"number",min:"0",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,512),[[l,s(r).max_discount_amount,void 0,{number:!0}]]),t[20]||(t[20]=e("span",{class:"absolute right-3 top-2 text-gray-500 dark:text-gray-400"},"đ",-1))])])])]),e("div",Vt,[t[28]||(t[28]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Thời gian và giới hạn sử dụng",-1)),e("div",St,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Ngày bắt đầu "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Ut,[u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>s(r).start_date=i),type:"date",required:"",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10"},null,512),[[l,s(r).start_date]]),d(y,{path:s(z),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Ngày kết thúc "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Tt,[u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>s(r).end_date=i),type:"date",required:"",class:O(["w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500 pr-10",{"border-red-500":!V.value}])},null,2),[[l,s(r).end_date]]),d(y,{path:s(z),class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"},null,8,["path"])]),V.value?w("",!0):(_(),k("p",Ct," Ngày kết thúc phải sau ngày bắt đầu "))])]),e("div",Dt,[e("div",Mt,[u(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=i=>x.value=i),id:"is_unlimited",class:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"},null,512),[[Y,x.value]]),t[25]||(t[25]=e("label",{for:"is_unlimited",class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Không giới hạn số lần sử dụng ",-1))]),e("div",jt,[s(r).is_unlimited?w("",!0):(_(),k("div",qt,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Tổng số lần sử dụng "),e("span",{class:"text-red-500"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[9]||(t[9]=i=>s(r).usage_limit=i),type:"number",required:"",min:"1",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500"},null,512),[[l,s(r).usage_limit,void 0,{number:!0}]])])),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Số lần sử dụng cho mỗi người dùng "),e("span",{class:"text-red-500"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[10]||(t[10]=i=>s(r).uses_per_user=i),type:"number",required:"",min:"1",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-slate-800 dark:text-white focus:border-blue-500 focus:ring-blue-500"},null,512),[[l,s(r).uses_per_user,void 0,{number:!0}]])])])])]),e("div",$t,[d(Q,{type:"button",label:"Quay lại",color:"white",onClick:t[11]||(t[11]=i=>a.$inertia.visit(a.route("vouchers.index")))}),d(Q,{type:"submit",label:(L=p.voucher)!=null&&L.id?"Cập nhật":"Tạo mới",color:"info",loading:s(r).processing},null,8,["label","loading"])])],32)]}),_:1})]),_:1})]}),_:1}))}},Ve=dt(Pt,[["__scopeId","data-v-8fcc0ade"]]);export{Ve as default};
