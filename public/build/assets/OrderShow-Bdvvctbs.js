import{Z as xe,i as ke,F as M}from"./@inertiajs-D0DMCEQB.js";import{L as Ce}from"./LayoutAuthenticated-teYRwYCx.js";import{_ as _e}from"./SectionMain-BbIPmLtw.js";import{_ as we}from"./CardBox-jfYP3QDG.js";import{c as T,aU as g,a2 as y,a3 as e,j as B,a9 as C,bf as m,r as x,e as H,a0 as N,bH as w,bJ as O,F as G,b0 as K,bz as Se,bA as D,a1 as _,b2 as V,aa as S}from"./@vue-BRgAy5zV.js";import{C as E}from"./CardBoxModal-COZ15ICG.js";import{a as j}from"./axios-CCb-kr4I.js";import{u as Ve}from"./vue-toastification-ejyjJRED.js";import{_ as Te}from"./BaseIcon-B4kwkOCn.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./@mdi-CTfBXXzV.js";import"./app-BDfLYfvA.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./BaseButton-eMTGofBM.js";import"./BaseButtons-B17KSMwc.js";const Ie={__name:"StatusBadge",props:{status:{type:String,required:!0,validator:n=>["pending","confirmed","shipping","completed","cancelled"].includes(n)},size:{type:String,default:"md",validator:n=>["sm","md","lg"].includes(n)}},setup(n){const t=n,a=T(()=>`inline-flex items-center font-medium rounded-full ${{sm:"px-2 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"}[t.size]}`),s={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",confirmed:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",shipping:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},p={pending:"bg-yellow-400",confirmed:"bg-blue-400",shipping:"bg-purple-400",completed:"bg-green-400",cancelled:"bg-red-400"},f={pending:"Chờ xác nhận",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"};return(b,v)=>(g(),y("span",{class:B([a.value,s[n.status]])},[e("span",{class:B(["w-2 h-2 rounded-full mr-2",p[n.status]])},null,2),C(" "+m(f[n.status]),1)],2))}},Be={__name:"PaymentStatusBadge",props:{status:{type:String,required:!0,validator:n=>["pending","partial","paid","cancelled"].includes(n)},size:{type:String,default:"md",validator:n=>["sm","md","lg"].includes(n)}},setup(n){const t=n,a=T(()=>`inline-flex items-center font-medium rounded-full ${{sm:"px-2 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"}[t.size]}`),s={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",partial:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",paid:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},p={pending:"bg-yellow-400",partial:"bg-blue-400",paid:"bg-green-400",cancelled:"bg-red-400"},f={pending:"Chờ thanh toán",partial:"Thanh toán một phần",paid:"Đã thanh toán",cancelled:"Đã hủy"};return(b,v)=>(g(),y("span",{class:B([a.value,s[n.status]])},[e("span",{class:B(["w-2 h-2 rounded-full mr-2",p[n.status]])},null,2),C(" "+m(f[n.status]),1)],2))}},je="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full",Ue={__name:"ItemTypeBadge",props:{type:{type:String,required:!0,validator:n=>["product","service"].includes(n)}},setup(n){const t={product:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",service:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300"},a={product:"mdi-package-variant",service:"mdi-spa"},s={product:"Sản phẩm",service:"Dịch vụ"};return(p,f)=>(g(),y("span",{class:B([je,t[n.type]])},[e("i",{class:B(["mdi mr-1",a[n.type]])},null,2),C(" "+m(s[n.type]),1)],2))}},Ne={class:"space-y-4"},Oe=["value"],He={class:"flex justify-end space-x-3 pt-4"},De=["disabled"],Ee={key:0,class:"mdi mdi-loading mdi-spin mr-2"},$e={__name:"UpdateStatusModal",props:{modelValue:Boolean,order:Object,availableStatuses:Array},emits:["update:modelValue","updated"],setup(n,{emit:t}){const a=n,s=t,p=x(a.order.status),f=x(""),b=x(!1);H(()=>a.modelValue,u=>{u||(p.value=a.order.status,f.value="",b.value=!1)});const v=u=>({pending:"Chờ xác nhận",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[u],d=async()=>{if(!b.value){b.value=!0;try{s("updated",{status:p.value,note:f.value})}catch(u){console.error("Error in handleSubmit:",u)}}};return(u,h)=>(g(),N(E,{"model-value":n.modelValue,"onUpdate:modelValue":h[3]||(h[3]=r=>u.$emit("update:modelValue",r)),title:"Cập nhật trạng thái đơn hàng","has-button":!1},{default:w(()=>[e("div",Ne,[e("div",null,[h[4]||(h[4]=e("label",{class:"block text-sm font-medium mb-2"},"Trạng thái mới",-1)),O(e("select",{"onUpdate:modelValue":h[0]||(h[0]=r=>p.value=r),class:"form-select w-full rounded-lg border-gray-300 dark:border-dark-border dark:bg-dark-surface"},[(g(!0),y(G,null,K(n.availableStatuses,r=>(g(),y("option",{key:r,value:r},m(v(r)),9,Oe))),128))],512),[[Se,p.value]])]),e("div",null,[h[5]||(h[5]=e("label",{class:"block text-sm font-medium mb-2"},"Ghi chú (tùy chọn)",-1)),O(e("textarea",{"onUpdate:modelValue":h[1]||(h[1]=r=>f.value=r),rows:"3",class:"form-textarea w-full rounded-lg border-gray-300 dark:border-dark-border dark:bg-dark-surface",placeholder:"Nhập ghi chú cho việc cập nhật trạng thái"},null,512),[[D,f.value]])]),e("div",He,[e("button",{onClick:h[2]||(h[2]=r=>u.$emit("update:modelValue",!1)),class:"px-4 py-2 rounded-lg border border-gray-300 dark:border-dark-border hover:bg-gray-50 dark:hover:bg-dark-bg/50 transition-colors duration-200"}," Hủy "),e("button",{onClick:d,disabled:b.value,class:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[b.value?(g(),y("i",Ee)):_("",!0),h[6]||(h[6]=C(" Cập nhật "))],8,De)])])]),_:1},8,["model-value"]))}},Le={class:"p-6"},Pe={class:"text-lg font-medium mb-4"},Ae={class:"space-y-4"},ze={class:"bg-gray-50 dark:bg-dark-bg/50 p-4 rounded-lg"},Fe={class:"flex justify-between mb-2"},qe={class:"font-medium"},Ge={class:"flex justify-between"},Ke={class:"text-green-600"},Xe={class:"flex justify-between pt-2 border-t mt-2"},Je={class:"font-medium"},Qe={class:"mt-6 flex justify-end space-x-3"},Ze=["disabled"],Re={key:0,class:"mdi mdi-loading mdi-spin mr-2"},We={__name:"CreateInvoiceModal",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","created"],setup(n,{emit:t}){const a=t,s=x(""),p=x(!1),f=v=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(v),b=async()=>{p.value=!0;try{await a("created",{note:s.value}),s.value=""}catch(v){console.error("Error creating invoice:",v)}finally{p.value=!1}};return(v,d)=>(g(),N(E,{"model-value":n.modelValue,"onUpdate:modelValue":d[2]||(d[2]=u=>v.$emit("update:modelValue",u)),title:"Tạo hóa đơn cho đơn hàng #{{ order.id }}","has-button":!1},{default:w(()=>[e("div",Le,[e("h3",Pe," Tạo hóa đơn cho đơn hàng #"+m(n.order.id),1),e("div",Ae,[e("div",ze,[e("div",Fe,[d[3]||(d[3]=e("span",{class:"text-gray-500"},"Tổng tiền:",-1)),e("span",qe,m(f(n.order.total_amount)),1)]),e("div",Ge,[d[4]||(d[4]=e("span",{class:"text-gray-500"},"Giảm giá:",-1)),e("span",Ke,"-"+m(f(n.order.discount_amount)),1)]),e("div",Xe,[d[5]||(d[5]=e("span",{class:"font-medium"},"Thành tiền:",-1)),e("span",Je,m(f(n.order.total_amount-n.order.discount_amount)),1)])]),e("div",null,[d[6]||(d[6]=e("label",{class:"block text-sm font-medium mb-2"},"Ghi chú (tùy chọn)",-1)),O(e("textarea",{"onUpdate:modelValue":d[0]||(d[0]=u=>s.value=u),rows:"3",class:"form-textarea w-full",placeholder:"Nhập ghi chú cho hóa đơn"},null,512),[[D,s.value]])])]),e("div",Qe,[e("button",{onClick:d[1]||(d[1]=u=>v.$emit("update:modelValue",!1)),class:"btn-secondary"}," Hủy "),e("button",{onClick:b,disabled:p.value,class:"btn-primary"},[p.value?(g(),y("i",Re)):_("",!0),d[7]||(d[7]=C(" Tạo hóa đơn "))],8,Ze)])])]),_:1},8,["model-value"]))}},Ye={class:"p-6"},et={class:"text-lg font-medium mb-4"},tt={class:"space-y-4"},nt={key:0,class:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg"},st={class:"bg-gray-50 dark:bg-dark-bg/50 p-4 rounded-lg space-y-2"},ot={class:"flex items-center"},at={class:"mt-6 flex justify-end space-x-3"},rt=["disabled"],lt={key:0,class:"mdi mdi-loading mdi-spin mr-2"},dt={__name:"CompleteOrderModal",props:{modelValue:Boolean,order:Object,hasServiceCombo:Boolean},emits:["update:modelValue","completed"],setup(n,{emit:t}){const a=n,s=t,p=x(""),f=x(!1),b=T(()=>{var d;return((d=a.order.invoice)==null?void 0:d.status)==="paid"}),v=async()=>{if(b.value){f.value=!0;try{(await j.post(`/api/orders/${a.order.id}/complete`,{note:p.value})).data.success&&(s("completed"),s("update:modelValue",!1),p.value="")}catch(d){console.error("Error completing order:",d)}finally{f.value=!1}}};return(d,u)=>(g(),N(E,{"model-value":n.modelValue,"onUpdate:modelValue":u[2]||(u[2]=h=>d.$emit("update:modelValue",h)),title:"Hoàn thành đơn hàng #{{ order.id }}","has-button":!1},{default:w(()=>{var h;return[e("div",Ye,[e("h3",et," Hoàn thành đơn hàng #"+m(n.order.id),1),e("div",tt,[n.hasServiceCombo?(g(),y("div",nt,u[3]||(u[3]=[e("div",{class:"flex"},[e("i",{class:"mdi mdi-information text-blue-400 text-xl mr-3"}),e("div",null,[e("h4",{class:"font-medium text-blue-800 dark:text-blue-300"}," Thông tin quan trọng "),e("p",{class:"text-sm text-blue-700 dark:text-blue-400"}," Đơn hàng này có gói dịch vụ combo. Khi hoàn thành, hệ thống sẽ tự động tạo gói liệu trình cho khách hàng. ")])],-1)]))):_("",!0),e("div",st,[u[5]||(u[5]=e("div",{class:"flex items-center"},[e("i",{class:"mdi mdi-check-circle text-green-500 mr-2"}),e("span",null,"Đơn hàng đã được xác nhận")],-1)),e("div",ot,[e("i",{class:B(["mdi mr-2",((h=n.order.invoice)==null?void 0:h.status)==="paid"?"mdi-check-circle text-green-500":"mdi-alert-circle text-red-500"])},null,2),u[4]||(u[4]=e("span",null,"Hóa đơn đã thanh toán đầy đủ",-1))])]),e("div",null,[u[6]||(u[6]=e("label",{class:"block text-sm font-medium mb-2"},"Ghi chú hoàn thành (tùy chọn)",-1)),O(e("textarea",{"onUpdate:modelValue":u[0]||(u[0]=r=>p.value=r),rows:"3",class:"form-textarea w-full",placeholder:"Nhập ghi chú khi hoàn thành đơn hàng"},null,512),[[D,p.value]])])]),e("div",at,[e("button",{onClick:u[1]||(u[1]=r=>d.$emit("update:modelValue",!1)),class:"btn-secondary"}," Hủy "),e("button",{onClick:v,disabled:f.value||!b.value,class:"btn-success"},[f.value?(g(),y("i",lt)):_("",!0),u[7]||(u[7]=C(" Hoàn thành đơn hàng "))],8,rt)])])]}),_:1},8,["model-value"]))}},it={class:"p-6"},ct={class:"text-lg font-medium mb-4"},ut={class:"space-y-4"},mt={class:"bg-gray-50 dark:bg-dark-bg/50 p-4 rounded-lg"},gt={class:"flex justify-between mb-2"},ht={class:"font-medium"},pt={key:0,class:"flex justify-between text-red-600"},ft={key:0,class:"mt-1 text-sm text-red-500"},yt={class:"mt-6 flex justify-end space-x-3"},bt=["disabled"],vt={key:0,class:"mdi mdi-loading mdi-spin mr-2"},xt={__name:"CancelOrderModal",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","cancelled"],setup(n,{emit:t}){const a=n,s=t,p=x(""),f=x(!1),b=x(!1),v=T(()=>["pending","confirmed"].includes(a.order.status)&&(!a.order.invoice||a.order.invoice.status!=="paid")),d=h=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(h),u=async()=>{if(v.value){if(!p.value.trim()){b.value=!0;return}f.value=!0;try{s("cancelled",{reason:p.value})}finally{f.value=!1}}};return H(p,()=>{p.value.trim()&&(b.value=!1)}),(h,r)=>(g(),N(E,{"model-value":n.modelValue,"onUpdate:modelValue":r[2]||(r[2]=k=>h.$emit("update:modelValue",k)),title:"Hủy đơn hàng #{{ order.id }}","has-button":!1},{default:w(()=>[e("div",it,[e("h3",ct," Hủy đơn hàng #"+m(n.order.id),1),e("div",ut,[r[6]||(r[6]=e("div",{class:"bg-red-50 dark:bg-red-900/30 p-4 rounded-lg"},[e("div",{class:"flex"},[e("i",{class:"mdi mdi-alert text-red-400 text-xl mr-3"}),e("div",null,[e("h4",{class:"font-medium text-red-800 dark:text-red-300"}," Cảnh báo "),e("p",{class:"text-sm text-red-700 dark:text-red-400"}," Bạn chắc chắn muốn hủy đơn hàng này? Hành động này không thể hoàn tác. ")])])],-1)),e("div",mt,[e("div",gt,[r[3]||(r[3]=e("span",{class:"text-gray-500"},"Tổng tiền:",-1)),e("span",ht,m(d(n.order.total_amount)),1)]),n.order.invoice?(g(),y("div",pt,[r[4]||(r[4]=e("span",null,"Đã thanh toán:",-1)),e("span",null,m(d(n.order.invoice.paid_amount)),1)])):_("",!0)]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-sm font-medium mb-2"},[C(" Lý do hủy đơn "),e("span",{class:"text-red-500"},"*")],-1)),O(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=k=>p.value=k),rows:"3",class:B(["form-textarea w-full",{"border-red-500":b.value}]),placeholder:"Vui lòng nhập lý do hủy đơn hàng"},null,2),[[D,p.value]]),b.value?(g(),y("p",ft," Vui lòng nhập lý do hủy đơn hàng ")):_("",!0)])]),e("div",yt,[e("button",{onClick:r[1]||(r[1]=k=>h.$emit("update:modelValue",!1)),class:"btn-secondary"}," Đóng "),e("button",{onClick:u,disabled:f.value||!v.value,class:"btn-danger"},[f.value?(g(),y("i",vt)):_("",!0),r[7]||(r[7]=C(" Xác nhận hủy "))],8,bt)])])]),_:1},8,["model-value"]))}},kt={name:"OrderShow",components:{Head:xe,Link:ke,LayoutAuthenticated:Ce,SectionMain:_e,CardBox:we,StatusBadge:Ie,PaymentStatusBadge:Be,ItemTypeBadge:Ue,UpdateStatusModal:$e,CreateInvoiceModal:We,CompleteOrderModal:dt,CancelOrderModal:xt,BaseIcon:Te},props:{order:Object},setup(n){console.log("Order data:",n.order),console.log("Invoice data:",n.order.invoice);const t=x(!1),a=x(!1),s=x(!1),p=x(!1),f=x(!1),b=x(n.order.status),v=x(""),d=x(""),u=x(""),h=x(""),r=Ve(),k=x(!1),$=o=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(o),L=o=>new Date(o).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=o=>{const l="px-2 inline-flex text-xs leading-5 font-semibold rounded-full items-center transition-colors duration-150";return{pending:`${l} bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300`,confirmed:`${l} bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300`,shipping:`${l} bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300`,completed:`${l} bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300`,cancelled:`${l} bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300`}[o]||`${l} bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300`},A=o=>({pending:"bg-yellow-400",confirmed:"bg-blue-400",shipping:"bg-purple-400",completed:"bg-green-400",cancelled:"bg-red-400"})[o]||"bg-gray-400",z=o=>{const l="text-sm font-medium";return{pending:`${l} text-yellow-600 dark:text-yellow-400`,partial:`${l} text-blue-600 dark:text-blue-400`,paid:`${l} text-green-600 dark:text-green-400`,cancelled:`${l} text-red-600 dark:text-red-400`}[o]||`${l} text-gray-600 dark:text-gray-400`},c=o=>({pending:"Chờ thanh toán",partial:"Thanh toán một phần",paid:"Đã thanh toán",cancelled:"Đã hủy"})[o]||"Không xác định",F=o=>{const l="px-2 inline-flex text-xs leading-5 font-semibold rounded-full";return o==="product"?`${l} bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-400`:`${l} bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-400`},J=T(()=>["pending","confirmed"].includes(n.order.status)),Q=T(()=>n.order.invoice&&!["paid","cancelled"].includes(n.order.invoice.status)&&n.order.status!=="cancelled"),Z=T(()=>!n.order.invoice&&n.order.status!=="cancelled"&&n.order.status!=="completed"),R=T(()=>{var o;return["confirmed","shipping"].includes(n.order.status)&&((o=n.order.invoice)==null?void 0:o.status)==="paid"}),q=T(()=>n.order.order_items.some(o=>o.item_type==="service"&&["combo_5","combo_10"].includes(o.service_type))),W=async()=>{var o,l;k.value=!0;try{(await j.put(route("orders.update",n.order.id),{status:b.value,note:v.value})).data.success&&(r.success("Cập nhật trạng thái thành công"),M.reload())}catch(i){console.error("Error updating order status:",i),r.error(((l=(o=i.response)==null?void 0:o.data)==null?void 0:l.message)||"Có lỗi xảy ra khi cập nhật trạng thái")}finally{k.value=!1,t.value=!1}},Y=async o=>{try{await j.post(`/api/invoices/${n.order.invoice.id}/payments`,o),a.value=!1}catch(l){console.error("Error processing payment:",l)}},ee=async()=>{var o,l;k.value=!0;try{const i=await j.post(`/api/orders/${n.order.id}/create-invoice`,{note:d.value});if(i.data.success)r.success("Hóa đơn đã được tạo thành công"),M.visit(route("invoices.show",i.data.data.id));else throw new Error(i.data.message)}catch(i){console.error("Error creating invoice:",i),r.error(((l=(o=i.response)==null?void 0:o.data)==null?void 0:l.message)||"Có lỗi xảy ra khi tạo hóa đơn")}finally{k.value=!1,s.value=!1,d.value=""}},X=o=>({pending:"Chờ xác nhận",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[o]||"Không xác định",te=()=>{n.order.invoice&&M.visit(route("invoices.show",n.order.invoice.id))},ne=()=>{n.order.invoice&&M.visit(route("invoices.show",n.order.invoice.id))},se=()=>{s.value=!0},oe=o=>({single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"})[o]||o,ae=()=>{b.value=n.order.status,v.value=n.order.note||"",t.value=!0},re=()=>{p.value=!0,u.value=""},le=()=>{f.value=!0,h.value=""},de=async()=>{var o,l;k.value=!0;try{(await j.post(`/api/orders/${n.order.id}/complete`,{note:u.value})).data.success&&(r.success("Đơn hàng đã được hoàn thành thành công"),q.value&&r.info("Các gói liệu trình đã được tạo cho khách hàng"),M.reload())}catch(i){console.error("Error completing order:",i),r.error(((l=(o=i.response)==null?void 0:o.data)==null?void 0:l.message)||"Có lỗi xảy ra khi hoàn thành đơn hàng")}finally{k.value=!1,p.value=!1}},ie=async()=>{var o,l;k.value=!0;try{(await j.post(`/api/orders/${n.order.id}/cancel`,{note:h.value})).data.success&&(r.success("Đơn hàng đã được hủy thành công"),M.reload())}catch(i){console.error("Error canceling order:",i),r.error(((l=(o=i.response)==null?void 0:o.data)==null?void 0:l.message)||"Có lỗi xảy ra khi hủy đơn hàng")}finally{k.value=!1,f.value=!1}},ce=T(()=>({pending:["confirmed","cancelled"],confirmed:["shipping","completed","cancelled"],shipping:["completed","cancelled"],completed:[],cancelled:[]})[n.order.status]||[]),ue=T(()=>{var l;const o=[];return o.push({id:"created",content:"Đơn hàng được tạo",datetime:n.order.created_at,iconClass:"mdi mdi-plus-circle",iconBackground:"bg-blue-500"}),(l=n.order.status_histories)!=null&&l.length&&n.order.status_histories.forEach(i=>{o.push({id:i.id,content:`Trạng thái đơn hàng thay đổi thành "${X(i.status)}"${i.note?` - ${i.note}`:""}`,datetime:i.created_at,iconClass:"mdi mdi-clipboard-check",iconBackground:"bg-green-500"})}),n.order.status==="completed"?o.push({id:"completed",content:"Đơn hàng hoàn thành",datetime:n.order.completed_at||n.order.updated_at,iconClass:"mdi mdi-check-circle",iconBackground:"bg-green-600"}):n.order.status==="cancelled"&&o.push({id:"cancelled",content:"Đơn hàng đã hủy",datetime:n.order.cancelled_at||n.order.updated_at,iconClass:"mdi mdi-close-circle",iconBackground:"bg-red-600"}),o.sort((i,I)=>new Date(I.datetime)-new Date(i.datetime))}),me=o=>new Date(o).toLocaleString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),ge=async o=>{var l,i;k.value=!0;try{const I=await j.put(route("orders.update",n.order.id),{status:o.status,note:o.note});if(I.data.success)r.success("Cập nhật trạng thái thành công"),M.reload();else throw new Error(I.data.message||"Có lỗi xảy ra")}catch(I){console.error("Error updating order status:",I),r.error(((i=(l=I.response)==null?void 0:l.data)==null?void 0:i.message)||"Có lỗi xảy ra khi cập nhật trạng thái")}finally{k.value=!1,t.value=!1}},he=async o=>{var l,i,I;k.value=!0;try{const U=await j.post(`/api/orders/${n.order.id}/create-invoice`,{note:o.note});if(U.data.success)r.success("Tạo hóa đơn thành công"),(l=U.data.data)!=null&&l.id?M.visit(route("invoices.show",U.data.data.id)):M.reload();else throw new Error(U.data.message||"Có lỗi xảy ra")}catch(U){console.error("Error creating invoice:",U),r.error(((I=(i=U.response)==null?void 0:i.data)==null?void 0:I.message)||"Có lỗi xảy ra khi tạo hóa đơn")}finally{k.value=!1,s.value=!1}},pe=()=>{r.success("Đơn hàng đã được hoàn thành thành công"),q.value&&r.info("Các gói liệu trình đã được tạo cho khách hàng"),M.reload()},fe=()=>{M.reload()},ye=o=>{var l,i;return((l=o.product)==null?void 0:l.name)||((i=o.service)==null?void 0:i.service_name)||"N/A"},be=o=>{var l,i;return((l=o.product)==null?void 0:l.image)||((i=o.service)==null?void 0:i.image)||null},ve=T(()=>["pending","confirmed"].includes(n.order.status)&&(!n.order.invoice||n.order.invoice.status==="pending"));return H(()=>t.value,o=>{o||(v.value="",b.value=n.order.status)}),H(()=>f.value,o=>{o||(h.value="")}),{showStatusModal:t,showPaymentModal:a,showCreateInvoiceModal:s,showCompleteModal:p,showCancelModal:f,newStatus:b,statusNote:v,invoiceNote:d,completeNote:u,cancelNote:h,formatCurrency:$,formatDate:L,getStatusClass:P,getStatusDotClass:A,getPaymentStatusClass:z,getPaymentStatusText:c,getItemTypeClass:F,canUpdateStatus:J,canProcessPayment:Q,canCreateInvoice:Z,canComplete:R,hasServiceCombo:q,updateOrderStatus:W,processPayment:Y,createInvoice:ee,getStatusText:X,goToInvoice:te,openPaymentModal:ne,openCreateInvoiceModal:se,getServiceTypeText:oe,loading:k,openUpdateStatusModal:ae,getAvailableStatuses:ce,openCompleteModal:re,openCancelModal:le,completeOrder:de,cancelOrder:ie,orderTimeline:ue,formatDateTime:me,handleStatusUpdated:ge,handleInvoiceCreated:he,handleOrderCompleted:pe,handleOrderCancelled:fe,getItemName:ye,getItemImage:be,canCancel:ve,formatAddress:o=>o?`${o.ward}, ${o.district}, ${o.province}`:""}}},Ct={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},_t={class:"lg:col-span-2 space-y-6"},wt={class:"flex justify-between items-center"},St={class:"text-lg font-medium"},Vt={class:"grid grid-cols-2 gap-4"},Tt={class:"space-y-2"},Mt={class:"space-y-2"},It={key:0},Bt={class:"mt-4 pt-4 border-t dark:border-dark-border"},jt={key:0,class:"bg-gray-50 dark:bg-dark-bg/50 p-3 rounded-lg"},Ut={class:"font-medium"},Nt={class:"text-gray-600 dark:text-gray-400"},Ot={key:1,class:"text-gray-500 text-sm"},Ht={class:"overflow-x-auto"},Dt={class:"min-w-full divide-y dark:divide-dark-border"},Et={class:"divide-y dark:divide-dark-border"},$t={class:"px-4 py-4"},Lt={class:"flex items-center"},Pt=["src"],At={class:"font-medium"},zt={class:"text-sm text-gray-500"},Ft={key:0,class:"ml-2"},qt={class:"px-4 py-4"},Gt={class:"px-4 py-4"},Kt={class:"px-4 py-4 font-medium"},Xt={class:"bg-gray-50 dark:bg-dark-bg/50"},Jt={class:"px-4 py-3 font-medium"},Qt={key:0},Zt={class:"px-4 py-3 font-medium text-green-600"},Rt={class:"border-t dark:border-dark-border"},Wt={class:"px-4 py-3 font-medium text-lg"},Yt={class:"flow-root"},en={role:"list",class:"-mb-8"},tn={class:"relative pb-8"},nn={key:0,class:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-dark-border","aria-hidden":"true"},sn={class:"relative flex space-x-3"},on={class:"flex min-w-0 flex-1 justify-between space-x-4 pt-1.5"},an={class:"text-sm text-gray-500"},rn={class:"whitespace-nowrap text-right text-sm text-gray-500"},ln=["datetime"],dn={class:"lg:col-span-1 space-y-6"},cn={class:"space-y-4"},un={class:"flex justify-between items-center"},mn={class:"space-y-3 pt-3 border-t dark:border-dark-border"},gn={key:0,class:"space-y-4"},hn={class:"flex justify-between items-center"},pn={class:"space-y-2"},fn={class:"flex justify-between"},yn={class:"font-medium"},bn={class:"flex justify-between"},vn={class:"text-green-600 font-medium"},xn={class:"flex justify-between"},kn={class:"text-red-600 font-medium"},Cn={key:1,class:"text-center py-6"};function _n(n,t,a,s,p,f){const b=V("Head"),v=V("StatusBadge"),d=V("CardBox"),u=V("ItemTypeBadge"),h=V("PaymentStatusBadge"),r=V("Link"),k=V("UpdateStatusModal"),$=V("CreateInvoiceModal"),L=V("CompleteOrderModal"),P=V("CancelOrderModal"),A=V("SectionMain"),z=V("LayoutAuthenticated");return g(),N(z,null,{default:w(()=>[S(b,{title:`Chi tiết đơn hàng #${a.order.id}`},null,8,["title"]),S(A,{breadcrumbs:[{label:"Quản lý đơn hàng",href:n.route("orders.index")},{label:`Đơn hàng #${a.order.id}`}]},{default:w(()=>[e("div",Ct,[e("div",_t,[S(d,null,{header:w(()=>[e("div",wt,[e("h3",St,"Thông tin đơn hàng #"+m(a.order.id),1),S(v,{status:a.order.status},null,8,["status"])])]),default:w(()=>{var c;return[e("div",Vt,[e("div",null,[t[11]||(t[11]=e("h4",{class:"font-medium mb-2"},"Thông tin khách hàng",-1)),e("div",Tt,[e("p",null,[t[8]||(t[8]=e("span",{class:"text-gray-500"},"Họ tên:",-1)),C(" "+m(a.order.user.full_name),1)]),e("p",null,[t[9]||(t[9]=e("span",{class:"text-gray-500"},"Email:",-1)),C(" "+m(a.order.user.email),1)]),e("p",null,[t[10]||(t[10]=e("span",{class:"text-gray-500"},"Điện thoại:",-1)),C(" "+m(a.order.user.phone_number),1)])])]),e("div",null,[t[15]||(t[15]=e("h4",{class:"font-medium mb-2"},"Thông tin đặt hàng",-1)),e("div",Mt,[e("p",null,[t[12]||(t[12]=e("span",{class:"text-gray-500"},"Ngày đặt:",-1)),C(" "+m(s.formatDateTime(a.order.created_at)),1)]),e("p",null,[t[13]||(t[13]=e("span",{class:"text-gray-500"},"Phương thức:",-1)),C(" "+m((c=a.order.payment_method)==null?void 0:c.method_name),1)]),a.order.voucher?(g(),y("p",It,[t[14]||(t[14]=e("span",{class:"text-gray-500"},"Mã giảm giá:",-1)),C(" "+m(a.order.voucher.code),1)])):_("",!0)])])]),e("div",Bt,[t[16]||(t[16]=e("h4",{class:"font-medium mb-2"},"Địa chỉ giao hàng",-1)),a.order.shipping_address?(g(),y("div",jt,[e("p",Ut,m(a.order.shipping_address.address),1),e("p",Nt,m(s.formatAddress(a.order.shipping_address))+" ("+m(a.order.shipping_address.ward.name)+", "+m(a.order.shipping_address.district.name)+", "+m(a.order.shipping_address.province.name)+") ",1)])):(g(),y("p",Ot,"Chưa có địa chỉ giao hàng"))])]}),_:1}),S(d,null,{header:w(()=>t[17]||(t[17]=[e("h3",{class:"text-lg font-medium"},"Danh sách sản phẩm/dịch vụ",-1)])),default:w(()=>[e("div",Ht,[e("table",Dt,[t[21]||(t[21]=e("thead",null,[e("tr",{class:"bg-gray-50 dark:bg-dark-bg/50"},[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Sản phẩm/Dịch vụ "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Đơn giá "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số lượng "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thành tiền ")])],-1)),e("tbody",Et,[(g(!0),y(G,null,K(a.order.order_items,c=>(g(),y("tr",{key:c.id,class:"hover:bg-gray-50 dark:hover:bg-dark-bg/30"},[e("td",$t,[e("div",Lt,[s.getItemImage(c)?(g(),y("img",{key:0,src:s.getItemImage(c),class:"h-10 w-10 rounded-lg object-cover mr-3"},null,8,Pt)):_("",!0),e("div",null,[e("div",At,m(s.getItemName(c)),1),e("div",zt,[S(u,{type:c.item_type},null,8,["type"]),c.service_type?(g(),y("span",Ft,m(s.getServiceTypeText(c.service_type)),1)):_("",!0)])])])]),e("td",qt,m(s.formatCurrency(c.price)),1),e("td",Gt,m(c.quantity),1),e("td",Kt,m(s.formatCurrency(c.price*c.quantity)),1)]))),128))]),e("tfoot",Xt,[e("tr",null,[t[18]||(t[18]=e("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Tổng tiền:",-1)),e("td",Jt,m(s.formatCurrency(a.order.total_amount)),1)]),a.order.discount_amount?(g(),y("tr",Qt,[t[19]||(t[19]=e("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Giảm giá:",-1)),e("td",Zt," -"+m(s.formatCurrency(a.order.discount_amount)),1)])):_("",!0),e("tr",Rt,[t[20]||(t[20]=e("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Thành tiền:",-1)),e("td",Wt,m(s.formatCurrency(a.order.total_amount-a.order.discount_amount)),1)])])])])]),_:1}),s.orderTimeline.length?(g(),N(d,{key:0},{header:w(()=>t[22]||(t[22]=[e("h3",{class:"text-lg font-medium"},"Lịch sử đơn hàng",-1)])),default:w(()=>[e("div",Yt,[e("ul",en,[(g(!0),y(G,null,K(s.orderTimeline,(c,F)=>(g(),y("li",{key:c.id},[e("div",tn,[F!==s.orderTimeline.length-1?(g(),y("span",nn)):_("",!0),e("div",sn,[e("div",null,[e("span",{class:B(["h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white dark:ring-dark-surface",c.iconBackground])},[e("i",{class:B([c.iconClass,"text-white"]),"aria-hidden":"true"},null,2)],2)]),e("div",on,[e("div",null,[e("p",an,m(c.content),1)]),e("div",rn,[e("time",{datetime:c.datetime},m(s.formatDateTime(c.datetime)),9,ln)])])])])]))),128))])])]),_:1})):_("",!0)]),e("div",dn,[S(d,null,{default:w(()=>[e("div",cn,[e("div",null,[t[24]||(t[24]=e("h3",{class:"text-lg font-medium mb-3"},"Trạng thái đơn hàng",-1)),e("div",un,[t[23]||(t[23]=e("span",{class:"text-gray-600"},"Trạng thái hiện tại",-1)),S(v,{status:a.order.status,class:"px-3 py-1"},null,8,["status"])])]),e("div",mn,[s.canUpdateStatus?(g(),y("button",{key:0,onClick:t[0]||(t[0]=(...c)=>s.openUpdateStatusModal&&s.openUpdateStatusModal(...c)),class:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},t[25]||(t[25]=[e("i",{class:"mdi mdi-pencil-outline mr-2"},null,-1),C(" Cập nhật trạng thái ")]))):_("",!0),s.canCancel?(g(),y("button",{key:1,onClick:t[1]||(t[1]=(...c)=>s.openCancelModal&&s.openCancelModal(...c)),class:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},t[26]||(t[26]=[e("i",{class:"mdi mdi-close-circle-outline mr-2"},null,-1),C(" Hủy đơn hàng ")]))):_("",!0),s.canComplete?(g(),y("button",{key:2,onClick:t[2]||(t[2]=(...c)=>s.openCompleteModal&&s.openCompleteModal(...c)),class:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},t[27]||(t[27]=[e("i",{class:"mdi mdi-check-circle-outline mr-2"},null,-1),C(" Hoàn thành đơn hàng ")]))):_("",!0)])])]),_:1}),S(d,null,{header:w(()=>t[28]||(t[28]=[e("h3",{class:"text-lg font-medium"},"Thông tin thanh toán",-1)])),default:w(()=>[a.order.invoice?(g(),y("div",gn,[e("div",hn,[t[29]||(t[29]=e("span",{class:"text-gray-500"},"Trạng thái",-1)),S(h,{status:a.order.invoice.status},null,8,["status"])]),e("div",pn,[e("div",fn,[t[30]||(t[30]=e("span",{class:"text-gray-500"},"Tổng tiền",-1)),e("span",yn,m(s.formatCurrency(a.order.invoice.total_amount)),1)]),e("div",bn,[t[31]||(t[31]=e("span",{class:"text-gray-500"},"Đã thanh toán",-1)),e("span",vn,m(s.formatCurrency(a.order.invoice.paid_amount)),1)]),e("div",xn,[t[32]||(t[32]=e("span",{class:"text-gray-500"},"Còn lại",-1)),e("span",kn,m(s.formatCurrency(a.order.invoice.remaining_amount)),1)])]),S(r,{href:n.route("invoices.show",a.order.invoice.id),class:"btn-primary w-full text-center"},{default:w(()=>t[33]||(t[33]=[e("i",{class:"mdi mdi-file-document-outline mr-2"},null,-1),C(" Xem chi tiết hóa đơn ")])),_:1},8,["href"])])):(g(),y("div",Cn,[t[35]||(t[35]=e("div",{class:"mb-4"},[e("i",{class:"mdi mdi-file-document-plus-outline text-5xl text-gray-400"})],-1)),t[36]||(t[36]=e("p",{class:"text-gray-500 mb-4"},"Chưa có hóa đơn cho đơn hàng này",-1)),s.canCreateInvoice?(g(),y("button",{key:0,onClick:t[3]||(t[3]=(...c)=>s.openCreateInvoiceModal&&s.openCreateInvoiceModal(...c)),class:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},t[34]||(t[34]=[e("i",{class:"mdi mdi-plus-circle-outline mr-2 text-xl"},null,-1),C(" Tạo hóa đơn mới ")]))):_("",!0)]))]),_:1})])]),S(k,{modelValue:s.showStatusModal,"onUpdate:modelValue":t[4]||(t[4]=c=>s.showStatusModal=c),order:a.order,"available-statuses":s.getAvailableStatuses,onUpdated:s.handleStatusUpdated},null,8,["modelValue","order","available-statuses","onUpdated"]),S($,{modelValue:s.showCreateInvoiceModal,"onUpdate:modelValue":t[5]||(t[5]=c=>s.showCreateInvoiceModal=c),order:a.order,onCreated:s.handleInvoiceCreated},null,8,["modelValue","order","onCreated"]),S(L,{modelValue:s.showCompleteModal,"onUpdate:modelValue":t[6]||(t[6]=c=>s.showCompleteModal=c),order:a.order,"has-service-combo":s.hasServiceCombo,onCompleted:s.handleOrderCompleted},null,8,["modelValue","order","has-service-combo","onCompleted"]),S(P,{modelValue:s.showCancelModal,"onUpdate:modelValue":t[7]||(t[7]=c=>s.showCancelModal=c),order:a.order,onCancelled:s.handleOrderCancelled},null,8,["modelValue","order","onCancelled"])]),_:1},8,["breadcrumbs"])]),_:1})}const fs=Me(kt,[["render",_n]]);export{fs as default};
