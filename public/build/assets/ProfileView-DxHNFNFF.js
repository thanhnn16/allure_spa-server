import{c as b,aU as f,a0 as v,bH as l,b1 as E,aa as a,bl as r,a3 as p,a9 as C,bf as y,a2 as K,a1 as T,f as H,o as J,e as L,bM as j}from"./@vue-BRgAy5zV.js";import{Q,T as A,Z as X,F}from"./@inertiajs-D0DMCEQB.js";import{u as G}from"./main-BNmBi4-k.js";import{aF as R,A as Z,aG as W,n as I,k as Y,O as ee,aH as ae,aI as te,B as oe,o as re,aJ as P}from"./@mdi-DWfqH7fj.js";import{_ as ne}from"./SectionMain-Vot1TOkK.js";import{_ as V}from"./CardBox-jfYP3QDG.js";import{_ as le,L as ie}from"./LayoutAuthenticated-Dy-plR8e.js";import{_ as u}from"./FormField-Da_P6kO8.js";import{_ as d}from"./FormControl-BSsARiYM.js";import{_ as w}from"./BaseButton-eMTGofBM.js";import{_ as B}from"./BaseButtons-B17KSMwc.js";import{_ as se}from"./BaseLevel-vqqndN8O.js";import{_ as me}from"./UserAvatar-Dt3yLH1G.js";import{_ as ue}from"./PillTag-BbG8P_L6.js";import{_ as M}from"./BaseIcon-B4kwkOCn.js";import{_ as de}from"./SectionTitleLineWithButton-DROPEx3n.js";import{a as z}from"./axios-CCb-kr4I.js";import{u as pe}from"./vue-toastification-ejyjJRED.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./pinia-BhnhDyRZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-DHUio15U.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";const ce={__name:"UserAvatarCurrentUser",props:{avatarUrl:{type:String,default:null},size:{type:String,default:"md"}},setup(_){const s=b(()=>{const i=Q().props.auth.user;return i&&i.full_name?i.full_name:"Guest"});return(i,c)=>(f(),v(me,{fullName:s.value,"avatar-url":_.avatarUrl,size:_.size},{default:l(()=>[E(i.$slots,"default")]),_:3},8,["fullName","avatar-url","size"]))}},fe={class:"space-y-3 text-center md:text-left lg:mx-12"},_e={class:"text-2xl"},he={class:"flex items-center justify-center md:justify-start text-gray-500"},ge={key:0,class:"flex items-center justify-center md:justify-start text-gray-500"},be={class:"flex justify-center md:block"},ve={__name:"UserCard",props:{userData:{type:Object,required:!0}},setup(_){const s=G(),i=b(()=>s.fullName),c=b(()=>({admin:"Quản trị viên",staff:"Nhân viên",user:"Khách hàng"})[s.user.role]||s.user.role);return(t,m)=>(f(),v(V,null,{default:l(()=>[a(se,{type:"justify-around lg:justify-center"},{default:l(()=>[a(ce,{class:"lg:mx-12","avatar-url":r(s).user.avatar_url,fullName:i.value,size:"lg"},null,8,["avatar-url","fullName"]),p("div",fe,[p("h1",_e,[m[0]||(m[0]=C(" Xin chào, ")),p("b",null,y(i.value),1),m[1]||(m[1]=C("! "))]),p("div",he,[a(M,{path:r(R),class:"mr-2",size:"20"},null,8,["path"]),p("span",null,y(c.value),1)]),r(s).user.email?(f(),K("div",ge,[a(M,{path:r(Z),class:"mr-2",size:"20"},null,8,["path"]),p("span",null,y(r(s).user.email),1)])):T("",!0),p("div",be,[r(s).user.email_verified_at?(f(),v(ue,{key:0,label:"Đã xác thực",color:"info",icon:r(W)},null,8,["icon"])):T("",!0)])])]),_:1})]),_:1}))}},ye={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ba={__name:"ProfileView",setup(_){const s=G(),i=pe(),c=[{value:"male",label:"Nam"},{value:"female",label:"Nữ"},{value:"other",label:"Khác"}],t=A({full_name:"",email:"",phone_number:"",gender:"",date_of_birth:"",skin_condition:""}),m=H({password_current:"",password:"",password_confirmation:""}),k=A({avatar:null}),x=()=>{const n=s.user;if(n){if(t.full_name=n.full_name||"",t.email=n.email||"",t.phone_number=n.phone_number||"",t.skin_condition=n.skin_condition||"",n.gender){const e=c.find(o=>o.value===n.gender);e&&(!t.gender||t.gender.value!==n.gender)&&(t.gender=e)}if(n.date_of_birth&&(!t.date_of_birth||t.date_of_birth!==n.date_of_birth)){const e=new Date(n.date_of_birth);t.date_of_birth=e.toISOString().split("T")[0]}}},D=()=>{var e;const n={full_name:t.full_name,email:t.email,phone_number:t.phone_number,gender:((e=t.gender)==null?void 0:e.value)||t.gender,date_of_birth:t.date_of_birth,skin_condition:t.skin_condition};console.log("Form data being submitted:",n),z.patch("/api/user/profile",n).then(o=>{console.log("API response success:",o.data),i.success("Cập nhật thông tin thành công"),s.fetchUserInfo(),F.reload()}).catch(o=>{var h,U,$,N;console.error("API error:",{status:(h=o.response)==null?void 0:h.status,data:(U=o.response)==null?void 0:U.data,fullError:o}),(N=($=o.response)==null?void 0:$.data)!=null&&N.message?typeof o.response.data.message=="object"?Object.values(o.response.data.message).forEach(g=>{Array.isArray(g)?g.forEach(S=>{console.log("Validation error:",S),i.error(S)}):(console.log("Validation error:",g),i.error(g))}):(console.log("API error message:",o.response.data.message),i.error(o.response.data.message)):(console.log("Generic error occurred"),i.error("Có lỗi xảy ra khi cập nhật thông tin"))})},O=async n=>{const e=n.target.files[0];if(!e)return;if(e.size>2*1024*1024){i.error("Kích thước file không được vượt quá 2MB");return}if(!["image/jpeg","image/png","image/gif","image/jpg"].includes(e.type)){i.error("Chỉ chấp nhận file ảnh định dạng JPG, PNG hoặc GIF");return}k.avatar=e,i.info("Đang tải ảnh lên..."),k.post("/profile/avatar",{preserveScroll:!0,onSuccess:()=>{i.success("Tải ảnh đại diện thành công"),s.fetchUserInfo(),F.reload()},onError:h=>{i.error(h.avatar||"Không thể tải lên ảnh đại diện")}})},q=()=>{z.post("/api/change-password",m).then(n=>{m.password_current="",m.password="",m.password_confirmation=""}).catch(n=>{})};return J(async()=>{await s.fetchUserInfo(),x()}),L(()=>s.user,n=>{n&&x()},{deep:!0}),b(()=>{const n=c.find(e=>e.value===t.gender);return n?n.label:""}),(n,e)=>(f(),v(ie,null,{default:l(()=>[a(r(X),{title:"Thông tin cá nhân"}),a(ne,null,{default:l(()=>[a(de,{icon:r(I),title:"Thông tin cá nhân",main:""},{default:l(()=>[a(w,{icon:r(Y),label:"Tải lên ảnh đại diện",color:"info","rounded-full":"",small:"",onClick:e[0]||(e[0]=o=>n.$refs.avatarInput.click())},null,8,["icon"]),p("input",{ref:"avatarInput",type:"file",accept:"image/*",class:"hidden",onChange:O},null,544)]),_:1},8,["icon"]),a(ve,{class:"mb-6",userData:r(s).user},null,8,["userData"]),p("div",ye,[a(V,{"is-form":"",onSubmit:j(D,["prevent"])},{footer:l(()=>[a(B,null,{default:l(()=>[a(w,{color:"info",type:"submit",label:"Cập nhật",loading:r(t).processing},null,8,["loading"])]),_:1})]),default:l(()=>[a(u,{label:"Họ và tên",help:"Bắt buộc"},{default:l(()=>[a(d,{modelValue:r(t).full_name,"onUpdate:modelValue":e[1]||(e[1]=o=>r(t).full_name=o),icon:r(I),name:"full_name",required:""},null,8,["modelValue","icon"])]),_:1}),a(u,{label:"Email"},{default:l(()=>[a(d,{modelValue:r(t).email,"onUpdate:modelValue":e[2]||(e[2]=o=>r(t).email=o),icon:r(ee),type:"email",name:"email",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),a(u,{label:"Số điện thoại"},{default:l(()=>[a(d,{modelValue:r(t).phone_number,"onUpdate:modelValue":e[3]||(e[3]=o=>r(t).phone_number=o),icon:r(ae),name:"phone_number"},null,8,["modelValue","icon"])]),_:1}),a(u,{label:"Giới tính"},{default:l(()=>[a(d,{modelValue:r(t).gender,"onUpdate:modelValue":e[4]||(e[4]=o=>r(t).gender=o),icon:r(te),type:"select",options:c,name:"gender","value-field":"value","label-field":"label"},null,8,["modelValue","icon"])]),_:1}),a(u,{label:"Ngày sinh"},{default:l(()=>[a(d,{modelValue:r(t).date_of_birth,"onUpdate:modelValue":e[5]||(e[5]=o=>r(t).date_of_birth=o),icon:r(oe),type:"date",name:"date_of_birth"},null,8,["modelValue","icon"])]),_:1}),a(u,{label:"Tình trạng da"},{default:l(()=>[a(d,{modelValue:r(t).skin_condition,"onUpdate:modelValue":e[6]||(e[6]=o=>r(t).skin_condition=o),name:"skin_condition"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{"is-form":"",onSubmit:j(q,["prevent"])},{footer:l(()=>[a(B,null,{default:l(()=>[a(w,{type:"submit",color:"info",label:"Đổi mật khẩu"})]),_:1})]),default:l(()=>[a(u,{label:"Mật khẩu hiện tại",help:"Bắt buộc nhập mật khẩu hiện tại"},{default:l(()=>[a(d,{modelValue:m.password_current,"onUpdate:modelValue":e[7]||(e[7]=o=>m.password_current=o),icon:r(re),name:"password_current",type:"password",required:"",autocomplete:"current-password"},null,8,["modelValue","icon"])]),_:1}),a(le),a(u,{label:"Mật khẩu mới",help:"Bắt buộc nhập mật khẩu mới"},{default:l(()=>[a(d,{modelValue:m.password,"onUpdate:modelValue":e[8]||(e[8]=o=>m.password=o),icon:r(P),name:"password",type:"password",required:"",autocomplete:"new-password"},null,8,["modelValue","icon"])]),_:1}),a(u,{label:"Xác nhận mật khẩu",help:"Nhập lại mật khẩu mới"},{default:l(()=>[a(d,{modelValue:m.password_confirmation,"onUpdate:modelValue":e[9]||(e[9]=o=>m.password_confirmation=o),icon:r(P),name:"password_confirmation",type:"password",required:"",autocomplete:"new-password"},null,8,["modelValue","icon"])]),_:1})]),_:1})])]),_:1})]),_:1}))}};export{ba as default};
