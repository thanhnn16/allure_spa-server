import{r as O,o as L,e as C,aU as l,a2 as c,a3 as a,bf as f,a1 as v,c as b,f as z,a0 as G,bH as F,aa as x,bl as j,a9 as Y,bM as R,b0 as N,bJ as $,bA as q,bz as K,F as J}from"./@vue-BRgAy5zV.js";import{_ as U}from"./BaseButton-eMTGofBM.js";import{_ as P}from"./BaseIcon-B4kwkOCn.js";import{m as Q}from"./codemirror-CVTlwwoA.js";import{E as D,j as W,o as X}from"./@codemirror-CGiQA2_Y.js";import{i as Z}from"./@mdi-ybpv6R7X.js";import{u as tt}from"./vue-toastification-ejyjJRED.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as st,G as ot,Y as rt}from"./@headlessui-BdO8fvzs.js";import"./@inertiajs-D0DMCEQB.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./colors-S7_1wET5.js";import"./@lezer-Cz8LLRrF.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";const at={class:"json-editor-container"},nt={key:0,class:"text-red-500 text-sm mt-2"},it={__name:"JsonEditor",props:{modelValue:{type:[String,Object],required:!0},schema:{type:Object,default:null}},emits:["update:modelValue","error"],setup(V,{emit:_}){const d=V,u=_,y=O(""),k=O(null);let o=null;L(()=>{const r=typeof d.modelValue=="string"?d.modelValue:JSON.stringify(d.modelValue,null,2);o=new D({doc:r,extensions:[Q,W(),X,D.updateListener.of(n=>{if(n.docChanged){const S=n.state.doc.toString();E(S)}})],parent:k.value})}),C(()=>d.modelValue,r=>{if(!o)return;const n=typeof r=="string"?r:JSON.stringify(r,null,2);n!==o.state.doc.toString()&&o.dispatch({changes:{from:0,to:o.state.doc.length,insert:n}})});const p=()=>{try{const r=o.state.doc.toString(),n=JSON.parse(r),S=JSON.stringify(n,null,2);o.dispatch({changes:{from:0,to:o.state.doc.length,insert:S}}),y.value=""}catch{y.value="Invalid JSON format"}},g=()=>{try{const r=o.state.doc.toString(),n=JSON.parse(r);return y.value="",u("update:modelValue",n),!0}catch(r){return y.value=r.message,u("error",r.message),!1}},E=r=>{try{const n=typeof r=="object"?JSON.stringify(r,null,2):r;u("update:modelValue",n),u("error",null)}catch(n){u("error",n.message)}};return(r,n)=>(l(),c("div",at,[a("div",{ref_key:"editorElement",ref:k,class:"min-h-[300px]"},null,512),y.value?(l(),c("div",nt,f(y.value),1)):v("",!0),a("div",{class:"flex justify-end mt-2 space-x-2"},[a("button",{onClick:p,class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"}," Format "),a("button",{onClick:g,class:"px-3 py-1 text-sm bg-blue-100 hover:bg-blue-200 rounded"}," Validate ")])]))}};function lt(){return{validateConfig:_=>{const d={};return Object.entries({ai_name:"Tên cấu hình",type:"Loại cấu hình",context:"Nội dung cấu hình",language:"Ngôn ngữ",model_type:"Model AI"}).forEach(([o,p])=>{var g;(g=_[o])!=null&&g.toString().trim()||(d[o]=`${p} là bắt buộc`)}),Object.entries({temperature:{min:0,max:1},top_p:{min:0,max:1},top_k:{min:1,max:100},max_tokens:{min:1,max:8192}}).forEach(([o,p])=>{const g=parseFloat(_[o]);(isNaN(g)||g<p.min||g>p.max)&&(d[o]=`${o} phải từ ${p.min} đến ${p.max}`)}),["function_declarations","safety_settings","tool_config"].forEach(o=>{if(_[o])try{typeof _[o]=="string"&&JSON.parse(_[o])}catch{d[o]=`${o} không đúng định dạng JSON`}}),{isValid:Object.keys(d).length===0,errors:d}}}}const ct={class:"fixed inset-0 flex items-center justify-center p-4"},ut={class:"p-6 border-b border-gray-200 dark:border-gray-700"},mt={class:"flex justify-between items-center"},dt={class:"max-h-[calc(100vh-16rem)] overflow-y-auto p-6"},pt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},yt={class:"space-y-6"},gt=["for"],ft=["id","onUpdate:modelValue"],_t=["id","onUpdate:modelValue"],ht=["value"],vt={key:2,class:"mt-1 text-sm text-gray-500"},bt={class:"space-y-6"},xt=["for"],kt=["id","onUpdate:modelValue","min","max","step"],St={key:1,class:"mt-1 text-sm text-gray-500"},Ot={class:"space-y-6 mt-8"},Vt=["for"],jt={key:0,class:"mt-1 text-sm text-red-600"},Nt={key:1,class:"mt-1 text-sm text-gray-500"},Jt={class:"p-6 border-t border-gray-200 dark:border-gray-700"},Et={class:"flex justify-end space-x-3"},Ft={__name:"EditModal",props:{config:{type:Object,default:()=>null},fields:{type:Array,required:!0},configTypes:{type:Object,required:!0},modelTypes:{type:Object,required:!0},languages:{type:Object,required:!0},responseFormats:{type:Object,required:!0},defaultSafetySettings:{type:Array,required:!0},defaultFunctionDeclarations:{type:Array,required:!0},defaultToolConfig:{type:Object,required:!0}},emits:["close","submit"],setup(V,{emit:_}){const d=tt(),u=V,y=_,{validateConfig:k}=lt(),o=O(!1),p=O({}),g=b(()=>u.fields.filter(e=>e.column==="left"&&e.type!=="json-editor")),E=b(()=>u.fields.filter(e=>e.column==="right"&&e.type!=="json-editor")),r=b(()=>u.fields.filter(e=>e.type==="json-editor")),n=b(()=>{var e;return!!((e=u.config)!=null&&e.id)}),S=b(()=>n.value?"Chỉnh Sửa Cấu Hình":"Thêm Cấu Hình Mới"),w=()=>({ai_name:"",type:"system_prompt",context:JSON.stringify({role:"assistant",description:"Mô tả về vai trò của AI",instructions:"Hãy trả lời một cách chuyên nghiệp và thân thiện",custom_instructions:{system_instructions:"Bạn là một trợ lý AI thông minh...",user_instructions:"Hãy trả lời một cách chuyên nghiệp và thân thiện"}},null,2),language:"vi",model_type:"gemini-1.5-pro",temperature:.7,max_tokens:2048,top_p:.9,top_k:40,safety_settings:JSON.stringify(u.defaultSafetySettings,null,2),function_declarations:JSON.stringify(u.defaultFunctionDeclarations,null,2),tool_config:JSON.stringify(u.defaultToolConfig,null,2)}),m=z(n.value?M(u.config):w());function M(e){const s={...e};return typeof s.context=="object"&&(s.context=JSON.stringify(s.context,null,2)),["safety_settings","function_declarations","tool_config"].forEach(t=>{s[t]&&(s[t]=typeof s[t]=="string"?s[t]:JSON.stringify(s[t],null,2))}),s}C(()=>u.config,e=>{e!=null&&e.id?Object.assign(m,M(e)):Object.assign(m,w())},{immediate:!0});const I=b(()=>n.value?"Cập Nhật":"Tạo Mới"),h=O({}),A=(e,s)=>{s?h.value[e]=s:delete h.value[e]},B=()=>{const e=["safety_settings","function_declarations","tool_config"];let s=!0;return e.forEach(t=>{try{if(m[t]){let i=m[t];typeof i=="string"&&JSON.parse(i),delete h.value[t]}}catch(i){console.error(`Error validating ${t}:`,i),h.value[t]=`Invalid JSON format in ${t}`,s=!1}}),s},H=()=>{const{isValid:e,errors:s}=k(m),t=B();return!e||!t?(p.value=s,!1):(p.value={},!0)},T=async()=>{try{if(!H())return;const e={...m};typeof e.context=="object"&&(e.context=JSON.stringify(e.context)),["safety_settings","function_declarations","tool_config"].forEach(s=>{if(e[s])try{e[s]=JSON.parse(e[s])}catch{throw new Error(`Invalid JSON in ${s}`)}}),o.value=!0,await y("submit",e),y("close")}catch(e){d.error(e.message||"Có lỗi xảy ra")}finally{o.value=!1}};return C(m,e=>{["safety_settings","function_declarations","tool_config"].forEach(s=>{if(e[s])try{typeof e[s]=="string"&&(JSON.parse(e[s]),delete h.value[s])}catch{h.value[s]=`Invalid JSON format in ${s}`}})},{deep:!0}),(e,s)=>(l(),G(j(rt),{open:!0,onClose:s[2]||(s[2]=t=>e.$emit("close")),class:"relative z-50"},{default:F(()=>[s[3]||(s[3]=a("div",{class:"fixed inset-0 bg-black/30","aria-hidden":"true"},null,-1)),a("div",ct,[x(j(ot),{class:"w-full max-w-3xl rounded bg-white dark:bg-slate-800"},{default:F(()=>[a("div",ut,[a("div",mt,[x(j(st),{class:"text-lg font-medium text-gray-900 dark:text-white"},{default:F(()=>[Y(f(S.value),1)]),_:1}),a("button",{onClick:s[0]||(s[0]=t=>e.$emit("close")),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"},[x(P,{path:j(Z),size:"24"},null,8,["path"])])])]),a("div",dt,[a("form",{onSubmit:R(T,["prevent"]),class:"space-y-6"},[a("div",pt,[a("div",yt,[(l(!0),c(J,null,N(g.value,t=>(l(),c("div",{key:t.key,class:"space-y-2"},[a("label",{for:t.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},f(t.label),9,gt),t.type==="text"?$((l(),c("input",{key:0,id:t.key,"onUpdate:modelValue":i=>m[t.key]=i,type:"text",class:"form-input w-full rounded-md"},null,8,ft)),[[q,m[t.key]]]):t.type==="select"?$((l(),c("select",{key:1,id:t.key,"onUpdate:modelValue":i=>m[t.key]=i,class:"form-select w-full rounded-md"},[(l(!0),c(J,null,N(t.options,i=>(l(),c("option",{key:i.value,value:i.value},f(i.label),9,ht))),128))],8,_t)),[[K,m[t.key]]]):v("",!0),t.description?(l(),c("p",vt,f(t.description),1)):v("",!0)]))),128))]),a("div",bt,[(l(!0),c(J,null,N(E.value,t=>(l(),c("div",{key:t.key,class:"space-y-2"},[a("label",{for:t.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},f(t.label),9,xt),t.type==="number"?$((l(),c("input",{key:0,id:t.key,"onUpdate:modelValue":i=>m[t.key]=i,type:"number",min:t.min,max:t.max,step:t.step,class:"form-input w-full rounded-md"},null,8,kt)),[[q,m[t.key],void 0,{number:!0}]]):v("",!0),t.description?(l(),c("p",St,f(t.description),1)):v("",!0)]))),128))])]),a("div",Ot,[(l(!0),c(J,null,N(r.value,t=>(l(),c("div",{key:t.key,class:"space-y-2"},[a("label",{for:t.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},f(t.label),9,Vt),x(it,{modelValue:m[t.key],"onUpdate:modelValue":i=>m[t.key]=i,schema:t.schema,class:"border rounded-md",onError:i=>A(t.key,i)},null,8,["modelValue","onUpdate:modelValue","schema","onError"]),h.value[t.key]?(l(),c("p",jt,f(h.value[t.key]),1)):v("",!0),t.description?(l(),c("p",Nt,f(t.description),1)):v("",!0)]))),128))])],32)]),a("div",Jt,[a("div",Et,[x(U,{type:"button",label:"Hủy",color:"white",onClick:s[1]||(s[1]=t=>e.$emit("close"))}),x(U,{type:"submit",label:I.value,color:"info",loading:o.value,onClick:T},null,8,["label","loading"])])])]),_:1})])]),_:1}))}},me=et(Ft,[["__scopeId","data-v-3a0352f1"]]);export{me as default};
