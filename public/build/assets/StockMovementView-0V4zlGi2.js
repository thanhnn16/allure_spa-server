import{r as f,c as H,aU as b,a0 as O,bH as r,aa as o,bl as n,a3 as l,bJ as w,bB as F,bM as A,bA as Z,a2 as C,b0 as E,bf as h,j as R,F as I,a9 as L}from"./@vue-BRgAy5zV.js";import{Z as W,F as g}from"./@inertiajs-D0DMCEQB.js";import{L as Y}from"./LayoutAuthenticated-WadtD5fF.js";import{_ as ee}from"./SectionMain-BbIPmLtw.js";import{_ as S}from"./CardBox-jfYP3QDG.js";import{_ as U}from"./BaseButtons-B17KSMwc.js";import{_ as i}from"./BaseButton-eMTGofBM.js";import{_ as s}from"./FormField-Da_P6kO8.js";import{_ as u}from"./FormControl-BSsARiYM.js";import{aJ as te,I as le,aK as oe,aL as re,au as q,b as D}from"./@mdi-Dzgtc9aE.js";import{u as ae}from"./vue-toastification-ejyjJRED.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-CCb-kr4I.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./app-qysCtdHT.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./main-BNmBi4-k.js";const se={class:"flex flex-col md:flex-row justify-between items-center gap-4"},ue={class:"mt-6 p-4 bg-white rounded-lg border border-gray-100 shadow-sm"},ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},de={class:"mt-4 flex justify-end space-x-2"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},pe={class:"flex justify-between items-center mb-4"},ce={class:"flex justify-between items-center mb-4"},ve={class:"mb-4"},fe={class:"flex justify-between items-center"},he={class:"relative"},ge={class:"overflow-x-auto"},be={class:"w-full"},ye={class:"text-right"},xe={class:"text-right"},ke={class:"text-sm text-gray-600"},_e={key:1},Ve={class:"mt-4 flex items-center justify-between"},we={class:"text-sm text-gray-600"},Ce={class:"flex space-x-2"},Se={__name:"StockMovementView",props:{products:{type:Array,default:()=>[]},stockMovements:{type:Object,default:()=>({data:[],from:0,to:0,total:0,current_page:1,last_page:1,prev_page_url:null,next_page_url:null})}},setup(c){const M=c;f({product_id:"",quantity:"",type:{value:"in",label:"Nhập kho"},reason:"",reference_number:"",note:""});const d=f({start_date:"",end_date:"",product_id:"",type:""}),x=f(!1),v=f({}),k=f(!1),$=ae(),N=H(()=>M.products.map(a=>({...a,label:`${a.name} (${P(a.price||0)} - Tồn: ${a.quantity})`,value:a.id}))),P=a=>!a||isNaN(a)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),j=async a=>{k.value=!0;try{const e=a==="in"?m.value:p.value,t={product_id:e.product_id.value||e.product_id,quantity:e.quantity,type:e.type.value,reason:e.reason,reference_number:e.reference_number,note:e.note};g.post(route("stock-movements.store"),t,{onSuccess:()=>{$.success("Tạo phiếu kho thành công"),e.value={product_id:"",quantity:"",type:{value:"in",label:"Nhập kho"},reason:"",reference_number:"",note:""},g.reload()},onError:y=>{$.error(y.message||"Có lỗi xảy ra")}})}catch(e){$.error(e.message||"Có lỗi xảy ra")}finally{k.value=!1}},B=()=>{g.get(route("stock-movements.index"),d.value,{preserveState:!0,preserveScroll:!0})},G=()=>{d.value={start_date:"",end_date:"",product_id:"",type:""},B()},Q=()=>{window.open(route("stock-movements.export",d.value))},z=[{value:"in",label:"Nhập kho"},{value:"out",label:"Xuất kho"}],J=a=>new Date(a).toLocaleString("vi-VN"),K=a=>{try{const e=JSON.parse(a);return`${e.reason||""} ${e.comment||""}`}catch{return a}},T=f(""),X=H(()=>M.stockMovements.data?M.stockMovements.data.filter(a=>{var t,y;const e=T.value.toLowerCase();return a.product.name.toLowerCase().includes(e)||((t=a.note)==null?void 0:t.toLowerCase().includes(e))||((y=a.reference_number)==null?void 0:y.toLowerCase().includes(e))}):[]),_=f(!0),V=f(!0),m=f({product_id:"",quantity:"",type:{value:"in",label:"Nhập kho"},reason:"",reference_number:"",note:""}),p=f({product_id:"",quantity:"",type:{value:"out",label:"Xuất kho"},reason:"",reference_number:"",note:""});return(a,e)=>(b(),O(Y,null,{default:r(()=>[o(n(W),{title:"Quản lý kho"}),o(ee,null,{default:r(()=>[o(S,{class:"mb-6"},{default:r(()=>[l("div",se,[e[23]||(e[23]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-800"},"Quản lý nhập xuất kho"),l("p",{class:"text-gray-600 mt-1"},"Theo dõi và quản lý các hoạt động nhập xuất kho")],-1)),o(U,null,{default:r(()=>[o(i,{color:"info",icon:x.value?n(te):n(le),onClick:e[0]||(e[0]=t=>x.value=!x.value),class:"hover:shadow-lg transition-all",label:"Bộ lọc"},null,8,["icon"]),o(i,{color:"success",icon:n(oe),onClick:Q,class:"hover:shadow-lg transition-all",label:"Xuất Excel"},null,8,["icon"]),o(i,{color:"info",icon:n(re),onClick:e[1]||(e[1]=t=>n(g).get(a.route("reports.stock"))),class:"hover:shadow-lg transition-all",label:"Báo cáo"},null,8,["icon"])]),_:1})]),w(l("div",ue,[l("div",ie,[o(s,{label:"Từ ngày"},{default:r(()=>[o(u,{modelValue:d.value.start_date,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.start_date=t),type:"date"},null,8,["modelValue"])]),_:1}),o(s,{label:"Đến ngày"},{default:r(()=>[o(u,{modelValue:d.value.end_date,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.end_date=t),type:"date"},null,8,["modelValue"])]),_:1}),o(s,{label:"Sản phẩm"},{default:r(()=>[o(u,{modelValue:d.value.product_id,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.product_id=t),type:"select",options:N.value,placeholder:"Tất cả sản phẩm"},null,8,["modelValue","options"])]),_:1}),o(s,{label:"Loại"},{default:r(()=>[o(u,{modelValue:d.value.type,"onUpdate:modelValue":e[5]||(e[5]=t=>d.value.type=t),type:"select",options:z,placeholder:"Tất cả"},null,8,["modelValue"])]),_:1})]),l("div",de,[o(i,{color:"danger",onClick:G,label:"Xóa lọc"}),o(i,{color:"info",onClick:B,label:"Áp dụng"})])],512),[[F,x.value]])]),_:1}),l("div",me,[o(S,{class:"hover:shadow-lg transition-all"},{default:r(()=>[l("div",pe,[e[24]||(e[24]=l("div",null,[l("h2",{class:"text-lg font-semibold text-gray-800"},"Nhập kho"),l("p",{class:"text-gray-600 text-sm"},"Tạo phiếu nhập kho mới")],-1)),o(i,{onClick:e[6]||(e[6]=t=>_.value=!_.value),icon:_.value?n(q):n(D),color:"info",small:""},null,8,["icon"])]),w(l("form",{onSubmit:e[12]||(e[12]=A(t=>j("in"),["prevent"])),class:"space-y-4"},[o(s,{label:"Sản phẩm",error:v.value.product_id},{default:r(()=>[o(u,{modelValue:m.value.product_id,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value.product_id=t),type:"select",options:N.value,placeholder:"Chọn sản phẩm cần nhập kho"},null,8,["modelValue","options"])]),_:1},8,["error"]),o(s,{label:"Số lượng",error:v.value.quantity},{default:r(()=>[o(u,{modelValue:m.value.quantity,"onUpdate:modelValue":e[8]||(e[8]=t=>m.value.quantity=t),type:"number",min:"1",placeholder:"Nhập số lượng sản phẩm"},null,8,["modelValue"])]),_:1},8,["error"]),o(s,{label:"Lý do",error:v.value.reason},{default:r(()=>[o(u,{modelValue:m.value.reason,"onUpdate:modelValue":e[9]||(e[9]=t=>m.value.reason=t),placeholder:"VD: Nhập hàng từ nhà cung cấp, Điều chỉnh tồn kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(s,{label:"Số tham chiếu",error:v.value.reference_number},{default:r(()=>[o(u,{modelValue:m.value.reference_number,"onUpdate:modelValue":e[10]||(e[10]=t=>m.value.reference_number=t),placeholder:"VD: Số hóa đơn, số PO, số phiếu nhập kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(s,{label:"Ghi chú",error:v.value.note},{default:r(()=>[o(u,{modelValue:m.value.note,"onUpdate:modelValue":e[11]||(e[11]=t=>m.value.note=t),type:"textarea",rows:"3",placeholder:"Thông tin bổ sung về đợt nhập kho này..."},null,8,["modelValue"])]),_:1},8,["error"]),o(U,null,{default:r(()=>[o(i,{type:"submit",color:"info",loading:k.value,icon:n(D),label:"Nhập kho"},null,8,["loading","icon"])]),_:1})],544),[[F,_.value]])]),_:1}),o(S,{class:"hover:shadow-lg transition-all"},{default:r(()=>[l("div",ce,[e[25]||(e[25]=l("div",null,[l("h2",{class:"text-lg font-semibold text-gray-800"},"Xuất kho"),l("p",{class:"text-gray-600 text-sm"},"Tạo phiếu xuất kho mới")],-1)),o(i,{onClick:e[13]||(e[13]=t=>V.value=!V.value),icon:V.value?n(q):n(D),color:"danger",small:""},null,8,["icon"])]),w(l("form",{onSubmit:e[19]||(e[19]=A(t=>j("out"),["prevent"])),class:"space-y-4"},[o(s,{label:"Sản phẩm",error:v.value.product_id},{default:r(()=>[o(u,{modelValue:p.value.product_id,"onUpdate:modelValue":e[14]||(e[14]=t=>p.value.product_id=t),type:"select",options:N.value,placeholder:"Chọn sản phẩm cần xuất kho"},null,8,["modelValue","options"])]),_:1},8,["error"]),o(s,{label:"Số lượng",error:v.value.quantity},{default:r(()=>[o(u,{modelValue:p.value.quantity,"onUpdate:modelValue":e[15]||(e[15]=t=>p.value.quantity=t),type:"number",min:"1",placeholder:"Nhập số lượng cần xuất"},null,8,["modelValue"])]),_:1},8,["error"]),o(s,{label:"Lý do",error:v.value.reason},{default:r(()=>[o(u,{modelValue:p.value.reason,"onUpdate:modelValue":e[16]||(e[16]=t=>p.value.reason=t),placeholder:"VD: Xuất cho đơn hàng, Hàng hỏng, Điều chỉnh tồn..."},null,8,["modelValue"])]),_:1},8,["error"]),o(s,{label:"Số tham chiếu",error:v.value.reference_number},{default:r(()=>[o(u,{modelValue:p.value.reference_number,"onUpdate:modelValue":e[17]||(e[17]=t=>p.value.reference_number=t),placeholder:"VD: Mã đơn hàng, số phiếu xuất kho..."},null,8,["modelValue"])]),_:1},8,["error"]),o(s,{label:"Ghi chú",error:v.value.note},{default:r(()=>[o(u,{modelValue:p.value.note,"onUpdate:modelValue":e[18]||(e[18]=t=>p.value.note=t),type:"textarea",rows:"3",placeholder:"Thông tin bổ sung về đợt xuất kho này..."},null,8,["modelValue"])]),_:1},8,["error"]),o(U,null,{default:r(()=>[o(i,{type:"submit",color:"danger",loading:k.value,icon:n(q),label:"Xuất kho"},null,8,["loading","icon"])]),_:1})],544),[[F,V.value]])]),_:1})]),o(S,{class:"hover:shadow-lg transition-all"},{default:r(()=>[l("div",ve,[l("div",fe,[e[27]||(e[27]=l("h2",{class:"text-lg font-semibold text-gray-800"},"Lịch sử giao dịch",-1)),l("div",he,[w(l("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>T.value=t),type:"text",placeholder:"Tìm kiếm...",class:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[Z,T.value]]),e[26]||(e[26]=l("span",{class:"absolute left-3 top-2.5 text-gray-400"},[l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])])]),l("div",ge,[l("table",be,[e[29]||(e[29]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"Thời gian"),l("th",{class:"text-left"},"Sản phẩm"),l("th",{class:"text-left"},"Loại"),l("th",{class:"text-right"},"Số lượng"),l("th",{class:"text-right"},"Tồn kho"),l("th",{class:"text-left"},"Ghi chú")])],-1)),l("tbody",null,[X.value.length?(b(!0),C(I,{key:0},E(X.value,t=>(b(),C("tr",{key:t.id,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors"},[l("td",null,h(J(t.created_at)),1),l("td",null,h(t.product.name),1),l("td",null,[l("span",{class:R(["px-2 py-1 rounded-full text-sm",{"bg-green-100 text-green-800":t.type==="in","bg-red-100 text-red-800":t.type==="out"}])},h(t.type==="in"?"Nhập":"Xuất"),3)]),l("td",ye,h(t.quantity),1),l("td",xe,h(t.stock_after_movement),1),l("td",ke,h(K(t.note)),1)]))),128)):(b(),C("tr",_e,e[28]||(e[28]=[l("td",{colspan:"6",class:"py-8 text-center text-gray-500"},[l("div",{class:"flex flex-col items-center"},[l("svg",{class:"w-12 h-12 mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),l("p",{class:"font-medium"},"Không có dữ liệu"),l("p",{class:"text-sm"},"Chưa có giao dịch nào được thực hiện")])],-1)])))])])]),l("div",Ve,[l("div",we," Hiển thị "+h(c.stockMovements.from||0)+"-"+h(c.stockMovements.to||0)+" trên tổng số "+h(c.stockMovements.total||0)+" bản ghi ",1),l("nav",Ce,[o(i,{disabled:!c.stockMovements.prev_page_url,onClick:e[21]||(e[21]=t=>n(g).get(c.stockMovements.prev_page_url)),color:"white",class:"hover:shadow-md transition-all"},{default:r(()=>e[30]||(e[30]=[L(" Trước ")])),_:1},8,["disabled"]),(b(!0),C(I,null,E(c.stockMovements.last_page,t=>(b(),O(i,{key:t,color:t===c.stockMovements.current_page?"info":"white",onClick:y=>n(g).get(`${a.route("stock-movements.index")}?page=${t}`),class:"hover:shadow-md transition-all"},{default:r(()=>[L(h(t),1)]),_:2},1032,["color","onClick"]))),128)),o(i,{disabled:!c.stockMovements.next_page_url,onClick:e[22]||(e[22]=t=>n(g).get(c.stockMovements.next_page_url)),color:"white",class:"hover:shadow-md transition-all"},{default:r(()=>e[31]||(e[31]=[L(" Sau ")])),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1}))}},xt=ne(Se,[["__scopeId","data-v-95ec14cc"]]);export{xt as default};
