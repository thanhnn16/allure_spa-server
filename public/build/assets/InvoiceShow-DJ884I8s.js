import{Z as xt,i as gt,F as et}from"./@inertiajs-D0DMCEQB.js";import{A as yt,L as ft}from"./LayoutAuthenticated-CBLzeGQR.js";import{_ as bt}from"./SectionMain-Vot1TOkK.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as I,aU as l,a2 as c,a3 as t,a9 as b,bf as s,F as f,b0 as z,a1 as y,a8 as pt,r as h,e as J,o as ht,b as kt,b2 as D,aa as O,bH as Q,j as T,bM as vt,bJ as Z,bA as nt,bz as _t,a0 as at,T as wt}from"./@vue-BRgAy5zV.js";import{a as Y}from"./axios-CCb-kr4I.js";import{u as Ct}from"./vue-toastification-ejyjJRED.js";import{h as Tt}from"./html2pdf.js-yYbeBQq1.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./@mdi-DWfqH7fj.js";import"./app-OyFPVnvx.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./html2canvas-Dy2Co7Il.js";const Pt={components:{AllureLogo:yt},props:{invoice:{type:Object,required:!0}},setup(d){return{subtotalAmount:I(()=>{var r,a;return(a=(r=d.invoice)==null?void 0:r.order)!=null&&a.order_items?d.invoice.order.order_items.reduce((M,m)=>M+Number(m.price)*Number(m.quantity),0):0})}},methods:{formatCurrency(d){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(d)},formatDateTime(d){return new Date(d).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getItemName(d){var e,r;return d.item_type==="service"?((e=d.service)==null?void 0:e.service_name)||"Dịch vụ không xác định":d.item_type==="product"?((r=d.product)==null?void 0:r.name)||"Sản phẩm không xác định":"Không xác định"},getItemCode(d){var e,r;return d.item_type==="service"?((e=d.service)==null?void 0:e.code)||"-":d.item_type==="product"&&((r=d.product)==null?void 0:r.code)||"-"},formatServiceType(d){return{single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"}[d]||d}},mounted(){this.$emit("rendered")}},Nt={class:"print-template w-[210mm] mx-auto bg-white p-8 font-sans"},St={class:"flex items-center justify-between mb-8 border-b pb-6"},jt={class:"text-right"},At={class:"text-base font-medium"},It={class:"text-gray-600"},Mt={class:"mb-8 p-4 bg-gray-50 rounded-lg"},Vt={class:"grid grid-cols-2 gap-4 text-base"},Lt={class:"space-y-2"},Dt={class:"flex gap-4"},Ht={class:"flex gap-4"},qt={class:"mb-8"},Ut={class:"w-full text-base"},Gt={class:"py-3 px-4"},Rt={class:"font-medium"},Bt={class:"text-sm text-gray-600"},Ot={key:0,class:"text-sm font-medium text-gray-600"},zt={class:"py-3 px-4 text-center"},Ft={class:"py-3 px-4 text-right"},Et={class:"py-3 px-4 text-right font-medium"},Kt={class:"flex justify-end mb-8"},Xt={class:"w-80 space-y-3 text-base"},Wt={class:"flex justify-between py-2"},Jt={class:"font-medium"},Qt={key:0,class:"flex justify-between py-2"},Zt={class:"font-medium text-red-600"},Yt={class:"flex justify-between py-3 border-t border-b border-gray-200 font-bold"},$t={class:"flex justify-between py-2"},te={class:"font-medium"},ee={class:"flex justify-between py-2 text-lg font-bold"};function ne(d,e,r,a,M,m){var x,P,N,p;return l(),c("div",Nt,[t("div",St,[e[1]||(e[1]=t("div",{class:"flex items-center gap-4"},[t("img",{src:"/images/icon-192x192.png",alt:"Allure Spa Logo",class:"w-20 h-20 object-contain"}),t("div",null,[t("h1",{class:"text-3xl font-bold tracking-wider text-gray-800"},"ALLURE SPA"),t("p",{class:"text-base leading-relaxed text-gray-600 mt-2"},[b(" 720A Điện Biên Phủ, P. 22, Bình Thạnh, HCM"),t("br"),b(" ĐT: (84) 986 910 920 ")])])],-1)),t("div",jt,[e[0]||(e[0]=t("h2",{class:"text-2xl font-bold mb-3 tracking-wide text-gray-800"},"HÓA ĐƠN THANH TOÁN",-1)),t("p",At,"#"+s(r.invoice.id),1),t("p",It,s(m.formatDateTime(r.invoice.created_at)),1)])]),t("div",Mt,[t("div",Vt,[t("div",Lt,[t("div",Dt,[e[2]||(e[2]=t("span",{class:"font-medium w-32"},"Khách hàng:",-1)),t("span",null,s((x=r.invoice.user)==null?void 0:x.full_name),1)]),t("div",Ht,[e[3]||(e[3]=t("span",{class:"font-medium w-32"},"Số điện thoại:",-1)),t("span",null,s((P=r.invoice.user)==null?void 0:P.phone_number),1)])])])]),t("div",qt,[t("table",Ut,[e[4]||(e[4]=t("thead",null,[t("tr",{class:"bg-gray-50"},[t("th",{class:"py-3 px-4 text-left font-bold border-b"},"SP/DV"),t("th",{class:"py-3 px-4 text-center font-bold border-b w-20"},"SL"),t("th",{class:"py-3 px-4 text-right font-bold border-b w-32"},"Đơn giá"),t("th",{class:"py-3 px-4 text-right font-bold border-b w-32"},"T.Tiền")])],-1)),t("tbody",null,[(l(!0),c(f,null,z((N=r.invoice.order)==null?void 0:N.order_items,g=>(l(),c("tr",{key:g.id,class:"border-b"},[t("td",Gt,[t("div",Rt,s(m.getItemName(g)),1),t("div",Bt,s(m.getItemCode(g)),1),g.service_type?(l(),c("div",Ot,s(m.formatServiceType(g.service_type)),1)):y("",!0)]),t("td",zt,s(g.quantity),1),t("td",Ft,s(m.formatCurrency(g.price)),1),t("td",Et,s(m.formatCurrency(g.price*g.quantity)),1)]))),128))])])]),t("div",Kt,[t("div",Xt,[t("div",Wt,[e[5]||(e[5]=t("span",null,"Tổng tiền hàng:",-1)),t("span",Jt,s(m.formatCurrency(a.subtotalAmount)),1)]),(p=r.invoice.order)!=null&&p.discount_amount?(l(),c("div",Qt,[e[6]||(e[6]=t("span",null,"Giảm giá:",-1)),t("span",Zt,"-"+s(m.formatCurrency(r.invoice.order.discount_amount)),1)])):y("",!0),t("div",Yt,[e[7]||(e[7]=t("span",null,"Tổng thanh toán:",-1)),t("span",null,s(m.formatCurrency(r.invoice.total_amount)),1)]),t("div",$t,[e[8]||(e[8]=t("span",null,"Đã thanh toán:",-1)),t("span",te,s(m.formatCurrency(r.invoice.paid_amount)),1)]),t("div",ee,[e[9]||(e[9]=t("span",null,"Còn lại:",-1)),t("span",null,s(m.formatCurrency(r.invoice.remaining_amount)),1)])])]),e[10]||(e[10]=pt('<div class="mt-12 text-center space-y-4 border-t pt-8" data-v-605061b7><p class="font-medium text-gray-800 text-lg" data-v-605061b7>Cảm ơn quý khách đã sử dụng dịch vụ!</p><div class="text-base text-gray-600 space-y-2" data-v-605061b7><p class="font-medium" data-v-605061b7>Hotline: (84) 986 910 920</p><p class="font-medium" data-v-605061b7>Website: www.allurespa.com.vn</p></div></div>',1))])}const ae=rt(Pt,[["render",ne],["__scopeId","data-v-605061b7"]]),re={components:{Head:xt,Link:gt,LayoutAuthenticated:ft,SectionMain:bt,PrintInvoiceTemplate:ae},props:{invoice:{type:Object,required:!0},paymentMethods:{type:Array,required:!0}},setup(d){var tt;const e=h(0),r=h(((tt=d.paymentMethods[0])==null?void 0:tt.id)||null),a=h(""),M=h(!1),m=h("partial"),x=Ct();J(m,n=>{n==="full"?e.value=d.invoice.remaining_amount:e.value=0}),J(e,n=>{n>d.invoice.remaining_amount&&(e.value=d.invoice.remaining_amount)});const P=n=>{m.value=n,n==="full"?e.value=d.invoice.remaining_amount:e.value=0},N=n=>({cash:"Tiền mặt",bank_transfer:"Chuyển khoản",card:"Thẻ"})[n]||n,p=h(!1),g=h(null),C=async()=>{try{let A=function(){URL.revokeObjectURL(v),document.body.contains(o)&&document.body.removeChild(o),p.value=!1};const n=g.value.$el,o=document.createElement("div");o.appendChild(n.cloneNode(!0)),document.body.appendChild(o);const u={margin:[10,10,10,10],image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,width:793},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}},_=await Tt().set(u).from(o.firstChild).outputPdf("blob"),v=URL.createObjectURL(_),w=window.open(v,"_blank");if(w){w.onload=()=>{w.print()};const W=setInterval(()=>{w.closed&&(clearInterval(W),A())},1e3);w.onafterprint=()=>{clearInterval(W),A()},w.onbeforeunload=()=>{clearInterval(W),A()}}else x.error("Vui lòng cho phép popup để in hóa đơn!"),A()}catch(n){console.error("Print error:",n),x.error("Có lỗi xảy ra khi in. Vui lòng thử lại!"),p.value=!1}},V=async()=>{var n,o;try{const u=`${window.location.origin}/payment/callback`,_=`${window.location.origin}/payment/callback?status=cancel`,v=await Y.post(`/api/invoices/${d.invoice.id}/pay`,{payment_amount:e.value,payment_method:r.value,note:a.value,returnUrl:u,cancelUrl:_});if(v.data.success&&v.data.data.checkoutUrl)window.location.href=v.data.data.checkoutUrl;else throw new Error(v.data.message||"Không thể tạo link thanh toán")}catch(u){x.error("Lỗi xử lý thanh toán: "+(((o=(n=u.response)==null?void 0:n.data)==null?void 0:o.message)||u.message))}},H=()=>{var n,o,u;return(u=(o=(n=d.invoice)==null?void 0:n.order)==null?void 0:o.orderItems)!=null&&u.length?d.invoice.order.orderItems.reduce((_,v)=>{const w=Number(v.price)||0,A=Number(v.quantity)||0;return _+w*A},0):0},L=I(()=>{var n,o,u,_;return(o=(n=d.invoice)==null?void 0:n.order)!=null&&o.total_amount&&((_=(u=d.invoice)==null?void 0:u.order)!=null&&_.discount_amount)?Number(d.invoice.order.total_amount):H()}),k=n=>{const o=Number(n);return isNaN(o)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(o)},S=n=>new Date(n).toLocaleString("vi-VN"),q=n=>{switch(n){case"pending":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800";case"partial":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800";case"paid":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800";case"cancelled":return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800";default:return"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"}},U=n=>{switch(n){case"pending":return"Chờ thanh toán";case"partial":return"Thanh toán một phần";case"paid":return"Đã thanh toán";case"cancelled":return"Đã hủy";default:return"Không xác định"}},G=I(()=>d.invoice.status!=="paid"&&d.invoice.status!=="cancelled");J(e,n=>{n>d.invoice.remaining_amount&&(e.value=d.invoice.remaining_amount,x.warning("Số tiền không thể lớn hơn số tiền cần thanh toán"))});const i=n=>n.item_name??"Không xác định",j=n=>({single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"})[n]||n,R=n=>({single:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800",combo_5:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",combo_10:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800"})[n]||"",B=n=>n?n.discount_type==="percentage"?`Giảm ${n.discount_value}%`:n.discount_type==="fixed"?`Giảm ${k(n.discount_value)}`:n.description||"":"",st=n=>{if(!n)return"";let o="";return n.discount_type==="percentage"?o=`Giảm ${n.discount_value}% `:n.discount_type==="fixed"&&(o=`Giảm ${k(n.discount_value)} `),n.min_order_amount&&(o+=`cho đơn hàng từ ${k(n.min_order_amount)}`),n.start_date&&n.end_date&&(o+=` (Có hiệu lực: ${S(n.start_date)} - ${S(n.end_date)})`),o||n.description||""},ot=I(()=>{const n=d.invoice.order;if(!(n!=null&&n.voucher_id))return"";const o=Number(n.discount_amount),u=Number(L.value);return o&&u?`Giảm ${(o/u*100).toFixed(1)}% (${k(o)})`:`Giảm ${k(n.discount_amount)}`}),F=h(!1),it=I(()=>d.invoice.status==="pending"||d.invoice.status==="partial"),dt=()=>{F.value=!0},lt=n=>{const o="px-2 py-1 rounded-full text-sm font-medium";return{pending:`${o} bg-yellow-100 text-yellow-800`,processing:`${o} bg-blue-100 text-blue-800`,completed:`${o} bg-green-100 text-green-800`,cancelled:`${o} bg-red-100 text-red-800`}[n]||`${o} bg-gray-100 text-gray-800`},ct=n=>({pending:"Chờ xử lý",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[n]||"Không xác định",ut=n=>{var o,u;return n.item_type==="service"?((o=n.service)==null?void 0:o.code)||"-":n.item_type==="product"&&((u=n.product)==null?void 0:u.code)||"-"},$=I({get(){return k(e.value)},set(n){const o=Number(n.replace(/[^0-9.-]+/g,""));e.value=isNaN(o)?0:o}}),mt=n=>{$.value=n.target.value};ht(()=>{const n=o=>{o.key==="Escape"&&p.value&&(p.value=!1)};window.addEventListener("keydown",n),kt(()=>{window.removeEventListener("keydown",n)})});const E=h(!1),K=h(!1),X=h(!1);return{paymentAmount:e,paymentMethod:r,paymentNote:a,processing:M,paymentType:m,selectPaymentType:P,getPaymentMethodText:N,toast:x,formatCurrency:k,formatDateTime:S,getStatusClass:q,getStatusText:U,processPayment:async()=>{var n,o;try{if(E.value=!0,r.value===3){await V();return}const u=await Y.post(`/invoices/${d.invoice.id}/process-payment`,{payment_amount:e.value,payment_method_id:r.value,note:a.value});x.success("Đã cập nhật thanh toán cho hóa đơn"),u.data.data.status==="paid"&&x.success("Hóa đơn đã được thanh toán đầy đủ"),et.reload({only:["invoice"]}),e.value=0,a.value=""}catch(u){console.error("Payment processing error:",u),x.error(((o=(n=u.response)==null?void 0:n.data)==null?void 0:o.message)||"Có lỗi xảy ra khi xử lý thanh toán")}finally{E.value=!1}},printInvoice:async()=>{try{X.value=!0,p.value=!0}catch(n){console.error("Print error:",n),x.error("Có lỗi xảy ra khi in hóa đơn")}finally{X.value=!1}},showPaymentForm:G,getItemName:i,formatServiceType:j,getServiceTypeClass:R,getVoucherDescription:B,subtotalAmount:L,getDetailedVoucherDescription:st,getVoucherInfo:ot,showCancelModal:F,canCancel:it,confirmCancelInvoice:dt,cancelInvoice:async()=>{var n,o;try{K.value=!0;const u=await Y.post(`/invoices/${d.invoice.id}/cancel`);x.success("Hóa đơn đã được hủy thành công"),et.reload({only:["invoice"]}),F.value=!1}catch(u){console.error("Cancel invoice error:",u),x.error(((o=(n=u.response)==null?void 0:n.data)==null?void 0:o.message)||"Có lỗi xảy ra khi hủy hóa đơn")}finally{K.value=!1}},getOrderStatusClass:lt,getOrderStatusText:ct,getItemCode:ut,printTemplateRef:g,formattedPaymentAmount:$,updatePaymentAmount:mt,isPrinting:p,handlePrintAfterRender:C,handlePayOSPayment:V,paymentMethods:d.paymentMethods,isProcessingPayment:E,isProcessingCancel:K,isPrintProcessing:X}}},se={class:"container mx-auto px-4 py-8"},oe={class:"flex justify-between items-center mb-6"},ie={class:"text-2xl font-semibold text-gray-900 dark:text-dark-text"},de={class:"flex space-x-4"},le=["disabled"],ce=["disabled"],ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},me={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow"},xe={class:"flex items-center space-x-2"},ge={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow"},ye={class:"space-y-2"},fe={class:"flex justify-between"},be={class:"font-medium text-gray-900 dark:text-dark-text"},pe={key:0,class:"flex flex-col space-y-1"},he={class:"flex justify-between text-green-600"},ke={class:"font-medium"},ve={class:"flex justify-between text-green-600"},_e={class:"font-medium"},we={class:"flex justify-between font-bold border-t border-gray-200 dark:border-dark-border pt-2"},Ce={class:"text-gray-900 dark:text-dark-text"},Te={class:"flex justify-between"},Pe={class:"text-green-600 font-medium"},Ne={class:"flex justify-between"},Se={class:"text-red-600 font-medium"},je={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},Ae={class:"grid grid-cols-2 gap-6"},Ie={class:"space-y-3"},Me={class:"flex justify-between"},Ve={class:"font-medium text-gray-900 dark:text-dark-text"},Le={class:"flex justify-between"},De={class:"font-medium text-gray-900 dark:text-dark-text"},He={class:"flex justify-between"},qe={class:"font-medium text-gray-900 dark:text-dark-text"},Ue={class:"flex justify-between"},Ge={class:"font-medium text-gray-900 dark:text-dark-text"},Re={class:"space-y-3"},Be={class:"flex justify-between"},Oe={class:"font-medium text-gray-900 dark:text-dark-text"},ze={class:"flex justify-between"},Fe={class:"font-medium text-gray-900 dark:text-dark-text"},Ee={class:"flex justify-between"},Ke={class:"font-medium text-gray-900 dark:text-dark-text"},Xe={class:"flex justify-between"},We={class:"font-medium text-gray-900 dark:text-dark-text"},Je={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},Qe={class:"overflow-x-auto"},Ze={class:"min-w-full divide-y divide-gray-200 dark:divide-dark-border"},Ye={class:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border"},$e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},tn={class:"px-6 py-4 whitespace-nowrap"},en={class:"text-sm font-medium text-gray-900 dark:text-dark-text"},nn={class:"text-xs text-gray-500 dark:text-dark-text-muted"},an={key:0,class:"text-sm text-gray-500 dark:text-dark-text-muted"},rn={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-dark-text-muted"},sn={class:"px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-dark-text-muted"},on={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900 dark:text-dark-text"},dn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},ln={class:"bg-gray-50 dark:bg-dark-surface"},cn={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"},un={key:0,class:"bg-gray-50 dark:bg-dark-surface text-green-600"},mn={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"},xn={class:"bg-gray-100 dark:bg-dark-surface font-bold"},gn={class:"px-6 py-4 text-right text-gray-900 dark:text-dark-text"},yn={key:0,class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},fn={class:"mb-4"},bn={class:"flex space-x-4"},pn={class:"mt-1 text-sm text-gray-500 dark:text-dark-text-muted"},hn=["value"],kn=["disabled"],vn={key:1,class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},_n={class:"overflow-x-auto"},wn={class:"min-w-full divide-y divide-gray-200 dark:divide-dark-border"},Cn={class:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border"},Tn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},Pn={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-dark-text"},Nn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},Sn={class:"px-6 py-4 whitespace-nowrap"},jn={class:"px-6 py-4 whitespace-nowrap"},An={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-muted"},In={class:"px-6 py-4 text-sm text-gray-500 dark:text-dark-text-muted"},Mn={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow mb-8"},Vn={class:"flex justify-between items-center mb-4"},Ln={key:0,class:"grid grid-cols-2 gap-6"},Dn={class:"space-y-3"},Hn={class:"flex justify-between"},qn={class:"flex justify-between"},Un={class:"font-medium text-gray-900 dark:text-dark-text"},Gn={class:"space-y-3"},Rn={class:"flex justify-between"},Bn={class:"font-medium text-gray-900 dark:text-dark-text"},On={key:0,class:"flex justify-between text-green-600"},zn={class:"font-medium"},Fn={key:1,class:"text-center py-4 text-gray-500 dark:text-dark-text-muted"},En={class:"print-container",style:{display:"none"}},Kn={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Xn={class:"bg-white dark:bg-dark-surface p-6 rounded-lg shadow-lg max-w-md w-full"},Wn={class:"flex justify-end space-x-4"},Jn=["disabled"],Qn=["disabled"];function Zn(d,e,r,a,M,m){const x=D("Head"),P=D("Link"),N=D("PrintInvoiceTemplate"),p=D("SectionMain"),g=D("LayoutAuthenticated");return l(),c("div",null,[O(g,null,{default:Q(()=>[O(x,{title:"Chi tiết hóa đơn"}),O(p,{breadcrumbs:[{label:"Quản lý hóa đơn",href:d.route("invoices.index")},{label:`Hóa đơn #${r.invoice.id}`}]},{default:Q(()=>{var C,V,H,L,k,S,q,U,G;return[t("div",se,[t("div",oe,[t("h1",ie,"Chi tiết hóa đơn #"+s(r.invoice.id),1),t("div",de,[t("button",{onClick:e[0]||(e[0]=(...i)=>a.printInvoice&&a.printInvoice(...i)),disabled:a.isPrintProcessing,class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-opacity duration-200"},[a.isPrintProcessing?(l(),c(f,{key:0},[e[11]||(e[11]=t("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e[12]||(e[12]=b(" Đang xử lý... "))],64)):(l(),c(f,{key:1},[e[13]||(e[13]=t("i",{class:"fas fa-print mr-2"},null,-1)),e[14]||(e[14]=b(" In hóa đơn "))],64))],8,le),a.canCancel?(l(),c("button",{key:0,onClick:e[1]||(e[1]=(...i)=>a.confirmCancelInvoice&&a.confirmCancelInvoice(...i)),disabled:a.isProcessingCancel,class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-opacity duration-200"},[a.isProcessingCancel?(l(),c(f,{key:0},[e[15]||(e[15]=t("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e[16]||(e[16]=b(" Đang xử lý... "))],64)):(l(),c(f,{key:1},[e[17]||(e[17]=t("i",{class:"fas fa-times mr-2"},null,-1)),e[18]||(e[18]=b(" Hủy hóa đơn "))],64))],8,ce)):y("",!0)])]),t("div",ue,[t("div",me,[e[19]||(e[19]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Trạng thái hóa đơn",-1)),t("div",xe,[t("span",{class:T([a.getStatusClass(r.invoice.status),"px-3 py-1 rounded-full text-sm"])},s(a.getStatusText(r.invoice.status)),3)])]),t("div",ge,[e[26]||(e[26]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thông tin thanh toán",-1)),t("div",ye,[t("div",fe,[e[20]||(e[20]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền hàng:",-1)),t("span",be,s(a.formatCurrency(a.subtotalAmount)),1)]),(C=r.invoice.order)!=null&&C.voucher_id?(l(),c("div",pe,[t("div",he,[e[21]||(e[21]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-ticket-alt mr-2"}),b(" Voucher áp dụng: ")],-1)),t("span",ke,s(a.getVoucherInfo),1)]),t("div",ve,[e[22]||(e[22]=t("span",null,"Giảm giá:",-1)),t("span",_e,"-"+s(a.formatCurrency(r.invoice.order.discount_amount)),1)])])):y("",!0),t("div",we,[e[23]||(e[23]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền sau giảm giá:",-1)),t("span",Ce,s(a.formatCurrency(r.invoice.total_amount)),1)]),t("div",Te,[e[24]||(e[24]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Đã thanh toán:",-1)),t("span",Pe,s(a.formatCurrency(r.invoice.paid_amount)),1)]),t("div",Ne,[e[25]||(e[25]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Còn lại:",-1)),t("span",Se,s(a.formatCurrency(r.invoice.remaining_amount)),1)])])])]),t("div",je,[e[35]||(e[35]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thông tin chi tiết",-1)),t("div",Ae,[t("div",Ie,[t("div",Me,[e[27]||(e[27]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Mã hóa đơn:",-1)),t("span",Ve,"#"+s(r.invoice.id),1)]),t("div",Le,[e[28]||(e[28]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ngày tạo:",-1)),t("span",De,s(a.formatDateTime(r.invoice.created_at)),1)]),t("div",He,[e[29]||(e[29]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Người tạo:",-1)),t("span",qe,s(((V=r.invoice.created_by)==null?void 0:V.full_name)||"N/A"),1)]),t("div",Ue,[e[30]||(e[30]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ghi chú:",-1)),t("span",Ge,s(r.invoice.note||"-"),1)])]),t("div",Re,[t("div",Be,[e[31]||(e[31]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Khách hàng:",-1)),t("span",Oe,s((H=r.invoice.user)==null?void 0:H.full_name),1)]),t("div",ze,[e[32]||(e[32]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Số điện thoại:",-1)),t("span",Fe,s((L=r.invoice.user)==null?void 0:L.phone_number),1)]),t("div",Ee,[e[33]||(e[33]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Email:",-1)),t("span",Ke,s(((k=r.invoice.user)==null?void 0:k.email)||"-"),1)]),t("div",Xe,[e[34]||(e[34]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Địa chỉ:",-1)),t("span",We,s(((S=r.invoice.user)==null?void 0:S.address)||"-"),1)])])])]),t("div",Je,[e[43]||(e[43]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Chi tiết đơn hàng",-1)),t("div",Qe,[t("table",Ze,[e[42]||(e[42]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," STT "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Sản phẩm/Dịch vụ "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-right text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Đơn giá "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-center text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Số lượng "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-right text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Thành tiền "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",Ye,[(l(!0),c(f,null,z((q=r.invoice.order)==null?void 0:q.order_items,(i,j)=>{var R,B;return l(),c("tr",{key:i.id},[t("td",$e,s(j+1),1),t("td",tn,[t("div",en,s(i.item_name),1),t("div",nn," Mã sản phẩm/dịch vụ: "+s(((R=i.service)==null?void 0:R.id)||((B=i.product)==null?void 0:B.id)||"-"),1),i.description?(l(),c("div",an,s(i.description),1)):y("",!0)]),t("td",rn,s(a.formatCurrency(Number(i.price)||0)),1),t("td",sn,s(Number(i.quantity)||0),1),t("td",on,s(a.formatCurrency((Number(i.price)||0)*(Number(i.quantity)||0))),1),t("td",dn,[i.service_type?(l(),c("span",{key:0,class:T(a.getServiceTypeClass(i.service_type))},s(a.formatServiceType(i.service_type)),3)):y("",!0)])])}),128)),t("tr",ln,[e[36]||(e[36]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"}," Tổng tiền hàng: ",-1)),t("td",cn,s(a.formatCurrency(a.subtotalAmount)),1),e[37]||(e[37]=t("td",null,null,-1))]),(U=r.invoice.order)!=null&&U.discount_amount?(l(),c("tr",un,[e[38]||(e[38]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-dark-text"}," Giảm giá: ",-1)),t("td",mn," -"+s(a.formatCurrency(r.invoice.order.discount_amount)),1),e[39]||(e[39]=t("td",null,null,-1))])):y("",!0),t("tr",xn,[e[40]||(e[40]=t("td",{colspan:"4",class:"px-6 py-4 text-right text-gray-900 dark:text-dark-text"}," Tổng tiền thanh toán: ",-1)),t("td",gn,s(a.formatCurrency(r.invoice.total_amount)),1),e[41]||(e[41]=t("td",null,null,-1))])])])])]),a.showPaymentForm?(l(),c("div",yn,[e[49]||(e[49]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Thanh toán",-1)),t("form",{onSubmit:e[8]||(e[8]=vt((...i)=>a.processPayment&&a.processPayment(...i),["prevent"])),class:"space-y-4"},[t("div",fn,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted mb-2"}," Hình thức thanh toán ",-1)),t("div",bn,[t("button",{type:"button",onClick:e[2]||(e[2]=i=>a.selectPaymentType("full")),class:T(["px-4 py-2 rounded-md",a.paymentType==="full"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-dark-surface text-gray-700 dark:text-dark-text-muted hover:bg-gray-200 dark:hover:bg-dark-hover"])}," Thanh toán tất cả ("+s(a.formatCurrency(r.invoice.remaining_amount))+") ",3),t("button",{type:"button",onClick:e[3]||(e[3]=i=>a.selectPaymentType("partial")),class:T(["px-4 py-2 rounded-md",a.paymentType==="partial"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-dark-surface text-gray-700 dark:text-dark-text-muted hover:bg-gray-200 dark:hover:bg-dark-hover"])}," Thanh toán một phần ",2)])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"}," Số tiền thanh toán ",-1)),Z(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=i=>a.formattedPaymentAmount=i),onInput:e[5]||(e[5]=(...i)=>a.updatePaymentAmount&&a.updatePaymentAmount(...i)),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",required:""},null,544),[[nt,a.formattedPaymentAmount]]),t("p",pn," Số tiền còn lại cần thanh toán: "+s(a.formatCurrency(r.invoice.remaining_amount)),1)]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"}," Phương thức thanh toán ",-1)),Z(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>a.paymentMethod=i),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",required:""},[(l(!0),c(f,null,z(a.paymentMethods,i=>(l(),c("option",{key:i.id,value:i.id},s(i.method_name),9,hn))),128))],512),[[_t,a.paymentMethod]])]),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-dark-text-muted"}," Ghi chú ",-1)),Z(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=i=>a.paymentNote=i),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-dark-border shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text",rows:"2"},null,512),[[nt,a.paymentNote]])]),t("button",{type:"submit",disabled:a.processing||a.isProcessingPayment,class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors dark:bg-green-600 dark:hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[a.processing||a.isProcessingPayment?(l(),c(f,{key:0},[e[48]||(e[48]=t("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),b(" "+s(a.paymentMethod===3?"Đang tạo link thanh toán...":"Đang xử lý..."),1)],64)):(l(),c(f,{key:1},[b(s(a.paymentMethod===3?"Thanh toán qua PayOS":"Xác nhận thanh toán"),1)],64))],8,kn)],32)])):y("",!0),((G=r.invoice.payment_histories)==null?void 0:G.length)>0?(l(),c("div",vn,[e[51]||(e[51]=t("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Lịch sử thanh toán",-1)),t("div",_n,[t("table",wn,[e[50]||(e[50]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Thời gian "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Số tiền "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Phương thức "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Trạng thái cũ "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Trạng thái mới "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Người thực hiện "),t("th",{class:"px-6 py-3 bg-gray-50 dark:bg-dark-surface text-left text-xs font-medium text-gray-500 dark:text-dark-text-muted uppercase tracking-wider"}," Ghi chú ")])],-1)),t("tbody",Cn,[(l(!0),c(f,null,z(r.invoice.payment_histories,i=>{var j;return l(),c("tr",{key:i.id},[t("td",Tn,s(a.formatDateTime(i.created_at)),1),t("td",Pn,s(a.formatCurrency(i.payment_amount)),1),t("td",Nn,s(a.getPaymentMethodText(i.payment_method)),1),t("td",Sn,[t("span",{class:T(a.getStatusClass(i.old_payment_status))},s(a.getStatusText(i.old_payment_status)),3)]),t("td",jn,[t("span",{class:T(a.getStatusClass(i.new_payment_status))},s(a.getStatusText(i.new_payment_status)),3)]),t("td",An,s(((j=i.created_by)==null?void 0:j.full_name)||"N/A"),1),t("td",In,s(i.note||"-"),1)])}),128))])])])])):y("",!0),t("div",Mn,[t("div",Vn,[e[53]||(e[53]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-dark-text"},"Thông tin đơn hàng",-1)),r.invoice.order?(l(),at(P,{key:0,href:d.route("orders.show",r.invoice.order.id),class:"bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg flex items-center transition-colors dark:bg-blue-900 dark:hover:bg-blue-800 dark:text-blue-100"},{default:Q(()=>[e[52]||(e[52]=t("i",{class:"mdi mdi-shopping-outline mr-2"},null,-1)),b(" Xem đơn hàng #"+s(r.invoice.order.id),1)]),_:1},8,["href"])):y("",!0)]),r.invoice.order?(l(),c("div",Ln,[t("div",Dn,[t("div",Hn,[e[54]||(e[54]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Trạng thái đơn hàng:",-1)),t("span",{class:T(a.getOrderStatusClass(r.invoice.order.status))},s(a.getOrderStatusText(r.invoice.order.status)),3)]),t("div",qn,[e[55]||(e[55]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Ngày tạo đơn:",-1)),t("span",Un,s(a.formatDateTime(r.invoice.order.created_at)),1)])]),t("div",Gn,[t("div",Rn,[e[56]||(e[56]=t("span",{class:"text-gray-600 dark:text-dark-text-muted"},"Tổng tiền hàng:",-1)),t("span",Bn,s(a.formatCurrency(r.invoice.order.total_amount)),1)]),r.invoice.order.discount_amount>0?(l(),c("div",On,[e[57]||(e[57]=t("span",null,"Giảm giá:",-1)),t("span",zn,"-"+s(a.formatCurrency(r.invoice.order.discount_amount)),1)])):y("",!0)])])):(l(),c("div",Fn," Hóa đơn này không liên kết với đơn hàng nào "))])]),a.isPrinting?(l(),at(wt,{key:0,to:"body"},[t("div",En,[O(N,{ref:"printTemplateRef",invoice:r.invoice,onRendered:a.handlePrintAfterRender},null,8,["invoice","onRendered"])])])):y("",!0)]}),_:1},8,["breadcrumbs"])]),_:1}),a.showCancelModal?(l(),c("div",Kn,[t("div",Xn,[e[60]||(e[60]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-dark-text"},"Xác nhận hủy hóa đơn",-1)),e[61]||(e[61]=t("p",{class:"mb-4 text-gray-600 dark:text-dark-text-muted"},"Bạn có chắc chắn muốn hủy hóa đơn này? Hành động này không thể hoàn tác.",-1)),t("div",Wn,[t("button",{onClick:e[9]||(e[9]=C=>a.showCancelModal=!1),disabled:a.isProcessingCancel,class:"px-4 py-2 bg-gray-300 dark:bg-dark-surface hover:bg-gray-400 dark:hover:bg-dark-hover rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Đóng ",8,Jn),t("button",{onClick:e[10]||(e[10]=(...C)=>a.cancelInvoice&&a.cancelInvoice(...C)),disabled:a.isProcessingCancel,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed"},[a.isProcessingCancel?(l(),c(f,{key:0},[e[58]||(e[58]=t("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e[59]||(e[59]=b(" Đang xử lý... "))],64)):(l(),c(f,{key:1},[b(" Xác nhận hủy ")],64))],8,Qn)])])])):y("",!0)])}const Fa=rt(re,[["render",Zn]]);export{Fa as default};
