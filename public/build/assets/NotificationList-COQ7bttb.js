import{e as w}from"./@mdi-DWfqH7fj.js";import{_ as y}from"./BaseButton-eMTGofBM.js";import{a as _}from"./axios-CCb-kr4I.js";import{r as p,o as C,aU as r,a2 as o,a3 as e,F as E,b0 as L,j as M,bf as i,a1 as d,a9 as g,aa as v,bl as S}from"./@vue-BRgAy5zV.js";import"./@inertiajs-D0DMCEQB.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./colors-S7_1wET5.js";import"./BaseIcon-B4kwkOCn.js";const V={class:"space-y-4"},A={class:"flex justify-between items-start gap-4"},B={class:"flex-1"},R={class:"mb-2 text-sm text-gray-600 dark:text-gray-400"},T={class:"ml-2"},U={class:"flex items-center gap-2"},$={class:"font-semibold"},j={key:0,class:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100"},F={class:"text-sm text-gray-600 dark:text-gray-400 mt-2 whitespace-pre-line"},K={class:"mt-3 flex flex-wrap items-center gap-2 text-xs text-gray-500"},z={class:"flex items-center"},O={class:"flex items-center"},P={key:0,class:"flex items-center"},X={key:0,class:"text-center py-4"},q={key:1,class:"text-center"},G={key:2,class:"text-center text-gray-500"},H={key:3,class:"text-center text-gray-500"},kt={__name:"NotificationList",setup(I){const n=p([]),c=p(!1),h=p(1),m=p(!0),f={UNREAD:"unread",READ:"read"},b=s=>s===f.UNREAD?"bg-blue-50 dark:bg-blue-900/30":"bg-white dark:bg-gray-800",x=async(s=1)=>{try{c.value=!0;const t=await _.get(`/api/notifications/all?page=${s}&include=user`);console.log("Dữ liệu notification nhận được:",t.data);const u=(t.data.data.data||[]).map(l=>({...l,created_at:l.created_at_timestamp||l.created_at,user:l.user||{}}));s===1?n.value=u:n.value.push(...u),m.value=t.data.data.hasMore,h.value=s}catch(t){console.error("Lỗi khi tải thông báo:",t)}finally{c.value=!1}},k=()=>{!c.value&&m.value&&x(h.value+1)},N=async s=>{if(confirm("Bạn có chắc muốn xóa thông báo này?"))try{await _.delete(`/api/notifications/${s}`),n.value=n.value.filter(t=>t.id!==s)}catch(t){console.error("Lỗi khi xóa thông báo:",t)}},D=s=>{try{if(!s)return"Chưa có ngày";let t;if(typeof s=="string")t=new Date(s);else if(typeof s=="number")t=new Date(s*1e3);else throw new Error("Định dạng timestamp không hợp lệ");if(isNaN(t.getTime()))throw new Error("Ngày không hợp lệ");return t.toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Lỗi định dạng ngày:",t,"timestamp:",s),"Ngày không xác định"}};return C(()=>{x()}),(s,t)=>(r(),o("div",null,[t[7]||(t[7]=e("h2",{class:"text-2xl font-bold mb-6"},"Lịch sử thông báo",-1)),e("div",V,[(r(!0),o(E,null,L(n.value,a=>{var u,l;return r(),o("div",{key:a.id,class:M(["border rounded-lg p-4 transition-colors duration-200",b(a.status),"hover:bg-gray-50 dark:hover:bg-gray-800"])},[e("div",A,[e("div",B,[e("div",R,[t[0]||(t[0]=e("span",{class:"font-medium"},"Người nhận:",-1)),e("span",T,i(((u=a.user)==null?void 0:u.full_name)||"Không xác định"),1),t[1]||(t[1]=e("span",{class:"mx-2"},"•",-1)),e("span",null,i(((l=a.user)==null?void 0:l.phone_number)||"Không có SĐT"),1)]),e("div",U,[e("h3",$,i(a.title),1),a.status===f.UNREAD?(r(),o("span",j," Mới ")):d("",!0)]),e("p",F,i(a.content),1),e("div",K,[e("span",z,[t[2]||(t[2]=e("i",{class:"fas fa-clock mr-1"},null,-1)),g(" "+i(D(a.created_at)),1)]),t[6]||(t[6]=e("span",{class:"mx-2"},"•",-1)),e("span",O,[t[3]||(t[3]=e("i",{class:"fas fa-tag mr-1"},null,-1)),g(" "+i(a.type),1)]),a.category?(r(),o("span",P,[t[4]||(t[4]=e("span",{class:"mx-2"},"•",-1)),t[5]||(t[5]=e("i",{class:"fas fa-folder mr-1"},null,-1)),g(" "+i(a.category),1)])):d("",!0)])]),v(y,{color:"danger",icon:S(w),small:"",class:"shrink-0",title:"Xóa thông báo",onClick:J=>N(a.id)},null,8,["icon","onClick"])])],2)}),128)),c.value?(r(),o("div",X," Đang tải... ")):d("",!0),m.value&&!c.value?(r(),o("div",q,[v(y,{color:"info",label:"Tải thêm",onClick:k})])):d("",!0),!m.value&&n.value.length>0?(r(),o("div",G," Đã hiển thị tất cả thông báo ")):d("",!0),n.value.length===0&&!c.value?(r(),o("div",H," Chưa có thông báo nào ")):d("",!0)])]))}};export{kt as default};
