import{r as g,e as C,o as L,aU as c,a0 as M,bH as n,aa as o,bl as a,a3 as r,bM as j,a2 as f,bf as V,a1 as h}from"./@vue-BRgAy5zV.js";import{T as A,Z as B}from"./@inertiajs-D0DMCEQB.js";import{_ as S}from"./SectionMain-Vot1TOkK.js";import{L as E}from"./LayoutAuthenticated-dxE3O_iC.js";import{a6 as D}from"./@mdi-C-p5d_Pb.js";import{_ as H}from"./BaseButton-eMTGofBM.js";import{_ as K}from"./BaseButtons-B17KSMwc.js";import{_ as T}from"./CardBox-jfYP3QDG.js";import{_ as u}from"./FormField-Da_P6kO8.js";import{_ as d}from"./FormControl-BSsARiYM.js";import O from"./NotificationList-DysLKB5Q.js";import{a as x}from"./axios-CCb-kr4I.js";import Q from"./UserGroups-D9ku_mHZ.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./app-BHN1t1nr.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./vue-toastification-ejyjJRED.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./BaseIcon-B4kwkOCn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./main-BNmBi4-k.js";const Z={class:"flex flex-col lg:flex-row gap-6"},z={class:"lg:w-1/2"},F={key:0,class:"border p-4 rounded-lg"},I={key:0,class:"mt-2 text-sm text-gray-600"},J={key:1,class:"border p-4 rounded-lg"},P={key:0,class:"mt-2 text-sm text-gray-600"},R={class:"border p-4 rounded-lg space-y-4"},W={class:"border p-4 rounded-lg space-y-4"},X={class:"border p-4 rounded-lg space-y-4"},Y={key:2,class:"bg-green-100 text-green-700 p-4 rounded-lg"},ee={key:3,class:"bg-red-100 text-red-700 p-4 rounded-lg"},te={class:"lg:w-1/2"},Xe={__name:"NotificationManager",setup(le){const e=A({title:"",content:"",type:"system",target_users:"all",user_ids:[],group_id:null,translations:{vi:{title:"",content:""},ja:{title:"",content:""}}}),$=[{value:"system",label:"Thông báo hệ thống"},{value:"promotion",label:"Khuyến mãi"},{value:"appointment",label:"Lịch hẹn"},{value:"order",label:"Đơn hàng"}],N=[{value:"all",label:"Tất cả người dùng"},{value:"specific",label:"Người dùng cụ thể"},{value:"group",label:"Nhóm người dùng"}],U=g([]),p=g([]),v=g(!1),b=g(!1),_=g(""),y=g([]),m=g(null),w=async()=>{try{const s=await x.get("/api/users");U.value=s.data.data}catch(s){console.error("Lỗi khi tải danh sách người dùng:",s)}},k=async()=>{try{const s=await x.get("/api/user-groups");y.value=s.data}catch(s){console.error("Lỗi khi tải nhóm:",s)}},q=()=>{e.user_ids=[],e.group_id=null,p.value=[],m.value=null,e.target_users==="specific"?w():e.target_users==="group"&&k()};C(p,s=>{Array.isArray(s)&&(e.user_ids=s)},{deep:!0}),C(m,s=>{e.group_id=s},{deep:!0});const G=async()=>{var s,t;v.value=!0,_.value="";try{const i={...e.data(),user_ids:e.target_users==="specific"?e.user_ids:[],group_id:e.target_users==="group"?e.group_id:null};if(e.target_users==="specific"&&(!i.user_ids||i.user_ids.length===0))throw new Error("Vui lòng chọn ít nhất một người dùng");if(e.target_users==="group"&&!i.group_id)throw new Error("Vui lòng chọn một nhóm người dùng");await x.post("/api/notifications/send",i),e.reset(),p.value=[],m.value=null,b.value=!0,setTimeout(()=>{b.value=!1},3e3)}catch(i){_.value=((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||i.message||"Có lỗi xảy ra khi gửi thông báo"}finally{v.value=!1}};return L(()=>{w(),k()}),(s,t)=>(c(),M(E,null,{default:n(()=>[o(a(B),{title:"Quản lý thông báo"}),o(S,null,{default:n(()=>[o(T,{class:"mb-6","has-table":""},{default:n(()=>{var i;return[r("div",Z,[r("div",z,[t[13]||(t[13]=r("h2",{class:"text-2xl font-bold mb-6"},"Gửi thông báo mới",-1)),r("form",{onSubmit:j(G,["prevent"]),class:"space-y-6"},[o(u,{label:"Loại thông báo",help:"Chọn loại thông báo phù hợp"},{default:n(()=>[o(d,{modelValue:a(e).type,"onUpdate:modelValue":t[0]||(t[0]=l=>a(e).type=l),options:$,type:"select"},null,8,["modelValue"])]),_:1}),o(u,{label:"Đối tượng nhận",help:"Chọn người nhận thông báo"},{default:n(()=>[o(d,{modelValue:a(e).target_users,"onUpdate:modelValue":[t[1]||(t[1]=l=>a(e).target_users=l),q],options:N,type:"select"},null,8,["modelValue"])]),_:1}),a(e).target_users==="specific"?(c(),f("div",F,[o(u,{label:"Chọn người dùng",help:"Có thể chọn nhiều người dùng"},{default:n(()=>[o(d,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=l=>p.value=l),options:U.value.map(l=>({value:l.id,label:`${l.full_name} (${l.phone_number})`})),type:"multiselect",placeholder:"Chọn người dùng...",required:""},null,8,["modelValue","options"])]),_:1}),p.value.length>0?(c(),f("div",I," Đã chọn "+V(p.value.length)+" người dùng ",1)):h("",!0)])):h("",!0),a(e).target_users==="group"?(c(),f("div",J,[o(u,{label:"Chọn nhóm",help:"Chọn nhóm người dùng để gửi thông báo"},{default:n(()=>[o(d,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=l=>m.value=l),options:y.value.map(l=>({value:l.id,label:`${l.name} (${l.user_count||0} thành viên)`})),type:"select",placeholder:"Chọn nhóm...",required:""},null,8,["modelValue","options"])]),_:1}),m.value?(c(),f("div",P,V((i=y.value.find(l=>l.id===m.value))==null?void 0:i.description),1)):h("",!0)])):h("",!0),r("div",R,[t[10]||(t[10]=r("h3",{class:"font-semibold"},"Tiếng Anh",-1)),o(u,{label:"Tiêu đề"},{default:n(()=>[o(d,{modelValue:a(e).title,"onUpdate:modelValue":t[4]||(t[4]=l=>a(e).title=l),type:"text",required:""},null,8,["modelValue"])]),_:1}),o(u,{label:"Nội dung"},{default:n(()=>[o(d,{modelValue:a(e).content,"onUpdate:modelValue":t[5]||(t[5]=l=>a(e).content=l),type:"textarea",required:""},null,8,["modelValue"])]),_:1})]),r("div",W,[t[11]||(t[11]=r("h3",{class:"font-semibold"},"Tiếng Việt",-1)),o(u,{label:"Tiêu đề"},{default:n(()=>[o(d,{modelValue:a(e).translations.vi.title,"onUpdate:modelValue":t[6]||(t[6]=l=>a(e).translations.vi.title=l),type:"text",required:""},null,8,["modelValue"])]),_:1}),o(u,{label:"Nội dung"},{default:n(()=>[o(d,{modelValue:a(e).translations.vi.content,"onUpdate:modelValue":t[7]||(t[7]=l=>a(e).translations.vi.content=l),type:"textarea",required:""},null,8,["modelValue"])]),_:1})]),r("div",X,[t[12]||(t[12]=r("h3",{class:"font-semibold"},"Tiếng Nhật",-1)),o(u,{label:"Tiêu đề"},{default:n(()=>[o(d,{modelValue:a(e).translations.ja.title,"onUpdate:modelValue":t[8]||(t[8]=l=>a(e).translations.ja.title=l),type:"text",required:""},null,8,["modelValue"])]),_:1}),o(u,{label:"Nội dung"},{default:n(()=>[o(d,{modelValue:a(e).translations.ja.content,"onUpdate:modelValue":t[9]||(t[9]=l=>a(e).translations.ja.content=l),type:"textarea",required:""},null,8,["modelValue"])]),_:1})]),b.value?(c(),f("div",Y," Gửi thông báo thành công! ")):h("",!0),_.value?(c(),f("div",ee,V(_.value),1)):h("",!0),o(K,null,{default:n(()=>[o(H,{type:"submit",color:"info",icon:a(D),loading:v.value,label:"Gửi thông báo"},null,8,["icon","loading"])]),_:1})],32)]),r("div",te,[o(O)])])]}),_:1}),o(T,{class:"mb-6"},{default:n(()=>[o(Q)]),_:1})]),_:1})]),_:1}))}};export{Xe as default};
