import{Z as Ve,i as Te,F as I}from"./@inertiajs-D0DMCEQB.js";import{L as Me}from"./LayoutAuthenticated-Bm2N-U6A.js";import{_ as Ie}from"./SectionMain-Vot1TOkK.js";import{_ as Be}from"./CardBox-jfYP3QDG.js";import{c as T,aU as h,a2 as y,a3 as e,j as U,a9 as v,bf as g,r as k,e as H,a0 as N,bH as C,bJ as O,F as G,b0 as X,bz as je,bA as D,a1 as _,b2 as M,aa as S}from"./@vue-BRgAy5zV.js";import{C as E}from"./CardBoxModal-DEGnNy3P.js";import{a as B}from"./axios-CCb-kr4I.js";import{u as Q}from"./vue-toastification-ejyjJRED.js";import{_ as Ue}from"./BaseIcon-B4kwkOCn.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";import"./@mdi-D7koDRFv.js";import"./app-BqmaOrwW.js";import"./jspdf-Ciebq7We.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./laravel-echo-C9ppFO4I.js";import"./pusher-js-Cl-1XqxI.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./pinia-BhnhDyRZ.js";import"./firebase-DL3QX-oU.js";import"./@firebase--zA4YiqN.js";import"./idb-Bn1DMRyg.js";import"./colors-S7_1wET5.js";import"./OverlayLayer-BSs7OF78.js";import"./BaseButton-eMTGofBM.js";import"./BaseButtons-B17KSMwc.js";const Pe={__name:"StatusBadge",props:{status:{type:String,required:!0,validator:t=>["pending","confirmed","shipping","completed","cancelled"].includes(t)},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)}},setup(t){const n=t,a=T(()=>`inline-flex items-center font-medium rounded-full ${{sm:"px-2 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"}[n.size]}`),r={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",confirmed:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",shipping:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},p={pending:"bg-yellow-400",confirmed:"bg-blue-400",shipping:"bg-purple-400",completed:"bg-green-400",cancelled:"bg-red-400"},f={pending:"Chờ xác nhận",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"};return(b,x)=>(h(),y("span",{class:U([a.value,r[t.status]])},[e("span",{class:U(["w-2 h-2 rounded-full mr-2",p[t.status]])},null,2),v(" "+g(f[t.status]),1)],2))}},Oe={__name:"PaymentStatusBadge",props:{status:{type:String,required:!0,validator:t=>["pending","partial","paid","cancelled"].includes(t)},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)}},setup(t){const n=t,a=T(()=>`inline-flex items-center font-medium rounded-full ${{sm:"px-2 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"}[n.size]}`),r={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",partial:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",paid:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},p={pending:"bg-yellow-400",partial:"bg-blue-400",paid:"bg-green-400",cancelled:"bg-red-400"},f={pending:"Chờ thanh toán",partial:"Thanh toán một phần",paid:"Đã thanh toán",cancelled:"Đã hủy"};return(b,x)=>(h(),y("span",{class:U([a.value,r[t.status]])},[e("span",{class:U(["w-2 h-2 rounded-full mr-2",p[t.status]])},null,2),v(" "+g(f[t.status]),1)],2))}},He="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full",De={__name:"ItemTypeBadge",props:{type:{type:String,required:!0,validator:t=>["product","service"].includes(t)}},setup(t){const n={product:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",service:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300"},a={product:"mdi-package-variant",service:"mdi-spa"},r={product:"Sản phẩm",service:"Dịch vụ"};return(p,f)=>(h(),y("span",{class:U([He,n[t.type]])},[e("i",{class:U(["mdi mr-1",a[t.type]])},null,2),v(" "+g(r[t.type]),1)],2))}},Ee={class:"space-y-4"},Le=["value"],ze={class:"flex justify-end space-x-3 pt-4"},Ae=["disabled"],$e={key:0,class:"mdi mdi-loading mdi-spin mr-2"},qe={__name:"UpdateStatusModal",props:{modelValue:Boolean,order:Object,availableStatuses:Array},emits:["update:modelValue","updated"],setup(t,{emit:n}){const a=t,r=n,p=k(a.order.status),f=k(""),b=k(!1);H(()=>a.modelValue,d=>{d||(p.value=a.order.status,f.value="",b.value=!1)});const x=d=>({pending:"Chờ xác nhận",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[d],i=async()=>{if(!b.value){b.value=!0;try{r("updated",{status:p.value,note:f.value})}catch(d){console.error("Error in handleSubmit:",d)}}};return(d,o)=>(h(),N(E,{"model-value":t.modelValue,"onUpdate:modelValue":o[3]||(o[3]=c=>d.$emit("update:modelValue",c)),title:"Cập nhật trạng thái đơn hàng","has-button":!1},{default:C(()=>[e("div",Ee,[e("div",null,[o[4]||(o[4]=e("label",{class:"block text-sm font-medium mb-2"},"Trạng thái mới",-1)),O(e("select",{"onUpdate:modelValue":o[0]||(o[0]=c=>p.value=c),class:"form-select w-full rounded-lg border-gray-300 dark:border-dark-border dark:bg-dark-surface"},[(h(!0),y(G,null,X(t.availableStatuses,c=>(h(),y("option",{key:c,value:c},g(x(c)),9,Le))),128))],512),[[je,p.value]])]),e("div",null,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium mb-2"},"Ghi chú (tùy chọn)",-1)),O(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=c=>f.value=c),rows:"3",class:"form-textarea w-full rounded-lg border-gray-300 dark:border-dark-border dark:bg-dark-surface",placeholder:"Nhập ghi chú cho việc cập nhật trạng thái"},null,512),[[D,f.value]])]),e("div",ze,[e("button",{onClick:o[2]||(o[2]=c=>d.$emit("update:modelValue",!1)),class:"px-4 py-2 rounded-lg border border-gray-300 dark:border-dark-border hover:bg-gray-50 dark:hover:bg-dark-bg/50 transition-colors duration-200"}," Hủy "),e("button",{onClick:i,disabled:b.value,class:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[b.value?(h(),y("i",$e)):_("",!0),o[6]||(o[6]=v(" Cập nhật "))],8,Ae)])])]),_:1},8,["model-value"]))}},Fe={class:"p-6"},Ge={class:"text-lg font-medium mb-4"},Xe={class:"space-y-4"},Ke={class:"bg-gray-50 dark:bg-dark-bg/50 p-4 rounded-lg"},Je={class:"flex justify-between mb-2"},Qe={class:"font-medium"},Ze={class:"flex justify-between"},Re={class:"text-green-600"},We={class:"flex justify-between pt-2 border-t mt-2"},Ye={class:"font-medium"},et={class:"mt-6 flex justify-end space-x-3"},tt=["disabled"],nt={key:0,class:"mdi mdi-loading mdi-spin mr-2"},st={__name:"CreateInvoiceModal",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","created"],setup(t,{emit:n}){const a=n,r=k(""),p=k(!1),f=x=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(x),b=async()=>{p.value=!0;try{await a("created",{note:r.value}),r.value=""}catch(x){console.error("Error creating invoice:",x)}finally{p.value=!1}};return(x,i)=>(h(),N(E,{"model-value":t.modelValue,"onUpdate:modelValue":i[2]||(i[2]=d=>x.$emit("update:modelValue",d)),title:"Tạo hóa đơn cho đơn hàng #{{ order.id }}","has-button":!1},{default:C(()=>[e("div",Fe,[e("h3",Ge," Tạo hóa đơn cho đơn hàng #"+g(t.order.id),1),e("div",Xe,[e("div",Ke,[e("div",Je,[i[3]||(i[3]=e("span",{class:"text-gray-500"},"Tổng tiền:",-1)),e("span",Qe,g(f(t.order.total_amount)),1)]),e("div",Ze,[i[4]||(i[4]=e("span",{class:"text-gray-500"},"Giảm giá:",-1)),e("span",Re,"-"+g(f(t.order.discount_amount)),1)]),e("div",We,[i[5]||(i[5]=e("span",{class:"font-medium"},"Thành tiền:",-1)),e("span",Ye,g(f(t.order.total_amount-t.order.discount_amount)),1)])]),e("div",null,[i[6]||(i[6]=e("label",{class:"block text-sm font-medium mb-2"},"Ghi chú (tùy chọn)",-1)),O(e("textarea",{"onUpdate:modelValue":i[0]||(i[0]=d=>r.value=d),rows:"3",class:"form-textarea w-full",placeholder:"Nhập ghi chú cho hóa đơn"},null,512),[[D,r.value]])])]),e("div",et,[e("button",{onClick:i[1]||(i[1]=d=>x.$emit("update:modelValue",!1)),class:"btn-secondary"}," Hủy "),e("button",{onClick:b,disabled:p.value,class:"btn-primary"},[p.value?(h(),y("i",nt)):_("",!0),i[7]||(i[7]=v(" Tạo hóa đơn "))],8,tt)])])]),_:1},8,["model-value"]))}},rt={class:"space-y-6"},at={class:"text-center"},ot={class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},lt={key:0,class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4"},dt={class:"flex justify-end space-x-3"},it=["disabled"],ct={key:0,class:"mdi mdi-loading mdi-spin mr-2"},ut={key:1,class:"mdi mdi-check-circle mr-2"},mt={__name:"CompleteOrderModal",props:{modelValue:Boolean,order:{type:Object,required:!0},hasServiceCombo:{type:Boolean,default:!1}},emits:["update:modelValue","completed"],setup(t,{emit:n}){const a=t,r=n,p=k(""),f=k(!1),b=T(()=>{var i;return((i=a.order.invoice)==null?void 0:i.status)==="paid"}),x=async()=>{var i,d;if(b.value){f.value=!0;try{(await B.post(`/api/orders/${a.order.id}/complete`,{note:p.value})).data.success&&(r("completed"),r("update:modelValue",!1),p.value="")}catch(o){const c=((d=(i=o.response)==null?void 0:i.data)==null?void 0:d.message)||"Có lỗi xảy ra khi hoàn thành đơn hàng";console.error("Error completing order:",c)}finally{f.value=!1}}};return(i,d)=>(h(),N(E,{"model-value":t.modelValue,"onUpdate:modelValue":d[2]||(d[2]=o=>i.$emit("update:modelValue",o)),title:"Hoàn thành đơn hàng","has-button":!1},{default:C(()=>[e("div",rt,[e("div",at,[d[3]||(d[3]=e("div",{class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4"},[e("i",{class:"mdi mdi-check-circle text-4xl text-green-600 dark:text-green-400"})],-1)),e("h3",ot," Hoàn thành đơn hàng #"+g(t.order.id),1),d[4]||(d[4]=e("p",{class:"text-gray-600 dark:text-gray-400 mt-2"}," Xác nhận hoàn thành và tạo gói dịch vụ cho khách hàng ",-1))]),t.hasServiceCombo?(h(),y("div",lt,d[5]||(d[5]=[e("div",{class:"flex items-start"},[e("i",{class:"mdi mdi-information text-blue-500 text-xl mt-0.5 mr-3"}),e("div",null,[e("h4",{class:"font-medium text-blue-900 dark:text-blue-300"}," Thông tin gói dịch vụ "),e("ul",{class:"mt-2 space-y-2 text-sm text-blue-700 dark:text-blue-400"},[e("li",{class:"flex items-center"},[e("i",{class:"mdi mdi-check-circle-outline mr-2"}),v(" Hệ thống sẽ tự động tạo gói liệu trình cho khách hàng ")]),e("li",{class:"flex items-center"},[e("i",{class:"mdi mdi-check-circle-outline mr-2"}),v(" Khách hàng có thể bắt đầu đặt lịch sau khi gói được tạo ")])])])],-1)]))):_("",!0),e("div",null,[d[6]||(d[6]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Ghi chú hoàn thành ",-1)),O(e("textarea",{"onUpdate:modelValue":d[0]||(d[0]=o=>p.value=o),rows:"3",class:"form-textarea w-full rounded-lg border-gray-300 dark:border-gray-700 dark:bg-gray-800",placeholder:"Nhập ghi chú khi hoàn thành đơn hàng (tùy chọn)"},"                ",512),[[D,p.value]])]),e("div",dt,[e("button",{onClick:d[1]||(d[1]=o=>i.$emit("update:modelValue",!1)),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700"}," Hủy "),e("button",{onClick:x,disabled:f.value,class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"},[f.value?(h(),y("i",ct)):(h(),y("i",ut)),d[7]||(d[7]=v(" Hoàn thành đơn hàng "))],8,it)])])]),_:1},8,["model-value"]))}},gt={class:"p-6"},ht={class:"space-y-4"},pt={class:"bg-gray-50 dark:bg-dark-bg/50 p-4 rounded-lg"},ft={class:"flex justify-between mb-2"},yt={class:"font-medium"},bt={key:0,class:"flex justify-between text-red-600"},xt={class:"mt-6 flex justify-end space-x-3"},vt=["disabled"],kt={key:0,class:"mdi mdi-loading mdi-spin mr-2"},Ct={__name:"CancelOrderModal",props:{modelValue:Boolean,order:{type:Object,required:!0},title:String},emits:["update:modelValue","cancelled"],setup(t,{emit:n}){const a=t,r=n,p=k(""),f=k(!1),b=Q(),x=d=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(d),i=async()=>{var d,o;if(!p.value.trim()){b.error("Vui lòng nhập lý do hủy đơn hàng");return}f.value=!0;try{(await B.patch(`/api/orders/${a.order.id}/cancel`,{note:p.value})).data.success&&(b.success("Hủy đơn hàng thành công"),r("cancelled",{reason:p.value}),r("update:modelValue",!1))}catch(c){console.error("Error canceling order:",c),b.error(((o=(d=c.response)==null?void 0:d.data)==null?void 0:o.message)||"Có lỗi xảy ra khi hủy đơn hàng")}finally{f.value=!1}};return H(()=>a.modelValue,d=>{d||(p.value="",f.value=!1)}),(d,o)=>(h(),N(E,{"model-value":t.modelValue,"onUpdate:modelValue":o[2]||(o[2]=c=>d.$emit("update:modelValue",c)),title:t.title,"has-button":!1},{default:C(()=>[e("div",gt,[e("div",ht,[o[6]||(o[6]=e("div",{class:"bg-red-50 dark:bg-red-900/30 p-4 rounded-lg"},[e("div",{class:"flex"},[e("i",{class:"mdi mdi-alert text-red-400 text-xl mr-3"}),e("div",null,[e("h4",{class:"font-medium text-red-800 dark:text-red-300"}," Cảnh báo "),e("p",{class:"text-sm text-red-700 dark:text-red-400"}," Bạn chắc chắn muốn hủy đơn hàng này? Hành động này không thể hoàn tác. ")])])],-1)),e("div",pt,[e("div",ft,[o[3]||(o[3]=e("span",{class:"text-gray-500"},"Tổng tiền:",-1)),e("span",yt,g(x(t.order.total_amount)),1)]),t.order.invoice?(h(),y("div",bt,[o[4]||(o[4]=e("span",null,"Đã thanh toán:",-1)),e("span",null,g(x(t.order.invoice.paid_amount)),1)])):_("",!0)]),e("div",null,[o[5]||(o[5]=e("label",{for:"cancel-reason",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Lý do hủy đơn ",-1)),O(e("textarea",{id:"cancel-reason","onUpdate:modelValue":o[0]||(o[0]=c=>p.value=c),rows:"3",class:"w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-surface text-gray-900 dark:text-gray-100 focus:border-primary-500 focus:ring-primary-500 dark:focus:border-primary-400 dark:focus:ring-primary-400 shadow-sm",placeholder:"Nhập lý do hủy đơn hàng..."},null,512),[[D,p.value]])])]),e("div",xt,[e("button",{onClick:o[1]||(o[1]=c=>d.$emit("update:modelValue",!1)),class:"btn-secondary"}," Đóng "),e("button",{onClick:i,disabled:f.value,class:"btn-danger"},[f.value?(h(),y("i",kt)):_("",!0),o[7]||(o[7]=v(" Xác nhận hủy "))],8,vt)])])]),_:1},8,["model-value","title"]))}},_t={name:"OrderShow",components:{Head:Ve,Link:Te,LayoutAuthenticated:Me,SectionMain:Ie,CardBox:Be,StatusBadge:Pe,PaymentStatusBadge:Oe,ItemTypeBadge:De,UpdateStatusModal:qe,CreateInvoiceModal:st,CompleteOrderModal:mt,CancelOrderModal:Ct,BaseIcon:Ue},props:{order:Object},setup(t){const n=k(!1),a=k(!1),r=k(!1),p=k(!1),f=k(!1),b=k(t.order.status),x=k(""),i=k(""),d=k(""),o=k(""),c=Q(),w=k(!1),L=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),z=s=>new Date(s).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=s=>{const l="px-2 inline-flex text-xs leading-5 font-semibold rounded-full items-center transition-colors duration-150";return{pending:`${l} bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300`,confirmed:`${l} bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300`,shipping:`${l} bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300`,completed:`${l} bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300`,cancelled:`${l} bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300`}[s]||`${l} bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300`},$=s=>({pending:"bg-yellow-400",confirmed:"bg-blue-400",shipping:"bg-purple-400",completed:"bg-green-400",cancelled:"bg-red-400"})[s]||"bg-gray-400",q=s=>{const l="text-sm font-medium";return{pending:`${l} text-yellow-600 dark:text-yellow-400`,partial:`${l} text-blue-600 dark:text-blue-400`,paid:`${l} text-green-600 dark:text-green-400`,cancelled:`${l} text-red-600 dark:text-red-400`}[s]||`${l} text-gray-600 dark:text-gray-400`},u=s=>({pending:"Chờ thanh toán",partial:"Thanh toán một phần",paid:"Đã thanh toán",cancelled:"Đã hủy"})[s]||"Không xác định",F=s=>{const l="px-2 inline-flex text-xs leading-5 font-semibold rounded-full";return s==="product"?`${l} bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-400`:`${l} bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-400`},Z=T(()=>["pending","confirmed","shipping"].includes(t.order.status)),R=T(()=>t.order.invoice&&!["paid","cancelled"].includes(t.order.invoice.status)&&t.order.status!=="cancelled"),W=T(()=>!t.order.invoice&&t.order.status!=="cancelled"&&t.order.status!=="completed"),Y=T(()=>{var s;return["confirmed","shipping"].includes(t.order.status)&&((s=t.order.invoice)==null?void 0:s.status)==="paid"}),P=T(()=>t.order.order_items.some(s=>s.item_type==="service"&&["combo_5","combo_10"].includes(s.service_type))),ee=async()=>{var s,l;w.value=!0;try{(await B.put(route("orders.update",t.order.id),{status:b.value,note:x.value})).data.success&&(c.success("Cập nhật trạng thái thành công"),I.reload())}catch(m){console.error("Error updating order status:",m),c.error(((l=(s=m.response)==null?void 0:s.data)==null?void 0:l.message)||"Có lỗi xảy ra khi cập nhật trạng thái")}finally{w.value=!1,n.value=!1}},te=async s=>{try{await B.post(`/api/invoices/${t.order.invoice.id}/payments`,s),a.value=!1}catch(l){console.error("Error processing payment:",l)}},ne=async()=>{var s,l;w.value=!0;try{const m=await B.post(`/api/orders/${t.order.id}/create-invoice`,{note:i.value});if(m.data.success)c.success("Hóa đơn đã được tạo thành công"),I.visit(route("invoices.show",m.data.data.id));else throw new Error(m.data.message)}catch(m){console.error("Error creating invoice:",m),c.error(((l=(s=m.response)==null?void 0:s.data)==null?void 0:l.message)||"Có lỗi xảy ra khi tạo hóa đơn")}finally{w.value=!1,r.value=!1,i.value=""}},K=s=>({pending:"Chờ xác nhận",confirmed:"Đã xác nhận",shipping:"Đang giao hàng",completed:"Hoàn thành",cancelled:"Đã hủy"})[s]||"Không xác định",se=()=>{t.order.invoice&&I.visit(route("invoices.show",t.order.invoice.id))},re=()=>{t.order.invoice&&I.visit(route("invoices.show",t.order.invoice.id))},ae=()=>{r.value=!0},oe=s=>({single:"Đơn lẻ",combo_5:"Combo 5 lần",combo_10:"Combo 10 lần"})[s]||s,le=()=>{b.value=t.order.status,x.value=t.order.note||"",n.value=!0},de=()=>{p.value=!0,d.value=""},ie=()=>{f.value=!0,o.value=""},ce=async()=>{var s,l;w.value=!0;try{(await B.post(`/api/orders/${t.order.id}/complete`,{note:d.value})).data.success&&(c.success("Đơn hàng đã được hoàn thành thành công"),P.value&&c.info("Các gói liệu trình đã được tạo cho khách hàng"),I.reload())}catch(m){console.error("Error completing order:",m),c.error(((l=(s=m.response)==null?void 0:s.data)==null?void 0:l.message)||"Có lỗi xảy ra khi hoàn thành đơn hàng")}finally{w.value=!1,p.value=!1}},ue=async()=>{var s,l;w.value=!0;try{(await B.post(`/api/orders/${t.order.id}/cancel`,{note:o.value})).data.success&&(c.success("Đơn hàng đã được hủy thành công"),I.reload())}catch(m){console.error("Error canceling order:",m),c.error(((l=(s=m.response)==null?void 0:s.data)==null?void 0:l.message)||"Có lỗi xảy ra khi hủy đơn hàng")}finally{w.value=!1,f.value=!1}},me=T(()=>({pending:["confirmed","cancelled"],confirmed:["shipping","completed","cancelled"],shipping:["completed","cancelled"],completed:[],cancelled:[]})[t.order.status]||[]),ge=T(()=>{var l;const s=[];return s.push({id:"created",content:"Đơn hàng được tạo",datetime:t.order.created_at,iconClass:"mdi mdi-plus-circle",iconBackground:"bg-blue-500"}),(l=t.order.status_histories)!=null&&l.length&&t.order.status_histories.forEach(m=>{s.push({id:m.id,content:`Trạng thái đơn hàng thay đổi thành "${K(m.status)}"${m.note?` - ${m.note}`:""}`,datetime:m.created_at,iconClass:"mdi mdi-clipboard-check",iconBackground:"bg-green-500"})}),t.order.status==="completed"?s.push({id:"completed",content:"Đơn hàng hoàn thành",datetime:t.order.completed_at||t.order.updated_at,iconClass:"mdi mdi-check-circle",iconBackground:"bg-green-600"}):t.order.status==="cancelled"&&s.push({id:"cancelled",content:"Đơn hàng đã hủy",datetime:t.order.cancelled_at||t.order.updated_at,iconClass:"mdi mdi-close-circle",iconBackground:"bg-red-600"}),s.sort((m,V)=>new Date(V.datetime)-new Date(m.datetime))}),he=s=>new Date(s).toLocaleString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),pe=async s=>{var l,m;w.value=!0;try{const V=await B.put(route("orders.update",t.order.id),{status:s.status,note:s.note});if(V.data.success)c.success("Cập nhật trạng thái thành công"),I.reload();else throw new Error(V.data.message||"Có lỗi xảy ra")}catch(V){console.error("Error updating order status:",V),c.error(((m=(l=V.response)==null?void 0:l.data)==null?void 0:m.message)||"Có lỗi xảy ra khi cập nhật trạng thái")}finally{w.value=!1,n.value=!1}},fe=async s=>{var l,m,V;w.value=!0;try{const j=await B.post(`/api/orders/${t.order.id}/create-invoice`,{note:s.note});if(j.data.success)c.success("Tạo hóa đơn thành công"),(l=j.data.data)!=null&&l.id?I.visit(route("invoices.show",j.data.data.id)):I.reload();else throw new Error(j.data.message||"Có lỗi xảy ra")}catch(j){console.error("Error creating invoice:",j),c.error(((V=(m=j.response)==null?void 0:m.data)==null?void 0:V.message)||"Có lỗi xảy ra khi tạo hóa đơn")}finally{w.value=!1,r.value=!1}},ye=()=>{c.success("Đơn hàng đã được hoàn thành thành công",{timeout:3e3}),P.value&&c.info("Các gói liệu trình đã được tạo cho khách hàng",{timeout:4e3}),I.reload()},be=()=>{I.reload()},xe=s=>s.item_name,ve=s=>{var l,m;return((l=s.product)==null?void 0:l.image)||((m=s.service)==null?void 0:m.image)||null},ke=T(()=>["pending","confirmed"].includes(t.order.status)&&(!t.order.invoice||t.order.invoice.status==="pending"));H(()=>n.value,s=>{s||(x.value="",b.value=t.order.status)}),H(()=>f.value,s=>{s||(o.value="")});const Ce=s=>s?`${s.ward}, ${s.district}, ${s.province}`:"",_e=T(()=>{var s,l;return t.order.status==="completed"?!((s=t.order.userServicePackages)==null?void 0:s.some(V=>V.order_id===t.order.id))&&P.value:["confirmed","shipping"].includes(t.order.status)&&((l=t.order.invoice)==null?void 0:l.status)==="paid"&&P.value}),we=T(()=>{var J;const s=t.order.status==="completed",l=P.value,V=(((J=t.order.user)==null?void 0:J.user_service_packages)||[]).some(Se=>Se.order_id===t.order.id);return s&&l&&V});return{showStatusModal:n,showPaymentModal:a,showCreateInvoiceModal:r,showCompleteModal:p,showCancelModal:f,newStatus:b,statusNote:x,invoiceNote:i,completeNote:d,cancelNote:o,formatCurrency:L,formatDate:z,getStatusClass:A,getStatusDotClass:$,getPaymentStatusClass:q,getPaymentStatusText:u,getItemTypeClass:F,canUpdateStatus:Z,canProcessPayment:R,canCreateInvoice:W,canComplete:Y,hasServiceCombo:P,updateOrderStatus:ee,processPayment:te,createInvoice:ne,getStatusText:K,goToInvoice:se,openPaymentModal:re,openCreateInvoiceModal:ae,getServiceTypeText:oe,loading:w,openUpdateStatusModal:le,getAvailableStatuses:me,openCompleteModal:de,openCancelModal:ie,completeOrder:ce,cancelOrder:ue,orderTimeline:ge,formatDateTime:he,handleStatusUpdated:pe,handleInvoiceCreated:fe,handleOrderCompleted:ye,handleOrderCancelled:be,getItemName:xe,getItemImage:ve,canCancel:ke,formatAddress:Ce,needsServicePackageCreation:_e,hasCreatedServicePackages:we}}},wt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},St={class:"lg:col-span-2 space-y-6"},Vt={class:"flex justify-between items-center"},Tt={class:"text-lg font-medium"},Mt={class:"grid grid-cols-2 gap-4"},It={class:"space-y-2"},Bt={class:"space-y-2"},jt={key:0},Ut={class:"mt-4 pt-4 border-t dark:border-dark-border"},Nt={key:0,class:"bg-gray-50 dark:bg-dark-bg/50 p-3 rounded-lg"},Pt={class:"font-medium"},Ot={class:"text-gray-600 dark:text-gray-400"},Ht={key:1,class:"text-gray-500 text-sm"},Dt={class:"overflow-x-auto"},Et={class:"min-w-full divide-y dark:divide-dark-border"},Lt={class:"divide-y dark:divide-dark-border"},zt={class:"px-4 py-4"},At={class:"flex items-center"},$t=["src"],qt={class:"font-medium"},Ft={class:"text-sm text-gray-500"},Gt={key:0,class:"ml-2"},Xt={class:"px-4 py-4"},Kt={class:"px-4 py-4"},Jt={class:"px-4 py-4 font-medium"},Qt={class:"bg-gray-50 dark:bg-dark-bg/50"},Zt={class:"px-4 py-3 font-medium"},Rt={key:0},Wt={class:"px-4 py-3 font-medium text-green-600"},Yt={class:"border-t dark:border-dark-border"},en={class:"px-4 py-3 font-medium text-lg"},tn={class:"flow-root"},nn={role:"list",class:"-mb-8"},sn={class:"relative pb-8"},rn={key:0,class:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-dark-border","aria-hidden":"true"},an={class:"relative flex space-x-3"},on={class:"flex min-w-0 flex-1 justify-between space-x-4 pt-1.5"},ln={class:"text-sm text-gray-500"},dn={class:"whitespace-nowrap text-right text-sm text-gray-500"},cn=["datetime"],un={class:"lg:col-span-1 space-y-6"},mn={class:"space-y-4"},gn={class:"flex justify-between items-center"},hn={class:"space-y-3 pt-3 border-t dark:border-dark-border"},pn={key:0,class:"space-y-4"},fn={class:"flex justify-between items-center"},yn={class:"space-y-2"},bn={class:"flex justify-between"},xn={class:"font-medium"},vn={class:"flex justify-between"},kn={class:"text-green-600 font-medium"},Cn={class:"flex justify-between"},_n={class:"text-red-600 font-medium"},wn={key:1,class:"text-center py-6"};function Sn(t,n,a,r,p,f){const b=M("Head"),x=M("StatusBadge"),i=M("CardBox"),d=M("ItemTypeBadge"),o=M("Link"),c=M("PaymentStatusBadge"),w=M("UpdateStatusModal"),L=M("CreateInvoiceModal"),z=M("CompleteOrderModal"),A=M("CancelOrderModal"),$=M("SectionMain"),q=M("LayoutAuthenticated");return h(),N(q,null,{default:C(()=>[S(b,{title:`Chi tiết đơn hàng #${a.order.id}`},null,8,["title"]),S($,{breadcrumbs:[{label:"Quản lý đơn hàng",href:t.route("orders.index")},{label:`Đơn hàng #${a.order.id}`}]},{default:C(()=>[e("div",wt,[e("div",St,[S(i,null,{header:C(()=>[e("div",Vt,[e("h3",Tt,"Thông tin đơn hàng #"+g(a.order.id),1),S(x,{status:a.order.status},null,8,["status"])])]),default:C(()=>{var u;return[e("div",Mt,[e("div",null,[n[11]||(n[11]=e("h4",{class:"font-medium mb-2"},"Thông tin khách hàng",-1)),e("div",It,[e("p",null,[n[8]||(n[8]=e("span",{class:"text-gray-500"},"Họ tên:",-1)),v(" "+g(a.order.user.full_name),1)]),e("p",null,[n[9]||(n[9]=e("span",{class:"text-gray-500"},"Email:",-1)),v(" "+g(a.order.user.email),1)]),e("p",null,[n[10]||(n[10]=e("span",{class:"text-gray-500"},"Điện thoại:",-1)),v(" "+g(a.order.user.phone_number),1)])])]),e("div",null,[n[15]||(n[15]=e("h4",{class:"font-medium mb-2"},"Thông tin đặt hàng",-1)),e("div",Bt,[e("p",null,[n[12]||(n[12]=e("span",{class:"text-gray-500"},"Ngày đặt:",-1)),v(" "+g(r.formatDateTime(a.order.created_at)),1)]),e("p",null,[n[13]||(n[13]=e("span",{class:"text-gray-500"},"Phương thức:",-1)),v(" "+g((u=a.order.payment_method)==null?void 0:u.method_name),1)]),a.order.voucher?(h(),y("p",jt,[n[14]||(n[14]=e("span",{class:"text-gray-500"},"Mã giảm giá:",-1)),v(" "+g(a.order.voucher.code),1)])):_("",!0)])])]),e("div",Ut,[n[16]||(n[16]=e("h4",{class:"font-medium mb-2"},"Địa chỉ giao hàng",-1)),a.order.shipping_address?(h(),y("div",Nt,[e("p",Pt,g(a.order.shipping_address.address),1),e("p",Ot,g(r.formatAddress(a.order.shipping_address))+" ("+g(a.order.shipping_address.ward.name)+", "+g(a.order.shipping_address.district.name)+", "+g(a.order.shipping_address.province.name)+") ",1)])):(h(),y("p",Ht,"Chưa có địa chỉ giao hàng"))])]}),_:1}),S(i,null,{header:C(()=>n[17]||(n[17]=[e("h3",{class:"text-lg font-medium"},"Danh sách sản phẩm/dịch vụ",-1)])),default:C(()=>[e("div",Dt,[e("table",Et,[n[21]||(n[21]=e("thead",null,[e("tr",{class:"bg-gray-50 dark:bg-dark-bg/50"},[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Sản phẩm/Dịch vụ "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Đơn giá "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số lượng "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thành tiền ")])],-1)),e("tbody",Lt,[(h(!0),y(G,null,X(a.order.order_items,u=>(h(),y("tr",{key:u.id,class:"hover:bg-gray-50 dark:hover:bg-dark-bg/30"},[e("td",zt,[e("div",At,[r.getItemImage(u)?(h(),y("img",{key:0,src:r.getItemImage(u),class:"h-10 w-10 rounded-lg object-cover mr-3"},null,8,$t)):_("",!0),e("div",null,[e("div",qt,g(r.getItemName(u)),1),e("div",Ft,[S(d,{type:u.item_type},null,8,["type"]),u.service_type?(h(),y("span",Gt,g(r.getServiceTypeText(u.service_type)),1)):_("",!0)])])])]),e("td",Xt,g(r.formatCurrency(u.price)),1),e("td",Kt,g(u.quantity),1),e("td",Jt,g(r.formatCurrency(u.price*u.quantity)),1)]))),128))]),e("tfoot",Qt,[e("tr",null,[n[18]||(n[18]=e("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Tổng tiền:",-1)),e("td",Zt,g(r.formatCurrency(a.order.total_amount)),1)]),a.order.discount_amount?(h(),y("tr",Rt,[n[19]||(n[19]=e("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Giảm giá:",-1)),e("td",Wt," -"+g(r.formatCurrency(a.order.discount_amount)),1)])):_("",!0),e("tr",Yt,[n[20]||(n[20]=e("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Thành tiền:",-1)),e("td",en,g(r.formatCurrency(a.order.total_amount-a.order.discount_amount)),1)])])])])]),_:1}),r.orderTimeline.length?(h(),N(i,{key:0},{header:C(()=>n[22]||(n[22]=[e("h3",{class:"text-lg font-medium"},"Lịch sử đơn hàng",-1)])),default:C(()=>[e("div",tn,[e("ul",nn,[(h(!0),y(G,null,X(r.orderTimeline,(u,F)=>(h(),y("li",{key:u.id},[e("div",sn,[F!==r.orderTimeline.length-1?(h(),y("span",rn)):_("",!0),e("div",an,[e("div",null,[e("span",{class:U(["h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white dark:ring-dark-surface",u.iconBackground])},[e("i",{class:U([u.iconClass,"text-white"]),"aria-hidden":"true"},null,2)],2)]),e("div",on,[e("div",null,[e("p",ln,g(u.content),1)]),e("div",dn,[e("time",{datetime:u.datetime},g(r.formatDateTime(u.datetime)),9,cn)])])])])]))),128))])])]),_:1})):_("",!0)]),e("div",un,[S(i,null,{default:C(()=>[e("div",mn,[e("div",null,[n[24]||(n[24]=e("h3",{class:"text-lg font-medium mb-3"},"Trạng thái đơn hàng",-1)),e("div",gn,[n[23]||(n[23]=e("span",{class:"text-gray-600"},"Trạng thái hiện tại",-1)),S(x,{status:a.order.status,class:"px-3 py-1"},null,8,["status"])])]),e("div",hn,[r.canUpdateStatus?(h(),y("button",{key:0,onClick:n[0]||(n[0]=(...u)=>r.openUpdateStatusModal&&r.openUpdateStatusModal(...u)),class:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},n[25]||(n[25]=[e("i",{class:"mdi mdi-pencil-outline mr-2"},null,-1),v(" Cập nhật trạng thái ")]))):_("",!0),r.canCancel?(h(),y("button",{key:1,onClick:n[1]||(n[1]=(...u)=>r.openCancelModal&&r.openCancelModal(...u)),class:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},n[26]||(n[26]=[e("i",{class:"mdi mdi-close-circle-outline mr-2"},null,-1),v(" Hủy đơn hàng ")]))):_("",!0),r.hasCreatedServicePackages?(h(),N(o,{key:2,href:t.route("users.show",a.order.user_id),class:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},{default:C(()=>n[27]||(n[27]=[e("i",{class:"mdi mdi-package-variant mr-2"},null,-1),v(" Xem gói dịch vụ người dùng ")])),_:1},8,["href"])):_("",!0),r.needsServicePackageCreation&&!r.hasCreatedServicePackages?(h(),y("button",{key:3,onClick:n[2]||(n[2]=(...u)=>r.openCompleteModal&&r.openCompleteModal(...u)),class:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},[n[28]||(n[28]=e("i",{class:"mdi mdi-check-circle-outline mr-2"},null,-1)),v(" "+g(a.order.status==="completed"?"Tạo gói dịch vụ":"Hoàn thành đơn hàng"),1)])):_("",!0)])])]),_:1}),S(i,null,{header:C(()=>n[29]||(n[29]=[e("h3",{class:"text-lg font-medium"},"Thông tin thanh toán",-1)])),default:C(()=>[a.order.invoice?(h(),y("div",pn,[e("div",fn,[n[30]||(n[30]=e("span",{class:"text-gray-500"},"Trạng thái",-1)),S(c,{status:a.order.invoice.status},null,8,["status"])]),e("div",yn,[e("div",bn,[n[31]||(n[31]=e("span",{class:"text-gray-500"},"Tổng tiền",-1)),e("span",xn,g(r.formatCurrency(a.order.invoice.total_amount)),1)]),e("div",vn,[n[32]||(n[32]=e("span",{class:"text-gray-500"},"Đã thanh toán",-1)),e("span",kn,g(r.formatCurrency(a.order.invoice.paid_amount)),1)]),e("div",Cn,[n[33]||(n[33]=e("span",{class:"text-gray-500"},"Còn lại",-1)),e("span",_n,g(r.formatCurrency(a.order.invoice.remaining_amount)),1)])]),S(o,{href:t.route("invoices.show",a.order.invoice.id),class:"flex items-center justify-center px-4 py-2.5 font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 transition-colors duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-dark-surface"},{default:C(()=>n[34]||(n[34]=[e("i",{class:"mdi mdi-file-document-outline text-xl mr-2"},null,-1),v(" Xem chi tiết hóa đơn ")])),_:1},8,["href"])])):(h(),y("div",wn,[n[36]||(n[36]=e("div",{class:"mb-4"},[e("i",{class:"mdi mdi-file-document-plus-outline text-5xl text-gray-400"})],-1)),n[37]||(n[37]=e("p",{class:"text-gray-500 mb-4"},"Chưa có hóa đơn cho đơn hàng này",-1)),r.canCreateInvoice?(h(),y("button",{key:0,onClick:n[3]||(n[3]=(...u)=>r.openCreateInvoiceModal&&r.openCreateInvoiceModal(...u)),class:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center transition-colors duration-200"},n[35]||(n[35]=[e("i",{class:"mdi mdi-plus-circle-outline mr-2 text-xl"},null,-1),v(" Tạo hóa đơn mới ")]))):_("",!0)]))]),_:1})])]),S(w,{modelValue:r.showStatusModal,"onUpdate:modelValue":n[4]||(n[4]=u=>r.showStatusModal=u),order:a.order,"available-statuses":r.getAvailableStatuses,onUpdated:r.handleStatusUpdated},null,8,["modelValue","order","available-statuses","onUpdated"]),S(L,{modelValue:r.showCreateInvoiceModal,"onUpdate:modelValue":n[5]||(n[5]=u=>r.showCreateInvoiceModal=u),order:a.order,onCreated:r.handleInvoiceCreated},null,8,["modelValue","order","onCreated"]),S(z,{modelValue:r.showCompleteModal,"onUpdate:modelValue":n[6]||(n[6]=u=>r.showCompleteModal=u),order:a.order,"has-service-combo":r.hasServiceCombo,onCompleted:r.handleOrderCompleted},null,8,["modelValue","order","has-service-combo","onCompleted"]),S(A,{modelValue:r.showCancelModal,"onUpdate:modelValue":n[7]||(n[7]=u=>r.showCancelModal=u),order:a.order,title:`Hủy đơn hàng #${a.order.id}`,onCancelled:r.handleOrderCancelled},null,8,["modelValue","order","title","onCancelled"])]),_:1},8,["breadcrumbs"])]),_:1})}const ys=Ne(_t,[["render",Sn]]);export{ys as default};
