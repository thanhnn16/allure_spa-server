import{F as y,Z as k}from"./@inertiajs-D0DMCEQB.js";import{a as C}from"./axios-CCb-kr4I.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as l,o as w,aU as n,a2 as a,a3 as r,bf as b,b2 as v,aa as f,F as P}from"./@vue-BRgAy5zV.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";const $={props:{orderCode:{type:String,required:!0},invoice_id:{type:String,required:!0},status:{type:String,default:""}},setup(e){const t=l(!0),d=l(!1),o=l(null),p=l(null),c=l(null),s=async()=>{try{if(console.log("Props received:",e),!e.orderCode)throw new Error("Không tìm thấy mã đơn hàng");const i=e.invoice_id;if(e.status==="CANCELLED")throw new Error("Giao dịch đã bị hủy");let u=3;for(;u>0;)try{if((await C.post("/api/payos/verify",{orderCode:e.orderCode,invoice_id:i})).data.success){d.value=!0;break}u--}catch(h){if(u===0)throw h;await new Promise(_=>setTimeout(_,2e3))}}catch(i){o.value=i.message||"Có lỗi xảy ra khi xác thực thanh toán",d.value=!1}finally{t.value=!1}},g=()=>{c.value?y.visit(`/orders/${c.value}`):y.visit("/orders")},m=()=>{y.visit("/invoices")};return w(()=>{s()}),{loading:t,success:d,error:o,transactionId:p,goToOrder:g,retryPayment:m}}},T={class:"payment-callback"},E={key:0,class:"loading"},S={key:1,class:"max-w-lg mx-auto p-6"},F={key:0,class:"success bg-green-50 dark:bg-green-900/20 p-6 rounded-lg"},I={class:"text-center"},B={class:"text-gray-600 dark:text-gray-400 mb-4"},H={key:1,class:"failed bg-red-50 dark:bg-red-900/20 p-6 rounded-lg"},L={class:"text-center"},N={class:"text-gray-600 dark:text-gray-400 mb-4"};function O(e,t,d,o,p,c){return n(),a("div",T,[o.loading?(n(),a("div",E,t[2]||(t[2]=[r("div",{class:"flex items-center justify-center"},[r("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),r("span",{class:"ml-3"},"Đang xác thực thanh toán...")],-1)]))):(n(),a("div",S,[o.success?(n(),a("div",F,[r("div",I,[t[3]||(t[3]=r("i",{class:"mdi mdi-check-circle text-5xl text-green-500 mb-4"},null,-1)),t[4]||(t[4]=r("h3",{class:"text-xl font-semibold text-green-700 dark:text-green-400 mb-2"}," Thanh toán thành công! ",-1)),r("p",B," Mã giao dịch: "+b(o.transactionId),1),r("button",{onClick:t[0]||(t[0]=(...s)=>o.goToOrder&&o.goToOrder(...s)),class:"btn bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg"}," Xem chi tiết đơn hàng ")])])):(n(),a("div",H,[r("div",L,[t[5]||(t[5]=r("i",{class:"mdi mdi-close-circle text-5xl text-red-500 mb-4"},null,-1)),t[6]||(t[6]=r("h3",{class:"text-xl font-semibold text-red-700 dark:text-red-400 mb-2"}," Thanh toán thất bại ",-1)),r("p",N,b(o.error),1),r("button",{onClick:t[1]||(t[1]=(...s)=>o.retryPayment&&o.retryPayment(...s)),class:"btn bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg"}," Quay lại trang hoá đơn ")])]))]))])}const j=x($,[["render",O]]),q={components:{Head:k,PaymentCallback:j},setup(){const e=new URLSearchParams(window.location.search);return{orderCode:e.get("orderCode"),invoice_id:e.get("invoice_id"),status:e.get("status")}}},D={class:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-dark-bg"},M={class:"max-w-md w-full"};function U(e,t,d,o,p,c){var m,i;const s=v("Head"),g=v("PaymentCallback",!0);return n(),a(P,null,[f(s,{title:"Thanh toán"}),r("div",D,[r("div",M,[f(g,{orderCode:e.$page.props.orderCode||((m=e.$page.url.split("orderCode=")[1])==null?void 0:m.split("&")[0]),invoice_id:e.$page.props.invoice_id,status:(i=e.$page.url.split("status=")[1])==null?void 0:i.split("&")[0]},null,8,["orderCode","invoice_id","status"])])])],64)}const mt=x(q,[["render",U]]);export{mt as default};
