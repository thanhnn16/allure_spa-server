import{r as c,c as I,aU as l,a0 as P,bH as G,a3 as r,a2 as d,b0 as M,j as V,bM as _,aa as m,bl as h,a1 as S,F as j}from"./@vue-BRgAy5zV.js";import{C as T}from"./CardBoxModal-DKfmyhy3.js";import"./@inertiajs-D0DMCEQB.js";import"./colors-S7_1wET5.js";import{_ as g}from"./BaseIcon-B4kwkOCn.js";import{a9 as q,e as L,j as R,b as W}from"./@mdi-DPpcS9jm.js";import{u as H}from"./vue-toastification-ejyjJRED.js";import{a as y}from"./axios-CCb-kr4I.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BaseButton-eMTGofBM.js";import"./BaseButtons-B17KSMwc.js";import"./CardBox-jfYP3QDG.js";import"./OverlayLayer-BSs7OF78.js";import"./deepmerge-CtOfIP5S.js";import"./call-bind-aBC2DkHY.js";import"./get-intrinsic-BKEvijrG.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-B5OANX0j.js";import"./define-data-property-DO9o5wXF.js";import"./es-define-property-tzmkNPou.js";import"./gopd-CEkvUycD.js";import"./has-property-descriptors-DphFXkuo.js";import"./qs-Bnt7aRCy.js";import"./side-channel-FJR906QQ.js";import"./object-inspect-D3SFxae_.js";import"./nprogress-uqLJ5xmn.js";import"./lodash.clonedeep-Bxvn-V0B.js";import"./lodash.isequal-BYpQg7Um.js";const O={class:"space-y-6"},Q={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},X=["src","alt"],Y={class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2"},Z=["onClick","disabled"],tt=["onClick"],et={key:0,class:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs"},ot={class:"flex flex-wrap gap-4"},rt=["src"],st=["onClick"],at={__name:"ManageImagesModal",props:{modelValue:Boolean,product:Object},emits:["update:modelValue","updated"],setup(B,{emit:F}){const f=B,p=F,s=H(),x=c(null),v=c(!1),i=c([]),u=c([]),b=I({get:()=>f.modelValue,set:t=>p("update:modelValue",t)}),C=I(()=>{var t;return[...((t=f.product)==null?void 0:t.media)||[]].sort((e,o)=>e.position-o.position)}),z=()=>{x.value.click()},E=t=>{const e=Array.from(t.target.files);if(i.value.length+e.length>10){s.error("Không được upload quá 10 ảnh");return}e.forEach(a=>{if(a.size>2*1024*1024){s.error(`File ${a.name} vượt quá 2MB`);return}const k=new FileReader;k.onload=K=>{u.value.push(K.target.result)},k.readAsDataURL(a),i.value.push(a)})},$=t=>{i.value.splice(t,1),u.value.splice(t,1)},N=async t=>{try{await y.delete(route("media.destroy",t)),s.success("Xóa ảnh thành công"),p("updated")}catch(e){s.error("Không thể xóa ảnh"),console.error("Error deleting image:",e)}},U=async()=>{if(!v.value){v.value=!0;try{const t=new FormData;i.value.forEach((e,o)=>{t.append(`images[${o}]`,e)}),await y.post(route("products.upload-images",f.product.id),t,{headers:{"Content-Type":"multipart/form-data"}}),s.success("Cập nhật ảnh thành công"),p("updated"),w()}catch(t){s.error("Không thể cập nhật ảnh"),console.error("Error uploading images:",t)}finally{v.value=!1}}},w=()=>{i.value=[],u.value=[],b.value=!1},A=t=>!t||!t.file_path?"/images/placeholder-product.jpg":t.file_path.startsWith("http")?t.file_path:t.file_path.startsWith("storage/")?"/"+t.file_path:"/storage/"+t.file_path,D=async t=>{try{await y.put(route("media.reorder"),{items:C.value.map(e=>({id:e.id,position:e.id===t?0:e.position===0?1:e.position}))}),s.success("Đã đặt làm ảnh chính"),p("updated")}catch(e){console.error("Error setting main image:",e),s.error("Không thể đặt làm ảnh chính")}};return(t,e)=>(l(),P(T,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),title:"Quản lý hình ảnh sản phẩm",button:"info","has-cancel":"",onConfirm:U,onCancel:w},{default:G(()=>[r("div",O,[r("div",null,[e[1]||(e[1]=r("h3",{class:"text-lg font-medium mb-4"},"Ảnh hiện tại",-1)),r("div",Q,[(l(!0),d(j,null,M(C.value,(o,n)=>(l(),d("div",{key:n,class:V(["relative group border-2 rounded-lg overflow-hidden",{"border-green-500":o.position===0,"border-gray-200":o.position!==0}])},[r("img",{src:A(o),alt:"Product image "+n,class:"w-full h-32 object-cover"},null,8,X),r("div",Y,[r("button",{onClick:_(a=>D(o.id),["prevent"]),class:V(["text-white bg-green-600 p-2 rounded-full hover:bg-green-700",{"opacity-50 cursor-not-allowed":o.position===0}]),disabled:o.position===0},[m(g,{path:h(q),size:"20"},null,8,["path"])],10,Z),r("button",{onClick:_(a=>N(o.id),["prevent"]),class:"text-white bg-red-600 p-2 rounded-full hover:bg-red-700"},[m(g,{path:h(L),size:"20"},null,8,["path"])],8,tt)]),o.position===0?(l(),d("div",et," Ảnh chính ")):S("",!0)],2))),128))])]),r("div",null,[e[2]||(e[2]=r("h3",{class:"text-lg font-medium mb-4"},"Thêm ảnh mới",-1)),r("div",ot,[(l(!0),d(j,null,M(u.value,(o,n)=>(l(),d("div",{key:n,class:"relative w-32 h-32 border rounded-lg overflow-hidden"},[r("img",{src:o,class:"w-full h-full object-cover"},null,8,rt),r("button",{onClick:_(a=>$(n),["prevent"]),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600"},[m(g,{path:h(R),size:"16"},null,8,["path"])],8,st)]))),128)),r("div",{class:"w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:border-indigo-500",onClick:z},[m(g,{path:h(W),size:"24",class:"text-gray-400"},null,8,["path"]),r("input",{type:"file",ref_key:"fileInput",ref:x,class:"hidden",multiple:"",onChange:E,accept:"image/*"},null,544)])]),e[3]||(e[3]=r("p",{class:"text-xs text-gray-500 mt-2"},"PNG, JPG, GIF tối đa 2MB",-1))])])]),_:1},8,["modelValue"]))}},Kt=J(at,[["__scopeId","data-v-2343d5d9"]]);export{Kt as default};
